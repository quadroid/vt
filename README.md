# Virtual Treeview

###### ‚ñ™ ‚ñ™ ‚ñ™

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ä–µ–≤—å–µ–≤ –∏ —Å–ø–∏—Å–∫–æ–≤.

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ –∏ –ø—Ä–∏–µ–º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö.

## 1.0. –í–≤–µ–¥–µ–Ω–∏–µ.

–í—Å–µ —á–∞—â–µ —Å—Ç–∞–ª–∏ –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è –≤–æ–ø—Ä–æ—Å—ã –ø–æ —ç—Ç–æ–º—É, –±–µ–∑—É—Å–ª–æ–≤–Ω–æ, –æ—Ç–ª–∏—á–Ω–æ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É, –∏ –≤—Å–µ –±–æ–ª—å—à–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—é—Ç —Å–≤–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å **VT** (–∑–¥–µ—Å—å –∏ –¥–∞–ª–µ–µ –Ø –±—É–¥—É –ø—Ä–∏–º–µ–Ω—è—Ç—å —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ **¬´VT¬ª**, –≤–º–µ—Å—Ç–æ ¬´Virtual Treeview¬ª). –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞–∑—Ä–µ–ª–∞ –∏–¥–µ—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è —ç—Ç–æ–π —Å—Ç–∞—Ç—å–∏. –î–∞ –∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞–∑—Ä–µ–ª–∞, –∞ —Å—Ç–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å—é, —Ç–∞–∫ –∫–∞–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç —Ç–æ–ª–∫–æ–º –Ω–∏–∫–∞–∫–æ–≥–æ –∫–æ–¥–∞, –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—è—Å—å –ª–∏—à—å –ø—É—Å—Ç—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∏ –∏–µ—Ä–∞—Ä—Ö–∏–π –∫–ª–∞—Å—Å–æ–≤. –í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ –Ø —Ö–æ—Ç–µ–ª –±—ã –æ—Å–≤–µ—Ç–∏—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ:

-   –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞;

-   –ï–≥–æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –ø–µ—Ä–µ–¥ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ `TTreeView` –∏ `TListView` (–¥–∞, –¥–∞, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Å–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, **VT** —è–≤–ª—è–µ—Ç—Å—è –ø–æ–º–µ—Å—å—é –∏ —Ç–æ–≥–æ –∏ –¥—Ä—É–≥–æ–≥–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ);

-   –ü—Ä–∏–µ–º—ã –∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤ –í–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö;

-   –ê —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ—á—å –í–∞—Å –æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö –ø—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.

–°—Ä–∞–∑—É —Ö–æ—á—É —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–Ω–∞—á–∞–ª—É –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –í–∞–º —Å–ª–∏—à–∫–æ–º –≥—Ä–æ–º–æ–∑–¥–∫–∏–º –∏ —Ç—è–∂–µ–ª—ã–º. –ù–æ —É–≤–µ—Ä—è—é –í–∞—Å, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –í—ã —Å–¥–µ–ª–∞–µ—Ç–µ –ø–µ—Ä–≤—ã–µ —à–∞–≥–∏ –∏ –Ω–∞—á–Ω–µ—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —ç—Ç–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º, –í—ã –¥–æ–ª–≥–æ –ø–æ—Ç–æ–º –±—É–¥–µ—Ç–µ —É–¥–∏–≤–ª—è—Ç—å—Å—è, –ø–æ—á–µ–º—É —Å—Ä–∞–∑—É –≤—Å–µ –Ω–µ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏–º–µ–Ω–Ω–æ —Ç–∞–∫, –∫–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –≤ **VT**.

## 1.1. TVirtualTreeView ‚Äî –ø—Ä–æ–µ–∫—Ç Soft Gems.

–ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤ –¥—Ä–µ–º—É—á–µ–º 1999 –≥–æ–¥—É, –∫–æ–≥–¥–∞ –µ–≥–æ –∞–≤—Ç–æ—Ä –∏ –ø–æ —Å—É—â–µ—Å—Ç–≤—É –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –≤–æ–æ–±—â–µ, **Mike Lischke**, –ø–æ—Å–ª–µ —Ä–µ–ª–∏–∑–∞ *TreeNT* (–ø—Ä–∞—Ä–æ–¥–∏—Ç–µ–ª—è **VT**) —É—Å—Ç—Ä–æ–∏–ª—Å—è –Ω–∞ –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã. –í–Ω–µ–¥—Ä—è—è *TreeNT* –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –∫–æ–º–ø–∞–Ω–∏–∏, –æ–Ω –≤–ø–µ—Ä–≤—ã–µ –æ—Å–æ–∑–Ω–∞–ª –∫–∞–∫ –≤–µ–ª–∏–∫–æ —Ä–∞–∑–ª–∏—á–∏–µ –º–µ–∂–¥—É —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–º—É, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–º—É –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—é –∏ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞–º. *TreeNT* –±—ã–ª –≤—Ä–∞–ø–ø–µ—Ä–æ–º –≤–æ–∫—Ä—É–≥ Microsoft'—Å–∫–æ–≥–æ `CommCtl32.dll` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (`TTreeView`) –∏ –ø–æ—Ç–æ–º—É –Ω–µ—Å –≤ —Å–µ–±–µ –≤—Å–µ —Å–∞–º—ã–µ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –µ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏, –∞ –∏–º–µ–Ω–Ω–æ: –Ω–∏–∑–∫—É—é —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ 5000-6000 —É–∑–ª–æ–≤ –∑–∞–Ω–∏–º–∞–ª–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç), —Å–∏–ª—å–Ω—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–µ—Ä—Å–∏–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç–∏.

–ë—ã–ª–æ –ø—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –Ω–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞ ¬´—Å –Ω—É–ª—è¬ª –Ω–∞ —á–∏—Å—Ç–æ–º **VCL**, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –±—ã –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Ä–∞–±–æ—Ç—É —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. –ù–∞–ø–æ–º–Ω—é, —á—Ç–æ —ç—Ç–æ –ø—Ä–∏–Ω—Ü–∏–ø, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –¥–µ—Ä–µ–≤–æ –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–ª–æ –±—ã –æ –¥–∞–Ω–Ω—ã—Ö —Å–≤–æ–∏—Ö —É–∑–ª–æ–≤, –¥–∞–∂–µ –∏—Ö —Ç–µ–∫—Å—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, –æ —á–µ–º –∑–Ω–∞–µ—Ç **VT** —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ—Ä–µ–≤–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è, –≥—Ä—É–±–æ –≥–æ–≤–æ—Ä—è, —Å–≤—è–∑–∞–Ω–Ω—ã–º —Å–ø–∏—Å–∫–æ–º, –≥–¥–µ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç ‚Äî –∑–∞–ø–∏—Å—å (`TVirtualNode`), —Ö—Ä–∞–Ω—è—â–∞—è —Å–ª—É–∂–µ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —É–∑–ª–∞ (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∏–Ω–¥–µ–∫—Å –∏ —Ç.–¥.). –û —Ç–æ–º, –∫–∞–∫ –¥–µ—Ä–µ–≤–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –¥–∞–Ω–Ω—ã–º–∏, –±—É–¥–µ—Ç —Å–∫–∞–∑–∞–Ω–æ –ø–æ–∑–∂–µ.

–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (`4.3` –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è —ç—Ç–∏—Ö —Å—Ç—Ä–æ–∫) —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ—Ä–≤—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π. –ü–µ—Ä–µ—á–∏—Å–ª—è—Ç—å –Ø –∏—Ö –∑–¥–µ—Å—å, –ø–æ–Ω—è—Ç–Ω–æ–µ –¥–µ–ª–æ, –Ω–µ –±—É–¥—É ¬≠¬≠¬≠‚Äì —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–π–º–µ—Ç –æ–∫–æ–ª–æ –¥–≤—É—Ö-—Ç—Ä–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –ø–µ—á–∞—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞. –°–∫–∞–∂—É —Ç–æ–ª—å–∫–æ, —á—Ç–æ –≤—Å–µ, *–≤—Å–µ*, —á—Ç–æ –í—ã –º–æ–≥–ª–∏ –±—ã –∑–∞—Ö–æ—Ç–µ—Ç—å —Å–¥–µ–ª–∞—Ç—å —Å –¥–µ—Ä–µ–≤–æ–º, –í—ã —Å–¥–µ–ª–∞–µ—Ç–µ —Å **VT**. –î—É–º–∞—é, –¥–ª—è –í–∞—Å —Ç–∞–∫–∂–µ –ø—Ä–∏—è—Ç–Ω–æ –±—É–¥–µ—Ç —É–∑–Ω–∞—Ç—å, —á—Ç–æ **VT** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å—Ä–µ–¥–∞—Ö Borland, –Ω–∞—á–∏–Ω–∞—è —Å BDS 3 (Delphi 2005), —á—Ç–æ –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –≥–∞—Ä–∞–Ω—Ç–æ–º –µ–≥–æ –±–µ–∑—É–ø—Ä–µ—á–Ω–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –≤ —Ä–∞–±–æ—Ç–µ.

## 1.2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö.

–í—Å–µ –±—ã —Ö–æ—Ä–æ—à–æ, –Ω–æ –∫–∞–∫–∞—è –ø–æ–ª—å–∑–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç —ç—Ç–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ, –∫–∞–∫ —É–∂ –Ω–∏ –∫—Ä—É—Ç–∏, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, —Å–∫–∞–∂–µ–º, –¥–ª—è –≤–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã-–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–π –∫–Ω–∏–∂–∫–∏ –∏–ª–∏ –º–∏–Ω–∏–∞—Ç—é—Ä–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫–∞ –ø–∞–ø–æ–∫, –≥–¥–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ –≤—Ä—è–¥ –ª–∏ –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –ø—Ä–µ–≤—ã—Å–∏—Ç —Å–æ—Ç–Ω—é? –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –≤—Å—è–∫–∞—è üòä

–ü–æ–º–∏–º–æ —Å–≤–æ–∏—Ö —Å–∫–æ—Ä–æ—Å—Ç–Ω—ã—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤, **VT** –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π, –¥–∞–∂–µ —Å–∞–º—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π –º–µ—Ö–∞–Ω–∏–∑–º —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç—ã. –û–∫–æ–ª–æ *—Å—Ç–∞ (!)* —Å–æ–±—ã—Ç–∏–π –ø–æ–∑–≤–æ–ª—è—Ç –í–∞–º –∏–∑–º–µ–Ω–∏—Ç—å –æ—Ç—Ä–∏—Å–æ–≤–∫—É –¥–µ—Ä–µ–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–∏—Ç—å –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—É—é –∑–∞–ª–∏–≤–∫—É), —É–≤–µ–ª–∏—á–∏—Ç—å –≤—ã—Å–æ—Ç—É —É–∑–ª–æ–≤, —Ü–≤–µ—Ç –∏ —Å—Ç–∏–ª—å —Ç–µ–∫—Å—Ç–∞, –¥–æ–±–∞–≤–∏—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É –¥–ª—è –æ–±—Ä–µ–∑–∞—é—â–µ–≥–æ—Å—è –¥–ª–∏–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É —Å–∞–º–æ–º—É, —Å –ø–æ–º–æ—â—å—é –í–∞—à–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤.

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ —Å–∞–º–æ–º—É –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏, –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–∏, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –º–∞–ª–µ–π—à–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞, –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏, –¥–æ–±–∞–≤–ª—è—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã –≤ –¥–µ—Ä–µ–≤–æ (–∫—Ä–æ–º–µ –æ–±—ã—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è –≤—Ä–æ–¥–µ `TEdit`) –∏ —Ç.–¥. –î–∞–∂–µ —Å–∞–º–∞—è –Ω–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∫–∞, —Ä–∞–±–æ—Ç–∞—é—â–∞—è —Å–æ —Å–ø–∏—Å–∫–∞–º–∏, —Ç—É—Ç –∂–µ –ø—Ä–µ–æ–±—Ä–∞–∑–∏—Ç—Å—è –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è **VT**, –ø—Ä–∏–±–∞–≤–∏–≤ –≤ *–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏*, *–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏* –∏ *—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–Ω–æ—Å—Ç–∏*.

## 1.3. –ò–µ—Ä–∞—Ä—Ö–∏—è –∫–ª–∞—Å—Å–æ–≤.

–ü—Ä–µ–∂–¥–µ —á–µ–º –º—ã –Ω–∞—á–Ω–µ–º, –≤–∑–≥–ª—è–Ω–∏—Ç–µ –Ω–∞ —ç—Ç—É —Å—Ö–µ–º—É, —á—Ç–æ–±—ã –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å ¬´–≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç—è–º–∏¬ª **VT**.

![–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–ª–∞—Å—Å–æ–≤](/vt/hierarchy.png)

–ö–∞–∫ –≤–∏–¥–∏—Ç–µ, ¬´Virtual Treeview¬ª —ç—Ç–æ –≤—Å–µ–≥–æ –ª–∏—à—å –æ–±—â–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –¥–≤—É—Ö –∫–ª–∞—Å—Å–æ–≤: `TVirtualDrawTree` –∏ `TVirtualStringTree`, –∫–æ—Ç–æ—Ä—ã–µ, –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, —è–≤–ª—è—é—Ç—Å—è –ø–æ—Ç–æ–º–∫–∞–º–∏ –±–∞–∑–æ–≤–æ–≥–æ –¥–ª—è –≤—Å–µ—Ö –¥–µ—Ä–µ–≤—å–µ–≤ –∫–ª–∞—Å—Å–∞ ‚Äî `TBaseVirtualTree`.

## 2.0. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö.

–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –¥–∏—Ñ–∏—Ä–∞–º–±, –¥–∞–≤–∞–π—Ç–µ –ø—Ä–∏—Å—Ç—É–ø–∏–º –±–ª–∏–∂–µ –∫ —Å–∞–±–∂—É –∏ –Ω–∞–ø–∏—à–µ–º —Å–≤–æ–µ –ø–µ—Ä–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å **VT**. [–°–∫–∞—á–∏–≤–∞–π—Ç–µ](https://github.com/JAM-Software/Virtual-TreeView) –ø–∞–∫–µ—Ç –¥–ª—è —Å–≤–æ–µ–π –≤–µ—Ä—Å–∏–∏ Delphi –∏ –ø—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –Ω–∞—à–∏–º —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–º üòä

## 2.1. –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –¥–µ—Ä–µ–≤–∞. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–µ—Ä–µ–≤–∞.

–í —ç—Ç–æ–π –≥–ª–∞–≤–µ –Ω–∞—à–µ–π —Å –í–∞–º–∏ –∑–∞–¥–∞—á–µ–π –±—É–¥–µ—Ç —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —Ç–æ–º, –∫–∞–∫ **VT** —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–∏–º–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –∞ —Ç–∞–∫–∂–µ –Ω–∞—É—á–∏—Ç—å—Å—è –≥—Ä–∞–º–æ—Ç–Ω–æ –∑–∞–ø–æ–ª–Ω—è—Ç—å –¥–µ—Ä–µ–≤–æ –∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π. –ó–¥–µ—Å—å –∂–µ –±—É–¥—É—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–∞–º—ã—Ö –±–∞–∑–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –±–µ–∑ –∫–æ—Ç–æ—Ä—ã—Ö –µ–≥–æ —Ä–∞–±–æ—Ç–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞.

–ò—Ç–∞–∫, –í—ã –∫–∏–Ω—É–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞ —Ñ–æ—Ä–º—É. –ü–µ—Ä–≤–æ-–Ω–∞–ø–µ—Ä–≤–æ, –Ω–µ–ø–ª–æ—Ö–æ –±—ã–ª–æ –±—ã –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–µ—Ä–µ–≤–æ –∫–∞–∫–∏–º–∏-–Ω–∏–±—É–¥—å —É–∑–ª–∞–º–∏, –ø–æ–¥—É–º–∞–µ—Ç–µ –í—ã. –ù–æ –Ω–µ —Ç—É—Ç-—Ç–æ –±—ã–ª–æ. –í —ç—Ç–æ–º –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –ø–µ—Ä–≤–æ–µ –Ω–µ—É–¥–æ–±—Å—Ç–≤–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ‚Äî –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –¥–µ—Ä–µ–≤–æ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –∏ —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–Ω—Ç–∞–π–º–µ. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–æ —Å–≤–æ–π—Å—Ç–≤–æ `RootNodeCount`, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –∏–∑ *Object Inspector,* –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤ –¥–µ—Ä–µ–≤–æ n-–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Ä–Ω–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

###### üí° –ó–∞–ø–æ–º–Ω–∏—Ç–µ

–°–∞–º—ã–º –∫–æ—Ä–Ω–µ–≤—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º, —Ä–æ–¥–∏—Ç–µ–ª–µ–º –≤—Å–µ—Ö –≤–µ—Ç–æ–∫ —è–≤–ª—è–µ—Ç—Å—è `RootNode`. –≠—Ç–æ —Å–ª–µ–¥—É–µ—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ö–æ–¥–∞—Ö –¥–µ—Ä–µ–≤–∞. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ —É `RootNode` –≤ –ø–æ–ª–µ `Parent` –±—É–¥–µ—Ç –∑–Ω–∞—á–∏—Ç—å—Å—è —É–∂–µ `nil`, –∏ –≤ —Å–∞–º–æ–º –¥–µ—Ä–µ–≤–µ –æ–Ω–∞ –≤–∏–¥–Ω–∞, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –Ω–µ –±—É–¥–µ—Ç.

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —ç—Ç–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–µ—Ä–µ–≤–æ –æ—á–∏—â–∞–µ—Ç—Å—è –∏ `RootNode` –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ—á–µ—Ä–Ω–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏. –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ, –∑–∞–±–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–º–∏ —ç—Ç–∏ —É–∑–ª—ã –Ω–∞–º –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–∏–¥–µ—Ç—Å—è –≤ —Ä–∞–Ω—Ç–∞–π–º–µ üòä

–ö–∞–∫ —É–∂–µ –±—ã–ª–æ —Å–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ, —Ñ–∏–∑–∏—á–µ—Å–∫–∏ ¬´–∑–∞–ø–æ–ª–Ω–∏—Ç—å¬ª **VT** –¥–∞–Ω–Ω—ã–º–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ. –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ—â–Ω—ã–π —Å–æ–±—ã—Ç–∏–π–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º. –¢.–µ. –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –í—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤ –¥–µ—Ä–µ–≤–µ, –í—ã –±—É–¥–µ—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å –ø–æ–º–æ—â—å—é —Å–æ–±—ã—Ç–∏–π –æ—Ç—Ä–∏—Å–æ–≤–∫–∏, –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏ —Ç.–¥. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä.

–£ –Ω–∞—Å –µ—Å—Ç—å –Ω–µ–∫–∞—è –ø—Ä–æ—Å—Ç–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–π –∫–Ω–∏–∂–∫–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –¥–≤—É–º—è –º–∞—Å—Å–∏–≤–∞–º–∏:

```delphi
Names: array[0..4] of WideString = (
  '–í–∞—Å—è',
  '–ü–µ—Ç—è',
  '–ú–∞—à–∞',
  '–ö–æ—Å—Ç—è',
  '–î–∏–º–∞'
);

Phones: array[0..4] of WideString = (
  '433-56-49',
  '545-67-79',
  '777-50-50',
  '911-03-05',
  '02'
);
```

–ö–∞–∫ –í—ã —É–∂–µ, –Ω–∞–≤–µ—Ä–Ω–æ–µ, –∑–∞–º–µ—Ç–∏–ª–∏, –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è 2 –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–∞—à–µ–π **VT**-—Ç–∞–±–ª–∏—Ü–µ. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å `TVTHeader` –∏ –µ–≥–æ –ø–æ–ª–µ `Columns`, –æ–±–∏—Ç–∞—é—â–∏–π –≤ –ø–æ–ª–µ `Header` —É **VT**. –°–∞–º–æ–µ –≤—Ä–µ–º—è —Å–¥–µ–ª–∞—Ç—å –ø–∞—É–∑—É –∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–±–ª–∏–∂–µ –Ω–∞–∏–±–æ–ª–µ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Å–≤–æ–π—Å—Ç–≤–∞ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ ‚Äî —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–ª–æ–Ω–∫–∞–º–∏. –Ø –±—É–¥—É —É–¥–µ–ª—è—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å–∞–º—ã–º —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º, –¥—É–º–∞—é, –í—ã –∏ —Å–∞–º–∏ –∑–Ω–∞–µ—Ç–µ, –∑–∞—á–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É –º–æ–≥—É—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è —Å–≤–æ–π—Å—Ç–≤–∞ –Ω–∞–ø–æ–¥–æ–±–∏–µ `Color`, `ImageIndex` –∏–ª–∏ `Text`.

-   **AutoSizeIndex** ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –í–∞–º —É–∫–∞–∑–∞—Ç—å –∫–∞–∫–∞—è –∏–∑ –∫–æ–ª–æ–Ω–æ–∫ –±—É–¥–µ—Ç –∏–º–µ—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è –∞–≤—Ç–æ-–ø–æ–¥–±–æ—Ä–∞ —à–∏—Ä–∏–Ω—ã (–≥—Ä—É–±–æ –≥–æ–≤–æ—Ä—è, –∫–∞–∫–∞—è –∫–æ–ª–æ–Ω–∫–∞ –±—É–¥–µ—Ç —Ä–∞—Å—Ç—è–≥–∏–≤–∞—Ç—å—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —à–∏—Ä–∏–Ω—ã –¥–µ—Ä–µ–≤–∞). –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–º–µ—Å—Ç–µ —Å –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –æ–ø—Ü–∏–µ–π **hoAutoResize**.

-   **Columns** ‚Äî –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–ª–æ–Ω–æ–∫. –ö–∞–∂–¥–∞—è –∫–æ–ª–æ–Ω–∫–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ `TVirtualTreeColumn` –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏. –û–±—Ä–∞—Ç–∏–º –Ω–∞ –Ω–µ–≥–æ –≤–Ω–∏–º–∞–Ω–∏–µ:

    -   **Layout** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–ª–æ–∂–µ–Ω–∏–µ –≥–ª–∏—Ñ–∞ (–∫–∞—Ä—Ç–∏–Ω–∫–∏) –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–µ –∫–æ–ª–æ–Ω–∫–∏.

    -   **Margin** ‚Äî –∑–∞–¥–∞–µ—Ç –æ—Ç—Å—Ç—É–ø –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞.

    -   **MaxWidth, MinWidth** ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–∞—è —à–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

    -   **Options** ‚Äî –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–ª–æ–Ω–∫–∏, –æ–Ω–∏ –∏–º–µ—é—Ç –±–æ–ª—å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, —á–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `TVTHeader`, —Ç.–µ. –º–æ–≥—É—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –≤—ã–∫–ª—é—á–∞—Ç—å –∫–∞–∫–∏–µ-—Ç–æ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è –¥–∞–Ω–Ω–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–æ–ª–æ–Ω–∫–∏, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤—Å–µ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞.

        -   **coAllowClick** ‚Äî –∞–Ω–∞–ª–æ–≥ —Å–≤–æ–π—Å—Ç–≤–∞ HotTrack –¥–ª—è `TListView` –∏ –µ–≥–æ –∫–æ–ª–æ–Ω–æ–∫. –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –∫—É—Ä—Å–æ—Ä–∞ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–æ–ª–æ–Ω–∫–∏, –æ–Ω –±—É–¥–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å–≤–æ–π –≤–∏–¥.

        -   **coDraggable** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–æ–∂–Ω–æ –ª–∏ —Ç–∞—Å–∫–∞—Ç—å –∫–æ–ª–æ–Ω–∫—É –º—ã—à—å—é –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É, –º–µ–Ω—è—è –µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ.

        -   **coEnabled**, **coParentBiDiMode**, **coParentColor**, **coResizeable** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (–¥–ª—è —Å—Ä–µ–¥–Ω–µ–∞–∑–∏–∞—Ç—Å–∫–∏—Ö —è–∑—ã–∫–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä), —Ü–≤–µ—Ç –∫–æ–ª–æ–Ω–∫–∏, –∞ —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω—è—Ç—å —à–∏—Ä–∏–Ω—É –∫–æ–ª–æ–Ω–∫–∏.

        -   **coShowDropMark** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±—É–¥–µ—Ç –ª–∏ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–µ –∫–æ–ª–æ–Ω–∫–∏ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å—Å—è –Ω–µ–±–æ–ª—å—à–æ–π –∑–Ω–∞—á–æ–∫, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å—Ç–∞–≤–∫–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–π –∫–æ–ª–æ–Ω–∫–∏.

        -   **coAutoSpring** ‚Äî –æ—á–µ–Ω—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ. –û–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±—É–¥–µ—Ç –ª–∏ –∫–æ–ª–æ–Ω–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ `hoAutoSpring` —É `TVTHeader`. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–∏—Ö —Å–≤–æ–π—Å—Ç–≤ –±—É–¥–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–æ —á—É—Ç—å –Ω–∏–∂–µ.

        -   **coFixed** ‚Äî –µ—Å–ª–∏ —ç—Ç–æ —Å–≤–æ–π—Å—Ç–≤–æ –≤–∫–ª—é—á–µ–Ω–æ, —Ç–æ –¥–∞–Ω–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ (–ø—Ä–æ–∫—Ä—É—Ç–∫–∞, –¥–æ—Å—Ç—É–ø –∫ —É–∑–ª–∞–º –∏ —Ç.–¥.) –∏ –Ω–µ –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ–∫–æ–≤—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –∫–æ–≥–¥–∞ –í—ã —Ö–æ—Ç–∏—Ç–µ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–º–µ—à–∏–≤–∞—Ç—å—Å—è –≤ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–π –∫–æ–ª–æ–Ω–∫–∏.

    -   **Position** ‚Äî –ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ.

    -   **Style** ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –í–∞–º —É–∫–∞–∑–∞—Ç—å –±—É–¥–µ—Ç –ª–∏ –∫–æ–ª–æ–Ω–∫–∞ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (**vsText**) –∏–ª–∏ –í—ã —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –µ–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—É –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∏ –≤—Å–µ –¥–µ–ª–∞—Ç—å —Å–∞–º–∏ (**vsOwnerDraw**).

-   **MainColumn** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω–¥–µ–∫—Å –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–ª–æ–Ω–∫–∏. –ò–º–µ–Ω–Ω–æ —ç–ª–µ–º–µ–Ω—Ç—ã —ç—Ç–æ–π –∫–æ–ª–æ–Ω–∫–∏ –±—É–¥—É—Ç –≤—ã–¥–µ–ª—è—Ç—å—Å—è —Å–∏–Ω–∏–º —Ü–≤–µ—Ç–æ–º –∏ –ø–æ–ª—É—á–∞—Ç—å —Ñ–æ–∫—É—Å –ø—Ä–∏ –≤—ã–¥–µ–ª–µ–Ω–∏–∏, –∏ –∏–º–µ–Ω–Ω–æ –Ω–∞–ø—Ä–æ—Ç–∏–≤ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —ç—Ç–æ–π –∫–æ–ª–æ–Ω–∫–∏ –±—É–¥—É—Ç —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è –æ—Ç–º–µ—Ç–∫–∏ –∏ –¥—Ä—É–≥–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞.

-   **Options** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞. –í–æ—Ç —Ç—É—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ üòä

    -   **hoAutoResize** ‚Äî –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ, —Ç–æ –∫–æ–ª–æ–Ω–∫–∞ —Å –∏–Ω–¥–µ–∫—Å–æ–º –∏–∑ —Å–≤–æ–π—Å—Ç–≤–∞ AutoResizeIndex –±—É–¥–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–µ—Ä–µ–≤–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –µ–≥–æ —à–∏—Ä–∏–Ω—ã. –®–∏—Ä–∏–Ω–∞ —Ç–∞–∫–æ–π –∫–æ–ª–æ–Ω–∫–∏ –±—É–¥–µ—Ç —Ä–∞–≤–Ω–∞: —à–∏—Ä–∏–Ω–∞ –¥–µ—Ä–µ–≤–∞ ‚Äî —à–∏—Ä–∏–Ω–∞ –≤—Å–µ—Ö –¥—Ä—É–≥–∏—Ö –∫–æ–ª–æ–Ω–æ–∫. –í–æ –≤—Å–µ–º –¥–µ—Ä–µ–≤–µ, –ø–æ–Ω—è—Ç–Ω–æ–µ –¥–µ–ª–æ, –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Ç–∞–∫–∞—è –∫–æ–ª–æ–Ω–∫–∞.

    -   **hoColumnResize** ‚Äî –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–µ–µ –º–æ–∂–Ω–æ –ª–∏ –º–µ–Ω—è—Ç—å —à–∏—Ä–∏–Ω—É –∫–æ–ª–æ–Ω–æ–∫.

    -   **hoDblClickResize** ‚Äî –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º –∫–ª–∏–∫–µ –Ω–∞ –¥–∞–Ω–Ω–æ–π –∫–æ–ª–æ–Ω–∫–µ –æ–Ω–∞ –ø—Ä–∏–º–µ—Ç —à–∏—Ä–∏–Ω—É —Å–∞–º–æ–≥–æ –¥–ª–∏–Ω–Ω–æ–≥–æ –µ–µ —ç–ª–µ–º–µ–Ω—Ç–∞. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–µ—Ä–∂–∞—Ç—å –≤ `True`. –û–ø—Ü–∏—è –ø–æ–¥–∞–≤–ª—è–µ—Ç—Å—è —Å–≤–æ–π—Å—Ç–≤–æ–º hoAutoResize.

    -   **hoDrag** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏.

    -   **hoRestrictDrag** ‚Äî –ù–µ –¥–∞–µ—Ç –∫—É—Ä—Å–æ—Ä—É —Ç—è–Ω—É—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–π –∫–æ–ª–æ–Ω–∫–∏ –∫ –Ω–∏–∑—É –∏–ª–∏ –≤–≤–µ—Ä—Ö.

    -   **hoShowSortGlyphs** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±—É–¥–µ—Ç –ª–∏ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–µ –∫–æ–ª–æ–Ω–∫–∏ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å—Å—è –Ω–µ–±–æ–ª—å—à–æ–π –∑–Ω–∞—á–æ–∫, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π —Ç–µ–∫—É—â–µ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏.

    -   **hoAutoSpring** ‚Äî –≤–æ—Ç —Ç–æ —Å–≤–æ–π—Å—Ç–≤–æ, –æ –∫–æ—Ç–æ—Ä–æ–º –Ω—É–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ. –û–Ω–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫–∞–º —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º —Å–≤–æ–π—Å—Ç–≤–æ–º `coAutoSpring` –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å —Å–≤–æ—é —à–∏—Ä–∏–Ω—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —à–∏—Ä–∏–Ω—ã –¥–µ—Ä–µ–≤–∞. –£—á—Ç–∏—Ç–µ, –æ–¥–Ω–∞–∫–æ, —á—Ç–æ —ç—Ç–æ —Å–≤–æ–π—Å—Ç–≤–æ –ø–æ–¥–∞–≤–ª—è–µ—Ç—Å—è —Å–≤–æ–π—Å—Ç–≤–æ–º `hoAutoResize`.

-   **SortColumn** ‚Äî –∏–Ω–¥–µ–∫—Å –∫–æ–ª–æ–Ω–∫–∏, –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –∫–æ—Ç–æ—Ä–æ–π —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –¥–µ—Ä–µ–≤–æ.

-   **SortDirection** ‚Äî –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–∫–∏ —Å –∏–Ω–¥–µ–∫—Å–æ–º **SortColumn.**

-   **Style** ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ –∑–∞–≥–æ–ª–æ–≤–∫–∞. –ê–∫—Ç–∏–≤–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Ç–µ–º–∞—Ö –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è Windows.

–î–æ–±–∞–≤—å—Ç–µ –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ –∏ –≤—ã—Å—Ç–∞–≤—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —Å–≤–æ–µ–º—É –≤–∫—É—Å—É. –Ø —É—Å—Ç–∞–Ω–æ–≤–∏–ª —Å–≤–æ–π—Å—Ç–≤–æ `AutoSpring` —É –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ `True`, —Å–¥–µ–ª–∞–ª –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤–∏–¥–∏–º—ã–º –∏ –¥–æ–±–∞–≤–∏–ª –µ–º—É –Ω–µ–º–Ω–æ–≥–æ –≤—ã—Å–æ—Ç—ã. –¢–µ–ø–µ—Ä—å –Ω–∞–º –≤–æ –≤—Å–µ–æ—Ä—É–∂–∏–∏ –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–∏–º–µ—Ä—É —Å –∑–∞–ø–∏—Å–Ω–æ–π –∫–Ω–∏–∂–∫–æ–π, —á—Ç–æ–±—ã –≥—Ä–∞–º–æ—Ç–Ω–æ –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –¥–µ—Ä–µ–≤–æ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º.

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ç–æ–∫ –≤ –¥–µ—Ä–µ–≤–æ —É **VT** —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–≤–∞ –±–∞–∑–æ–≤—ã—Ö –º–µ—Ç–æ–¥–∞. –≠—Ç–æ `AddChild`:

```delphi
function TBaseVirtualTree.AddChild(Parent: PVirtualNode;
UserData: Pointer = nil): PVirtualNode;
```

–ò `InsertNode`:

```delphi
function TBaseVirtualTree.InsertNode(Node: PVirtualNode;
Mode: TVTNodeAttachMode; UserData: Pointer = nil): PVirtualNode;
```

–û–±–∞ –æ–Ω–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π —É–∑–µ–ª. –ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—à—å —Ç–µ–º, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é –¥–æ–±–∞–≤–ª—è–µ–º–æ–≥–æ —É–∑–ª–∞ –≤ —Å–≤–æ–π—Å—Ç–≤–µ `Mode`:

-   **amNoWhere** ‚Äî —É–∑–µ–ª –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤–æ–æ–±—â–µ.

-   **amInsertBefore** ‚Äî —É–∑–µ–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –ø–æ–∑–∏—Ü–∏—é –≤—ã—à–µ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ *Node.*

-   **amInsertAfter** ‚Äî —É–∑–µ–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –ø–æ–∑–∏—Ü–∏—é –Ω–∏–∂–µ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ *Node.*

-   **amAddChildFirst** ‚Äî —É–∑–µ–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º –¥–æ—á–µ—Ä–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –≤ *Node.*

-   **amAddChildLast** ‚Äî —É–∑–µ–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–º –¥–æ—á–µ—Ä–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –≤ *Node.*

–í –Ω–∞—à–µ–º –ø–µ—Ä–≤–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã –∫–æ—Å–Ω–µ–º—Å—è –ª–∏—à—å –ø–µ—Ä–≤–æ–≥–æ –º–µ—Ç–æ–¥–∞. –ó–∞–ø–æ–ª–Ω–∏–º, –Ω–∞–∫–æ–Ω–µ—Ü, –Ω–∞—à–µ –¥–µ—Ä–µ–≤–æ:

```delphi
procedure TfrmMain.BtnLoadClick(Sender: TObject);
var
  i: Integer;
begin
  for i := 0 to Length(Names) - 1 do
    VT.AddChild(nil);
end;
```

–ó–¥–µ—Å—å –º—ã –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–µ—Ç–æ–∫, —Ä–∞–≤–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏–º–µ–Ω –≤ –∑–∞–ø–∏—Å–Ω–æ–π –∫–Ω–∏–∂–∫–µ. –ù–æ –±–æ–ª—å—à–æ–π –ø–æ–ª—å–∑—ã –æ—Ç –ø—É—Å—Ç—ã—Ö —É–∑–ª–æ–≤ –Ω–µ –¥–æ–±—å–µ—à—å—Å—è. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –Ω–∞—à–µ –¥–µ—Ä–µ–≤–æ —Å –¥–∞–Ω–Ω—ã–º–∏. –í —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–µ–∫—Å—Ç –∏–∑ –∑–∞–ø–∏—Å–Ω–æ–π –∫–Ω–∏–∂–∫–∏. ¬´–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ¬ª –¥–µ—Ä–µ–≤–∞ —Ç–µ–∫—Å—Ç–æ–º –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–µ `OnGetText`:

```delphi
procedure TfrmMain.VTGetText(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex; TextType: TVSTTextType; var CellText: WideString);
begin
  case Column of
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å—Ç–∞—Ç–æ–∫ –æ—Ç –¥–µ–ª–µ–Ω–∏—è. –ú–∞—Å—Å–∏–≤ –º–æ–∂–µ—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ –∫–æ–Ω—á–∏—Ç—å—Å—è
    // –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–∞–∂–∞—Ç–∏–π BtnLoad –ø–æ–¥—Ä—è–¥ –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏.
    // –°–ø–∞—Å–∏–±–æ OverLord –∑–∞ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (the__teacher@mail.ru).
    // –¢–µ–∫—Å—Ç –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ –∏–º–µ–Ω–∏
    0: CellText := Names[(Node.Index) mod (Length(Names))];
    // –¢–µ–∫—Å—Ç –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞
    1: CellText := Phones[(Node.Index) mod (Length(Phones))];
  end;
end;
```

–ü–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä —Å–æ–±—ã—Ç–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä –¥–µ—Ä–µ–≤–∞, –≤—ã–∑–≤–∞–≤—à–µ–≥–æ —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ, –≤—Ç–æ—Ä–æ–π ‚Äî —É–∑–µ–ª, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç, —Ç—Ä–µ—Ç–∏–π ‚Äî –∏–Ω–¥–µ–∫—Å –∫–æ–ª–æ–Ω–∫–∏, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π –±–µ—Ä–µ—Ç—Å—è —Ç–µ–∫—Å—Ç, —á–µ—Ç–≤–µ—Ä—Ç—ã–π ‚Äî —Ç–∏–ø —Ç–µ–∫—Å—Ç–∞, –±—É–¥–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω –ø–æ–∑–∂–µ, –∏, –Ω–∞–∫–æ–Ω–µ—Ü, –ø—è—Ç—ã–π ‚Äî —Å—Ç—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä—É—é –º—ã –∏ –¥–æ–ª–∂–Ω—ã –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–º–∏. –í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã –ø—Ä–æ—Å—Ç–æ –±–µ—Ä–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –¥–≤—É—Ö –º–∞—Å—Å–∏–≤–æ–≤ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–ª–æ–Ω–æ–∫.

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –º—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É —ç—Ç–æ–≥–æ —Å–æ–±—ã—Ç–∏—è, –º—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ–º –ø–æ–ª—É—á–∞—Ç—å —Ç–µ–∫—Å—Ç –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –º–µ—Ç–æ–¥–∞ `Text`, –∫–æ—Ç–æ—Ä—ã–π –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ `OnGetText` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –°–¥–µ–ª–∞–Ω–æ —ç—Ç–æ –¥–ª—è –í–∞—à–µ–≥–æ —É–¥–æ–±—Å—Ç–≤–∞, —á—Ç–æ–±—ã –Ω–µ –ø–∏—Å–∞—Ç—å —Å–æ—Ç–Ω—é —Ä–∞–∑ –∫–æ–¥ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ —É–∑–ª–∞.

```delphi
property Text[Node: PVirtualNode; Column: TColumnIndex]: WideString;
```

–í—ã –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª–∏—Å—å, –∞ —á—Ç–æ —Ç–∞–∫–æ–µ `CellText`? –í–µ–¥—å –¥–µ—Ä–µ–≤—É –Ω–µ –Ω—É–∂–Ω—ã –Ω–∏–∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ, —Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–¥–æ. –ü—Ä–∞–≤–∏–ª—å–Ω–æ, —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω—É–∂–µ–Ω –¥–µ—Ä–µ–≤—É —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–µ –¥–µ—Ä–µ–≤–∞ –∏–ª–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –≤—ã—à–µ—É–ø–æ–º—è–Ω—É—Ç–æ–≥–æ `Text`. –û–Ω –Ω–∏–≥–¥–µ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–±—ã—Ç–∏–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏.

###### üí° –ü—Ä–æ–µ–∫—Ç, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –¥–µ—Ä–µ–≤–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ *Fig 1.0.*

## 2.2. –£–≥–ª—É–±–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏.

–ú—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–ª–∏ –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä. –ù–æ —á—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –í—ã –æ–ø–µ—Ä–∏—Ä—É–µ—Ç–µ —Å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏? –•—Ä–∞–Ω–∏—Ç—å –∏—Ö –≤—Å–µ –≤ –æ–¥–Ω–æ–º –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–º –º–∞—Å—Å–∏–≤–µ ‚Äî –∑–∞—Ç–µ—è –Ω–∞ –≥—Ä–∞–Ω–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ –º–Ω–æ–≥–∏–º –ø—Ä–∏—á–∏–Ω–∞–º. –ê –í–∞–º –ø—Ä–∏ —ç—Ç–æ–º —Ç—Ä–µ–±—É–µ—Ç—Å—è —É–¥–∞–ª—è—Ç—å –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –≤–µ—Ç–∫–∏, –∏–∑–º–µ–Ω—è—Ç—å –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏ —Ç.–¥.?

–ö —Å—á–∞—Å—Ç—å—é, –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–∫–æ–µ–≥–æ —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞, –≤ –æ–±–ª–∞—Å—Ç–∏ –ø–∞–º—è—Ç–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –º—ã —Å–º–æ–∂–µ–º —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –ª—é–±—ã–µ –Ω—É–∂–Ω—ã–µ –Ω–∞–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–µ—Ç–∫–∏.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–º–µ—Ä.

–°–æ–∑–¥–∞–¥–∏–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—É—é –∫–Ω–∏–∂–∫—É, –∫–æ—Ç–æ—Ä—É—é –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –∏–∑–º–µ–Ω—è—Ç—å.

–î–ª—è –Ω–∞—á–∞–ª–∞, —Ä–µ—à–∏–º, –∫–∞–∫ –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –º—ã –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–π –≤–µ—Ç–∫–∏. –í–∞—Ä–∏–∞–Ω—Ç —Å –º–∞—Å—Å–∏–≤–∞–º–∏ –∏—Å–∫–ª—é—á–µ–Ω, —Ç–∞–∫ —á—Ç–æ –∂–µ —Ç–æ–≥–¥–∞? –î–ª—è —ç—Ç–æ–≥–æ –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –∑–∞–ø–∏—Å—è–º–∏ (`record`), –∫–æ—Ç–æ—Ä—ã–µ –∏ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ —É–∫–∞–∑–∞—Ç–µ–ª–µ –Ω–∞ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞:

```delphi
type
  PPhoneNode = ^TPhoneNode;

  TPhoneNode = record
    Name, // –ò–º—è –∫–æ–Ω—Ç–∞–∫—Ç–∞
    Phone: WideString; // –¢–µ–ª–µ—Ñ–æ–Ω
  end;
```

–ù–æ –ø—Ä–µ–∂–¥–µ —á–µ–º –º—ã –Ω–∞–ø–∏—à–µ–º –∫–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –≤–µ—Ç–æ–∫, –Ø —Ö–æ—Ç–µ–ª –±—ã –æ–±—Ä–∞—Ç–∏—Ç—å –í–∞—à–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –≤–∞–∂–Ω–µ–π—à—É—é –¥–µ—Ç–∞–ª—å. –ü–æ—Å–∫–æ–ª—å–∫—É **VT** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥–∞–Ω–Ω—ã–µ, –æ–Ω –¥–æ–ª–∂–µ–Ω –∫–∞–∫-—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø–æ–ª–æ–∂–µ–Ω–∏–µ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏, —á—Ç–æ–±—ã –º—ã –≤–¥—Ä—É–≥ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ `nil` –∏–ª–∏ –≤–æ–æ–±—â–µ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ, –∫ –¥–µ—Ä–µ–≤—É –Ω–∏–∫–∞–∫ –Ω–µ –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è. –î–ª—è —ç—Ç–æ–≥–æ –≤ –¥–µ—Ä–µ–≤–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–æ —Å–≤–æ–π—Å—Ç–≤–æ `NodeDataSize`, –æ–±–æ–∑–Ω–∞—á–∞—é—â–µ–µ —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞. –° –ø–æ–º–æ—â—å—é —ç—Ç–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–µ—Ä–µ–≤–æ —Å–ø–æ—Å–æ–±–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –∏–º–µ–Ω–Ω–æ –¥–∞–Ω–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —É–∑–ª–∞ –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –º–µ—Ç–æ–¥–∞ `GetNodeData`:

```delphi
function TBaseVirtualTree.GetNodeData(Node: PVirtualNode): Pointer;
```

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±—è–∑–∞–Ω –∑–∞–ø–æ–ª–Ω–∏—Ç—å —ç—Ç–æ —Å–≤–æ–π—Å—Ç–≤–æ, –µ—Å–ª–∏ –æ–Ω —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏, –∏–Ω–∞—á–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–æ–æ–±—â–∏—Ç –æ–± –æ—à–∏–±–∫–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

–î–µ–ª–∞–µ—Ç—Å—è —ç—Ç–æ –ø—Ä–µ–¥–µ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ, —Å –ø–æ–º–æ—â—å—é —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –î–µ–ª—å—Ñ–∏–π—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `SizeOf`, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–µ–π —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞ –ø–∞–º—è—Ç–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö. –î–µ–ª–∞—Ç—å —ç—Ç–æ –ª—É—á—à–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–æ—Ä–º—ã –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ `OnCreate`:

```delphi
procedure TfrmMain.FormCreate(Sender: TObject);
begin
  VT.NodeDataSize := SizeOf(TPhoneNode);
end;
```

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç —Ä–∞–≤–µ–Ω 8 –±–∞–π—Ç–∞–º (–ø–æ —á–µ—Ç—ã—Ä–µ –Ω–∞ –∫–∞–∂–¥—ã–π **WideString**).

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–º–µ–ª–æ –∑–∞–ø–æ–ª–Ω—è—Ç—å –Ω–∞—à–µ –¥–µ—Ä–µ–≤–æ —É–∑–ª–∞–º–∏:

```delphi
procedure TfrmMain.BtnAddClick(Sender: TObject);
var
  NewNode: PVirtualNode;
  NewPhone: PPhoneNode;
begin
  NewNode := VT.AddChild(VT.FocusedNode);
  NewPhone := VT.GetNodeData(NewNode);
  if Assigned(NewPhone) then
    with NewPhone^ do
    begin
      Name := EdName.Text;
      Phone := EdPhone.Text;
    end;
end;
```

–í—Å–µ –ø—Ä–æ—Å—Ç–æ: –º—ã –¥–æ–±–∞–≤–ª—è–µ–º –≤–µ—Ç–∫—É, –ø–æ–ª—É—á–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –æ–±–ª–∞—Å—Ç—å –µ–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏ –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —ç—Ç–∏ —Å–∞–º—ã–µ –¥–∞–Ω–Ω—ã–µ.

–ü–æ–∑–∞–±–æ—Ç–∏–º—Å—è –∏ –æ–± —É–¥–∞–ª–µ–Ω–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —É–∑–ª–æ–≤. –¢–∞–∫ –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —É–∑–µ–ª, –∏–º–µ—é—â–∏–π –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ñ–æ–∫—É—Å:

```delphi
procedure TfrmMain.mEntryClick(Sender: TObject);
begin
  VT.DeleteNode(VT.FocusedNode);
end;
```

–ï—Å—Ç—å —Ç–∞–∫–∂–µ —Å–ø–æ—Å–æ–± —É–¥–∞–ª–∏—Ç—å –ª–∏—à—å –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–∑–ª–∞, –æ—Å—Ç–∞–≤–∏–≤ –µ–≥–æ —Å–∞–º–æ–≥–æ:

```delphi
procedure TfrmMain.mChildrenClick(Sender: TObject);
begin
  VT.DeleteChildren(VT.FocusedNode);
end;
```

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ç–µ–ø–µ—Ä—å –∏ –≤—Å—Ç–∞–≤–∫—É –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `InsertNode`:

```delphi
//---------------------------------------------------------------------------
// –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–Ω—ã–º —É–∑–ª–æ–º
//---------------------------------------------------------------------------
procedure TfrmMain.BtnInsertBeforeClick(Sender: TObject);
var
  NewNode: PVirtualNode;
  NewPhone: PPhoneNode;
begin
  NewNode := VT.InsertNode(VT.FocusedNode, amInsertBefore);
  NewPhone := VT.GetNodeData(NewNode);
  if Assigned(NewPhone) then
    with NewPhone^ do
    begin
      Name := EdName.Text;
      Phone := EdPhone.Text;
    end;
end;

//---------------------------------------------------------------------------
// –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —É–∑–ª–∞
//---------------------------------------------------------------------------
procedure TfrmMain.BtnInsertAfterClick(Sender: TObject);
var
  NewNode: PVirtualNode;
  NewPhone: PPhoneNode;
begin
  NewNode := VT.InsertNode(VT.FocusedNode, amInsertAfter);
  NewPhone := VT.GetNodeData(NewNode);
  if Assigned(NewPhone) then
    with NewPhone^ do
    begin
      Name := EdName.Text;
      Phone := EdPhone.Text;
    end;
end;

//---------------------------------------------------------------------------
// –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø–µ—Ä–≤—ã–º –¥–æ—á–µ—Ä–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —É–∑–ª–∞
//---------------------------------------------------------------------------
procedure TfrmMain.BtnChildFirstClick(Sender: TObject);
var
  NewNode: PVirtualNode;
  NewPhone: PPhoneNode;
begin
  NewNode := VT.InsertNode(VT.FocusedNode, amAddChildFirst);
  NewPhone := VT.GetNodeData(NewNode);
  if Assigned(NewPhone) then
    with NewPhone^ do
    begin
      Name := EdName.Text;
      Phone := EdPhone.Text;
    end;
end;

//---------------------------------------------------------------------------
// –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–º –¥–æ—á–µ—Ä–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —É–∑–ª–∞
//---------------------------------------------------------------------------
procedure TfrmMain.BtnChildLastClick(Sender: TObject);
var
  NewNode: PVirtualNode;
  NewPhone: PPhoneNode;
begin
  NewNode := VT.InsertNode(VT.FocusedNode, amAddChildLast);
  NewPhone := VT.GetNodeData(NewNode);
  if Assigned(NewPhone) then
    with NewPhone^ do
    begin
      Name := EdName.Text;
      Phone := EdPhone.Text;
    end;
end;
```

–Ø —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –Ω–µ —Å—Ç–∞–ª —Ä–∞–∑–¥–µ–ª—è—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –Ω–∞ –±–ª–æ–∫–∏ –¥–ª—è –±–æ–ª—å—à–µ–π –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏, –Ω–æ –∑–∞ –í–∞–º–∏ –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–¥–∞—Ç—å –¥–∞–Ω—å –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º—É, –≤—ã–¥–µ–ª–∏–≤ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –±–ª–æ–∫–∏ –∫–æ–¥–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã üòä

###### üí° –ü—Ä–æ–µ–∫—Ç, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π —Ä–∞–±–æ—Ç—É —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ **VT**, –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ª–µ–∂–∏—Ç –≤ –ø–∞–ø–∫–µ *Fig 1.1.*

## 2.3. –û–±–∑–æ—Ä –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.

–î–µ—Ä–µ–≤–æ –∏–∑ –ø—Ä–æ—Å—Ç—ã—Ö –Ω–∞–¥–ø–∏—Å–µ–π –Ω–µ –æ—á–µ–Ω—å-—Ç–æ —Ä–∞–¥—É–µ—Ç –≥–ª–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –î–∞–≤–∞–π—Ç–µ –¥–æ–±–∞–≤–∏–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –Ω–∞—à–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã. –í —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑—É–µ–º –∫–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è —É–∑–ª–æ–≤, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∑–ª–æ–≤ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º **VT**, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, –ø–æ–∏—Å–∫ –ø–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—É –∏ –ø–µ—Ä–µ–±–æ—Ä –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–µ—Ä–µ–≤–∞.

–ü—Ä–æ–¥–æ–ª–∂–∞—è –Ω–∞—à—É —Ç–µ–º—É –∑–∞–ø–∏—Å–Ω–æ–π –∫–Ω–∏–∂–∫–∏, –¥–ª—è –≤—Å–µ–≥–æ —ç—Ç–æ–≥–æ –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è:

```delphi
type
  PPhoneNode = ^TPhoneNode;

  TPhoneNode = record
    Name, // –ü–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞
    Mobile, // –í—Ç–æ—Ä–∞—è –∫–æ–ª–æ–Ω–∫–∞
    HomePhone: WideString; // –≠—Ç–æ –±—É–¥–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç –≤—Ç–æ—Ä–æ–π –∫–æ–ª–æ–Ω–∫–∏
    Enabled, // –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ—Å—Ç–∏
    Editable: Boolean; // –ú–æ–∂–Ω–æ –ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É–∑–µ–ª
    ImageIndex: Integer; // –ò–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ TImageList
    Fg, Bg: TColor; // –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –∏ —Ñ–æ–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å–≤–µ–Ω–Ω–æ
  end;
```

### 2.3.1. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫ —Ä—è–¥–æ–º —Å —É–∑–ª–∞–º–∏.

–ù–∞—á–Ω–µ–º —Å –∫–∞—Ä—Ç–∏–Ω–æ–∫. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ –º—ã —Ö–æ—Ç–∏–º –ø–æ–∑–≤–æ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±—Ä–∞—Ç—å –ø–æ–ª –∫–æ–Ω—Ç–∞–∫—Ç–∞ –∏ –ø—Ä–∏ —ç—Ç–æ–º –º–µ–Ω—è—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–∞ –±–æ–ª–µ–µ —Ç–µ–º–Ω—É—é, –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç *IE* –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –Ω–µ–µ –∫—É—Ä—Å–æ—Ä–æ–º. –ù–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Ç—Ä–∏ `TImageList`, —á—Ç–æ–±—ã –Ω–∞ –∏—Ö –ø—Ä–∏–º–µ—Ä–µ –ø–æ–∫–∞–∑–∞—Ç—å –∫–∞–∫ –≤ **VT** –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ 3-—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –∫–∞—Ä—Ç–∏–Ω–∫–∏ (–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è, –∞–∫—Ç–∏–≤–Ω–∞—è, –≤—ã–∫–ª—é—á–µ–Ω–Ω–∞—è). –ï—Å–ª–∏ –í–∞–º –ª–µ–Ω—å –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–µ–≥–¥–µ –≤–∑—è—Ç—å —Ç–∞–∫–æ–≤—ã–µ, —Ç–æ –º–æ–∂–µ—Ç–µ –∑–∞–±—Ä–∞—Ç—å –∏—Ö –∏–∑ –º–æ–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ *Fig 1.2.*

–ü–æ –∏–¥–µ–µ, –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∫ **VT** –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –≤—Å–µ–º –∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ `Images`. –û–¥–Ω–∞–∫–æ –Ø –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–±–æ—Ç—ã —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º —á–∞—Å—Ç–æ –∑–∞–º–µ—á–∞–ª —Å—Ç—Ä–∞–Ω–Ω—ã–µ –≥–ª—é–∫–∏ –∫–∞—Ä—Ç–∏–Ω–æ–∫, –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Ç–∞–∫–∏–º –º–µ—Ç–æ–¥–æ–º. –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –ø–æ–º–∏–º–æ —ç—Ç–æ–≥–æ –µ—Å—Ç—å —Ç–∞–∫–∂–µ —Å–≤–æ–π—Å—Ç–≤–∞ `StateImages` –∏ `CheckImages`. –ù–∏ –≤ —Ö–µ–ª–ø–µ, –Ω–∏ –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞—Ö –Ω–µ –¥–∞–µ—Ç—Å—è –Ω–∏–∫–∞–∫–æ–π —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –≤—Å–µ–º —ç—Ç–∏–º —Ç—Ä–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º, –ø–æ—ç—Ç–æ–º—É –Ø –Ω–µ –º–æ–≥—É —Ç–æ—á–Ω–æ —Å–∫–∞–∑–∞—Ç—å –≤ –∫–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö –∫–∞–∫–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å. –ü—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–º–Ω–∏—Ç–µ, –µ—Å–ª–∏ –í—ã –∑–∞–º–µ—Ç–∏—Ç–µ –∫–∞–∫–∏–µ-–ª–∏–±–æ —Å—Ç—Ä–∞–Ω–Ω–æ—Å—Ç–∏ –≤ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫, –ø—Ä–æ—Å—Ç–æ –ø–æ–º–µ–Ω—è–π—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ. –í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –Ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å–≤–æ–π—Å—Ç–≤–æ `StateImages`.

–ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É –≤ **VT** –º–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é –¥–≤—É—Ö –ø–æ—á—Ç–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π:

-   `OnGetImageIndex`;

-   `OnGetImageIndexEx`;

–ï—Å–ª–∏ –í—ã –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –∏—Ö –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —Ç–æ –∑–∞–º–µ—Ç–∏—Ç–µ, —á—Ç–æ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ–Ω–∏ –ª–∏—à—å –Ω–∞ –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä: –≤—Ç–æ—Ä–æ–µ —Å–æ–±—ã—Ç–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä `TImageList`, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞—Ä—Ç–∏–Ω–∫–∞. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:

```delphi
procedure TfrmMain.VTGetImageIndexEx(Sender: TBaseVirtualTree;
  Node: PVirtualNode; Kind: TVTImageKind; Column: TColumnIndex;
  var Ghosted: Boolean; var ImageIndex: Integer;
  var ImageList: TCustomImageList);
var
  PhoneNode: PPhoneNode;
begin
  if Column > 0 then
    Exit; // –ö–∞—Ä—Ç–∏–Ω–∫–∞ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–≤–æ–π –∫–æ–ª–æ–Ω–∫–µ
  ImageIndex := -1;
  PhoneNode := VT.GetNodeData(Node);
  if Assigned(PhoneNode) then
  begin
    ImageList := Self.ImageList; // –û–±—ã—á–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏
    // HotNode ‚Äî —É–∑–µ–ª, –Ω–∞–¥ –∫–æ—Ç–æ—Ä—ã–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∫—É—Ä—Å–æ—Ä,
    // —Ç.–µ. –∞–∫—Ç–∏–≤–Ω—ã–π.
    if Node = Sender.HotNode then
      ImageList := ImageListHot; // –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏
    if not PhoneNode^.Enabled then
      ImageList := ImageListDisabled; // –í—ã–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏
    ImageIndex := PhoneNode^.ImageIndex;
  end;
end;
```

–ù–æ –Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ —Ç–∞–∫–∂–µ –∏ –ø—Ä–æ –æ–±—ã—á–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ. –ß–∞—â–µ –≤—Å–µ–≥–æ –µ–≥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–ø–æ–ª–Ω–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.

–ß—Ç–æ–±—ã –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω—É–∂–Ω–æ —Ç–∞–∫–∂–µ –≤–∫–ª—é—á–∏—Ç—å –æ–ø—Ü–∏—é `TreeOptions.PaintOptions.toHotTrack`, —á—Ç–æ–±—ã **VT** –∏–º–µ–ª –¥–æ—Å—Ç—É–ø –∫ `HotNode` —É–∑–ª—É. –¢.–µ. –∫ —É–∑–ª—É, –Ω–∞–¥ –∫–æ—Ç–æ—Ä—ã–º –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç ¬´–∑–∞–≤–∏—Å¬ª –∫—É—Ä—Å–æ—Ä.

### 2.3.2. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ç–µ–ø–µ—Ä—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç. –î–∞–Ω–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–∞ –≤ **VT** –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ, —Ç–æ –µ—Å—Ç—å –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ –æ–±—ã—á–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ —Ç–µ–∫—Å—Ç–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –í–∞–º –∑–∞–ø—Ä–µ—Ç–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º **VT**. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, –æ–Ω –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ä—è–¥–æ–º —Å –æ–±—ã—á–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º. –ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –Ω–∞—à—É —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—É—é –∫–Ω–∏–∂–∫—É. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä—è–¥–æ–º —Å –Ω–æ–º–µ—Ä–æ–º –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É–∫–∞–∑–∞—Ç—å –¥–æ–º–∞—à–Ω–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω. –ü—Ä–∏ —ç—Ç–æ–º –º–æ–±–∏–ª—å–Ω–∏–∫–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ª—é–¥–∏ –º–µ–Ω—è—é—Ç –¥–æ–≤–æ–ª—å–Ω–æ —á–∞—Å—Ç–æ, –∞ –≤–æ—Ç –¥–æ–º–∞—à–Ω–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω –∏–Ω–æ–≥–¥–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ –≤—Å—é –∂–∏–∑–Ω—å. –ò–¥–µ–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Ç–∞–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞. –ü–µ—Ä–µ–ø–∏—à–µ–º —Å–æ–±—ã—Ç–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞:

```delphi
procedure TfrmMain.VTGetText(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex; TextType: TVSTTextType; var CellText: WideString);
var
  PhoneNode: PPhoneNode;
begin
  PhoneNode := VT.GetNodeData(Node);
  if Assigned(PhoneNode) then
    case Column of
      0: // –ò–º—è
        if TextType = ttNormal then
          CellText := PhoneNode^.Name;
      1: // –¢–µ–ª–µ—Ñ–æ–Ω
      case TextType of
        ttNormal: CellText := PhoneNode^.Mobile; // –ú–æ–±–∏–ª—å–Ω—ã–π
        ttStatic: CellText := '(' + PhoneNode^.HomePhone + ')'; // –î–æ–º–∞—à–Ω–∏–π
      end;
    end;
end;
```

–ù–µ –∑–∞–±—É–¥—å—Ç–µ —Ç–∞–∫–∂–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –≤–∫–ª—é—á–∏–≤ –æ–ø—Ü–∏—é –¥–µ—Ä–µ–≤–∞ `toShowStaticText` –∏–∑ `TreeOptions.StringOptions`, —Ç.–∫. –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–Ω–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞.

–¢–∞–∫–∂–µ —ç—Ç–æ —Å–≤–æ–π—Å—Ç–≤–æ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥–æ–π–¥–µ—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å—è–∫–∏—Ö –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –∏–ª–∏ –ø–æ—Å—Ç—Ñ–∏–∫—Å–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –≤–µ–ª–∏—á–∏–Ω —Ä—è–¥–æ–º —Å –∏—Ö —á–∏—Å–ª–æ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º.

### 2.3.3. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞.

–¢–µ–ø–µ—Ä—å –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É. –î–ª—è —Ç–∞–∫–∏—Ö –∑–∞–¥–∞—á –≤ **VT** –∏–º–µ–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–≤—É—Ö —É–∑–ª–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–∂–∞—Ç–∏–π –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ –∫–æ–ª–æ–Ω–æ–∫. –ü–æ–ø—Ä–æ–±—É–µ–º –≤—Å–µ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ.

–î–ª—è –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∞–µ–º —Å–æ–±—ã—Ç–∏–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–≤—É—Ö —É–∑–ª–æ–≤:

```delphi
procedure TfrmMain.VTCompareNodes(Sender: TBaseVirtualTree; Node1,
  Node2: PVirtualNode; Column: TColumnIndex; var Result: Integer);
begin
  Result := WideCompareStr(VT.Text[Node1, Column], VT.Text[Node2, Column]);
end;
```

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂ –Ω–∞ **WinAPI callback** —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏. **VT** —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ—á–Ω–æ —Ç–∞–∫–æ–≥–æ –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–≤—É—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤:

-   **0** ‚Äî –≠–ª–µ–º–µ–Ω—Ç—ã —Ä–∞–≤–Ω—ã, –æ–±–∞ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ.

-   **&lt; 0** ‚Äî –ü–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –±–æ–ª—å—à–µ –≤—Ç–æ—Ä–æ–≥–æ.

-   **&gt; 0** ‚Äî –í—Ç–æ—Ä–æ–π —ç–ª–µ–º–µ–Ω—Ç –±–æ–ª—å—à–µ –ø–µ—Ä–≤–æ–≥–æ.

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –≤—Å–µ –∑–∞ –Ω–∞—Å –¥–µ–ª–∞–µ—Ç –û–° (–≤—ã–±–∏—Ä–∞–µ—Ç –Ω–∞–∏–±–æ–ª—å—à—É—é –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É —Å—Ç—Ä–æ–∫—É). –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –µ—Å–ª–∏ –í–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —É–∑–ª—ã –ø–æ –≤–µ–ª–∏—á–∏–Ω–µ —á–∏—Å–µ–ª, —Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–∏–º–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–π –≤–∏–¥:

```delphi
procedure TfrmMain.VTCompareNodes(Sender: TBaseVirtualTree; Node1,
  Node2: PVirtualNode; Column: TColumnIndex; var Result: Integer);
var
  Data1, Data2: PDataNode;
begin
  Data1 := Sender.GetNodeData(Node1);
  Data2 := Sender.GetNodeData(Node2);
  if Data1^.Value > Data2^.Value then
    Result := 1
  else if Data1^.Value < Data2^.Value then
    Result := -1
  else if Data1^.Value = Data1^.Value then
    Result := 0;
end;
```

–ü–æ–º–Ω–∏—Ç–µ —Ç–∞–∫–∂–µ, —á—Ç–æ –í—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ –ø–æ—Ä—è–¥–∫–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏. –¢.–µ. **VT** —Å–∞–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø–æ—Ä—è–¥–∫–æ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏, –∏ –í–∞–º –Ω–µ –ø—Ä–∏–¥–µ—Ç—Å—è –ø–∏—Å–∞—Ç—å —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π –∫–æ–¥ –¥–≤–∞–∂–¥—ã, –º–µ–Ω—è—è —É—Å–ª–æ–≤–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–µ.

–¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ä–µ–≤–æ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –∫–æ–ª–æ–Ω–∫—É –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–π. –ì—Ä—É–±–æ –≥–æ–≤–æ—Ä—è, –ø—Ä–æ—Å—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç –ü—Ä–æ–≤–æ–¥–Ω–∏–∫ üòä –î–µ–ª–∞–µ—Ç—Å—è —ç—Ç–æ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º:

```delphi
procedure TfrmMain.VTHeaderClick(Sender: TVTHeader; Column: TColumnIndex;
  Button: TMouseButton; Shift: TShiftState; X, Y: Integer);
begin
  if Button = mbLeft then
  begin
    // –ú–µ–Ω—è–µ–º –∏–Ω–¥–µ–∫—Å —Å–æ—Ä—Ç–∏—Ä—É—é—â–µ–π –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ –∏–Ω–¥–µ–∫—Å –∫–æ–ª–æ–Ω–∫–∏,
    // –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –Ω–∞–∂–∞—Ç–∞.
    VT.Header.SortColumn := Column;
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –≤—Å—ë –¥–µ—Ä–µ–≤–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —ç—Ç–æ–π –∫–æ–ª–æ–Ω–∫–∏
    // –∏ –∏–∑–º–µ–Ω—è–µ–º –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–∂–Ω—ã–π
    if VT.Header.SortDirection = sdAscending then
    begin
      VT.Header.SortDirection := sdDescending;
      VT.SortTree(Column, VT.Header.SortDirection);
    end
    else begin
      VT.Header.SortDirection := sdAscending;
      VT.SortTree(Column, VT.Header.SortDirection);
    end;
  end;
end;
```

### 2.3.4. –†–∞–±–æ—Ç–∞ —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º —Ç–µ–∫—Å—Ç–∞.

–ò–¥–µ–º –¥–∞–ª—å—à–µ. –£ `TTreeView` –∏ `TListView` –µ—Å—Ç—å —Ç–∞–∫–∞—è –ø–æ–ª–µ–∑–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å, –∫–∞–∫ –Ω–µ–±–æ–ª—å—à–æ–π –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —É–∑–ª–æ–≤. –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ **VT** –±—ã–ª –±—ã –Ω–µ **VT**, –µ—Å–ª–∏ –±—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª –∏ —ç—Ç—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å üòä

–†–µ–¥–∞–∫—Ç–æ—Ä –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø–æ –∞–¥—Ä–µ—Å—É: `TreeOptions.MiscOptions.toEditable`.

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ–Ω —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–∞–∫–∂–µ, –∫–∞–∫ –∏ –≤ `TTreeView` –∏ `TListView` (–∫–ª–∏–∫ –ø–æ —É–∑–ª—É –∏ –ø–∞—É–∑–∞ –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è).

–° —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º —Å–≤—è–∑–∞–Ω—ã —Ç–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è:

-   **OnEditing** ‚Äî –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ *–ø–µ—Ä–µ–¥* –ø–æ—è–≤–ª–µ–Ω–∏–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞. –° –ø–æ–º–æ—â—å—é —ç—Ç–æ–≥–æ —Å–æ–±—ã—Ç–∏—è –º–æ–∂–Ω–æ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –µ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏–µ –ø–æ —Ç–µ–º –∏–ª–∏ –∏–Ω—ã–º –ø—Ä–∏—á–∏–Ω–∞–º.

-   **OnEdited** ‚Äî –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å—Ä–∞–∑—É –∂–µ –ø–æ—Å–ª–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞.

-   **OnNewText** ‚Äî –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –ø–æ—Å–ª–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –µ–≥–æ (—Ä–µ–¥–∞–∫—Ç–æ—Ä–∞) —Ç–µ–∫—Å—Ç –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω. –° –µ–≥–æ (—Å–æ–±—ã—Ç–∏—è) –ø–æ–º–æ—â—å—é –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ.

-   **OnEditCanceled** ‚Äî –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä –±—ã–ª –∑–∞–∫—Ä—ã—Ç –Ω–∞–∂–∞—Ç–∏–µ–º <kbd>Esc</kbd>.

–í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –¥–≤–∞ –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –ø—Ä–∏–º–µ–Ω—è–µ–º—ã—Ö. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö —Å –Ω–æ–≤—ã–º —Ç–µ–∫—Å—Ç–æ–º:

```delphi
procedure TfrmMain.VTNewText(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex; NewText: WideString);
var
  PhoneNode: PPhoneNode;
begin
  if Length(NewText) = 0 then
    Exit;
  PhoneNode := VT.GetNodeData(Node);
  if Assigned(PhoneNode) then
  begin
    case Column of
      0: PhoneNode^.Name := NewText;
      1: PhoneNode^.Mobile := NewText;
    end;
  end;
end;
```

–¢–µ–ø–µ—Ä—å –º—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∏–ª–∏ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ–ª—è `Editable` –Ω–∞—à–µ–π –∑–∞–ø–∏—Å–∏. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `onEditing`:

```delphi
procedure TfrmMain.VTEditing(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex; var Allowed: Boolean);
var
  PhoneNode: PPhoneNode;
begin
  Allowed := False;
  PhoneNode := VT.GetNodeData(Node);
  if Assigned(PhoneNode) then
    Allowed := PhoneNode^.Editable;
end;
```

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä `EditDelay`. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–∑–ª–∞. –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –æ–¥–Ω–∞ —Å–µ–∫—É–Ω–¥–∞.

### 2.3.5. –ü–æ–∏—Å–∫ –ø–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—É.

–í—ã —É–∂–µ –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ –∑–Ω–∞–∫–æ–º—ã —Å —ç—Ç–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ *Visual Studio* –∏ *Delphi*. –í—ã–≥–ª—è–¥–∏—Ç —ç—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω–æ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º: –í—ã –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≤–≤–æ–¥–∏—Ç–µ –∫–∞–∫–æ–π-—Ç–æ —Ç–µ–∫—Å—Ç –∏ **VT** –ø–æ –º–µ—Ä–µ –≤–≤–æ–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç —É–∑–µ–ª, —Ç–µ–∫—Å—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞–∏–±–æ–ª–µ–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≤–≤–æ–¥–∏–º—ã–º. –í –∫–æ–Ω—Ü–µ-–∫–æ–Ω—Ü–æ–≤, –∫–æ–≥–¥–∞ –í—ã –∑–∞–∫–æ–Ω—á–∏—Ç–µ –≤–≤–æ–¥, –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–º –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –∏—Å–∫–æ–º—ã–π —É–∑–µ–ª –∏–ª–∏ —É–∑–µ–ª, –±–æ–ª–µ–µ-–º–µ–Ω–µ–µ –ø–æ—Ö–æ–∂–∏–π –Ω–∞ –Ω–µ–≥–æ. –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–µ–Ω, –∫–æ–≥–¥–∞ –í—ã –Ω–µ –∑–Ω–∞–µ—Ç–µ —Ç–æ—á–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è –≤–µ—Ç–∫–∏, –∞ —Ç–æ–ª—å–∫–æ –µ–µ —á–∞—Å—Ç—å. –í **VT** –≤—Å—è —ç—Ç–∞ –ø—Ä–µ–ª–µ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–æ–º–æ—â—å—é —Å–æ–±—ã—Ç–∏—è `OnIncrementalSearch`:

```delphi
procedure TfrmMain.VTIncrementalSearch(Sender: TBaseVirtualTree;
  Node: PVirtualNode; const SearchText: WideString; var Result: Integer);
var
  PhoneNode: PPhoneNode;
  Len: Integer;
begin
  Result := 0;
  PhoneNode := VT.GetNodeData(Node);
  if Assigned(PhoneNode) then
  begin
    // –ò—Å–ø–æ–ª—å–∑—É—è StrLIComp, –º—ã –º–æ–∂–µ–º —É–∫–∞–∑–∞—Ç—å –¥–ª–∏–Ω—É —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.
    // –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º—ã —Å–º–æ–∂–µ–º –Ω–∞–π—Ç–∏ —É–∑–ª—ã, —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ —á–∞—Å—Ç–∏—á–Ω–æ.
    Result := StrLIComp(PAnsiChar(AnsiString(SearchText)),
      PAnsiChar(AnsiString(PhoneNode^.Name)),
       Min(Length(SearchText), Length(PhoneNode^.Name)));
  end;
end;
```

–î–ª—è —Ä–∞–±–æ—Ç—ã —Ç–∞–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –Ω–∞–¥–æ —Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–∏—Ç—å **VT** –æ —Ç–æ–º, —á—Ç–æ –º—ã –Ω–∞–ø–∏—Å–∞–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏ –ø–æ–∏—Å–∫ –≤–æ–∑–º–æ–∂–µ–Ω. –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–¥–æ –ø—Ä–∏—Å–≤–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—É `IncrementalSearch` –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∫—Ä–æ–º–µ `isNone`:

-   **isAll** ‚Äî –ø–æ–∏—Å–∫ –≤–æ –≤—Å–µ—Ö —É–∑–ª–∞—Ö.

-   **isInitializedOnly** ‚Äî –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É–∑–ª–∞—Ö. –û —Å–æ–±—ã—Ç–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±—É–¥–µ—Ç —Å–∫–∞–∑–∞–Ω–æ –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –≥–ª–∞–≤–∞—Ö.

-   **isVisibleOnly** ‚Äî –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –≤ –≤–∏–¥–∏–º—ã—Ö —É–∑–ª–∞—Ö. –û —Ç–∞–∫–∏—Ö —É–∑–ª–∞—Ö —Ç–æ–∂–µ –±—É–¥–µ—Ç —Å–∫–∞–∑–∞–Ω–æ —á—É—Ç—å –ø–æ–∑–∂–µ.

–ü–∞—Ä–∞–º–µ—Ç—Ä `IncrementalSearchDirection`, —Å—É–¥—è –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è, –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ (–≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑).

–û—á–µ–Ω—å –≤–∞–∂–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `IncrementalSearchStart`. –û–Ω —É–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –ø–æ–∏—Å–∫–∞. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è:

-   **ssAlwaysStartOver** ‚Äî –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –Ω–∞–∂–∞—Ç–∏–∏ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–æ–∏—Å–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ —Å —Å–∞–º–æ–≥–æ –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–µ—Ä–µ–≤–∞. –ú–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ –Ω–∞–¥–µ–∂–Ω–æ.

-   **ssFocusedNode** ‚Äî –ø–æ–∏—Å–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞. –ö–æ–º–ø—Ä–æ–º–∏—Å—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –º–µ–∂–¥—É –¥–≤—É–º—è –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏.

-   **ssLastHit** ‚Äî —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π, –Ω–æ –Ω–µ —Ç–∞–∫–æ–π –Ω–∞–¥–µ–∂–Ω—ã–π –≤ –ø–ª–∞–Ω–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä. –ü–æ–∏—Å–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.

–ü–∞—Ä–∞–º–µ—Ç—Ä `IncrementalSearchTimeout` ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞—Ç—å –ø–∞—É–∑—É –º–µ–∂–¥—É –¥–≤—É–º—è –Ω–∞–∂–∞—Ç–∏—è–º–∏ –∫–ª–∞–≤–∏—à. –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —ç—Ç–æ–π –ø–∞—É–∑—ã –ø–æ–∏—Å–∫ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.

–ü–æ–∂–∞–ª—É–π, —ç—Ç–æ –≤—Å–µ, —á—Ç–æ –º–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å –æ –ø–æ–∏—Å–∫–µ –ø–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—É. –ß—Ç–æ–±—ã –µ–≥–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å, –∫–ª–∏–∫–Ω–∏—Ç–µ –ø–æ **VT** –∏ –Ω–∞—á–Ω–∏—Ç–µ –Ω–∞–∂–∏–º–∞—Ç—å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è –∫–ª–∞–≤–∏—à.

### 2.3.6. –ü—Ä–æ—Å—Ç–µ–π—à–∏–µ –ø—Ä–∏–µ–º—ã –æ—Ç—Ä–∏—Å–æ–≤–∫–∏.

–ß—Ç–æ –Ø —Ç–∞–º –µ—â–µ –æ–±–µ—â–∞–ª? –ê—Ö, –¥–∞! –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤. –í–æ—Ç –¥–≤–∞ –ø—Ä–∏–º–µ—Ä–∞ –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫—Ä–∞—Å–∏—Ç—å —á–µ—Ä–Ω–æ-–±–µ–ª—ã–µ –±—É–¥–Ω–∏ **VT**.

–ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞:

```delphi
procedure TfrmMain.VTPaintText(Sender: TBaseVirtualTree;
  const TargetCanvas: TCanvas; Node: PVirtualNode; Column: TColumnIndex;
  TextType: TVSTTextType);
var
  PhoneNode: PPhoneNode;
begin
  PhoneNode := VT.GetNodeData(Node);
  if Assigned(PhoneNode) then
    TargetCanvas.Font.Color := PhoneNode^.Fg;
  if (vsSelected in Node.States) and (Sender.Focused) then
    TargetCanvas.Font.Color := clHighlightText;
end;
```

–ò —Ñ–æ–Ω —É–∑–ª–∞:

```delphi
procedure TfrmMain.VTBeforeCellPaint(Sender: TBaseVirtualTree;
  TargetCanvas: TCanvas; Node: PVirtualNode; Column: TColumnIndex;
  CellRect: TRect);
var
  PhoneNode: PPhoneNode;
begin
  PhoneNode := VT.GetNodeData(Node);
  if Assigned(PhoneNode) then
    with TargetCanvas do
    begin
      Brush.Color := PhoneNode^.Bg;
      FillRect(CellRect);
    end;
end;
```

–ê –≤–æ—Ç —Ç–∞–∫ –º–æ–∂–Ω–æ –Ω–∞ —Ñ–æ–Ω–µ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–∞–ø–æ–¥–æ–±–∏–µ Windows –∑–∞–≥–æ–ª–æ–≤–∫–∞:

```delphi
procedure TfrmMain.VTBeforeCellPaint(Sender: TBaseVirtualTree;
  TargetCanvas: TCanvas; Node: PVirtualNode; Column: TColumnIndex;
  CellRect: TRect);
var
  BigGrad, SmallGrad: TRect;
begin
  if Column = 0 then
  begin
    BigGrad := CellRect;
    Dec(BigGrad.Bottom, 2);
    SmallGrad := BigGrad;
    SmallGrad.Top := SmallGrad.Bottom;
    Inc(SmallGrad.Bottom, 2);
    GradFill(TargetCanvas.Handle, BigGrad, clInactiveCaptionText, clWindow, gkHorz);
    GradFill(TargetCanvas.Handle, SmallGrad, clHighlight, clWindow, gkHorz);
  end;
end;
```

–ü—Ä–æ—Ü–µ–¥—É—Ä—É –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–π –∑–∞–ª–∏–≤–∫–∏ –º–æ–∂–Ω–æ –≤–∑—è—Ç—å –∏–∑ –≤—Å–µ —Ç–æ–≥–æ –∂–µ –ø—Ä–æ–µ–∫—Ç–∞ Figure 1.2.

### 2.3.7. –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä –≤—Å–µ—Ö —É–∑–ª–æ–≤ –¥–µ—Ä–µ–≤–∞.

–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω–æ–π –≥–ª–∞–≤—ã –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–±–æ—Ä –≤—Å–µ—Ö —É–∑–ª–æ–≤ **VT**.

```delphi
procedure TfrmMain.BtnFindClick(Sender: TObject);

  function FindNode(ANode: PVirtualNode;
    const APattern: WideString): PVirtualNode;
  var
    NextNode: PVirtualNode;
    PhoneNode: PPhoneNode;
  begin
    Result := nil;
    NextNode := ANode.FirstChild;
    if Assigned(NextNode) then
      repeat
        PhoneNode := VT.GetNodeData(NextNode);
        if Assigned(PhoneNode) then
          if RbName.Checked then
            if PhoneNode^.Name = APattern then
            begin
              Result := NextNode;
              Exit;
            end
            else
          else
            if PhoneNode^.Mobile = APattern then
            begin
              Result := NextNode;
              Exit;
            end;
        // –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö –≤–µ—Ç–∫–∞—Ö
        Result := FindNode(NextNode, APattern);
        // –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª—è —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞
        // –±—ã–ª –Ω–∞–π–¥–µ–Ω –Ω—É–∂–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç, –∏–Ω–∞—á–µ, –¥–∞–∂–µ –µ—Å–ª–∏
        // —ç–ª–µ–º–µ–Ω—Ç –±—ã–ª –Ω–∞–π–¥–µ–Ω, —Ç–æ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–∏—Å–∫–∞ –±—É–¥–µ—Ç
        // –≤–æ–∑–≤—Ä–∞—â–µ–Ω nil, –ø–æ—Å–∫–æ–ª—å–∫—É –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤—ã–∑–æ–≤–∞
        // –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Å—Ç–æ–∏—Ç  Result := nil;
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–Ω–µ—Å –ö—Ä–∏–≤–æ–∂–∏—Ö–∞ –ú–∞–∫—Å–∏–º (airmax@fitbmk.cdu.edu.ua),
        // –∑–∞ —á—Ç–æ –µ–º—É —Å–ø–∞—Å–∏–±–æ.
        if Result = nil then
          // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–æ—Å–µ–¥–Ω—é—é –≤–µ—Ç–∫—É...
        NextNode := NextNode.NextSibling;
      until
        //...–ø–æ–∫–∞ –Ω–µ –≤–º–∞–∂–µ–º—Å—è –ª–±–æ–º –≤ —Å—Ç–µ–Ω—É üòä
        NextNode = nil;
  end;

var
  FoundNode: PVirtualNode;
begin
  if VT.RootNodeCount > 0 then
  begin
    FoundNode := FindNode(VT.RootNode, EdSearch.Text);
    LoadNode(FoundNode);
    if Assigned(FoundNode) then
    begin
      VT.ClearSelection;
      VT.FocusedNode := FoundNode;
      Include(VT.FocusedNode.States, vsSelected);
    end;
  end;
end;
```

–ó–¥–µ—Å—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∑–∞–º–µ—Ç–Ω–æ –µ—â–µ –æ–¥–Ω–æ –º–∞–ª–µ–Ω—å–∫–æ–µ –Ω–µ—É–¥–æ–±—Å—Ç–≤–æ. –í —Å–≤—è–∑–∏ —Å —Ç–µ–º, —á—Ç–æ **VT** —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å–ø–∏—Å–∫–∞–º–∏, –í—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∫–∏ —Ü–∏–∫–ª `for`. –û—Å—Ç–∞—é—Ç—Å—è –ª–∏—à—å —Ü–∏–∫–ª—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞–≤–µ—Ä—Ö—É (`while`) –∏ –≤–Ω–∏–∑—É (`repeat`..`until`).

###### üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ

**üë®‚ÄçüíªRA** –Ω–∞—à–µ–ª –≤–µ—Å—å–º–∞ –Ω–µ–æ–±—ã—á–Ω–æ–µ, –Ω–æ —Ä–∞–±–æ—á–µ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ü–∏–∫–ª–∞ `for`. –ü–µ—Ä–µ–¥–∞—é –µ–º—É —Å–ª–æ–≤–æ:

```delphi
var
  I: Integer;
  PNode: PVirtualNode;
  Data: utilUnit.PVSTRecord;
begin
   for I := 0 to VST.TotalCount - 1 do
   begin
     if I <> 0 then
       PNode := VST.GetNext(PNode)
     else
       PNode := VST.GetFirst;
     Data := VST.GetNodeData(PNode);
     // –î–µ–ª–∞—é —á—Ç–æ —Ö–æ—á—É üòä
   end;
end;
```

### 2.3.8. –§—É–Ω–∫—Ü–∏–∏, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–µ VT –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –¥–µ—Ä–µ–≤—É.

–í —Å–≤—è–∑–∏ —Å —Ç–µ–º, —á—Ç–æ **VT** –æ–ø–µ—Ä–∏—Ä—É–µ—Ç —É–∑–ª–∞–º–∏ –∫–∞–∫ —Å–≤—è–∑–∞–Ω–Ω—ã–º —Å–ø–∏—Å–∫–æ–º (–∫–∞–∂–¥—ã–π —É–∑–µ–ª —Å–∞–º –ø–æ —Å–µ–±–µ –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–º —Å–ø–∏—Å–∫–æ–º), –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ –¥–ª—è –ø—Ä–æ—Ö–æ–¥–∞ –ø–æ –¥–µ—Ä–µ–≤—É –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è, –ø—Ä–µ–≤—Ä–∞—Ç–∏–≤—à–∏—Å—å –≤ —É—Ç–æ–º–∏—Ç–µ–ª—å–Ω—É—é —Ä—É—Ç–∏–Ω—É. –ö —Å—á–∞—Å—Ç—å—é, –≤ **VT** –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω —Ä—è–¥ –æ—á–µ–Ω—å —É–¥–æ–±–Ω—ã—Ö –∏ –ø–æ–ª–µ–∑–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –ø—Ä–æ—Ö–æ–¥–∞ –ø–æ –¥–µ—Ä–µ–≤—É, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç —ç—Ç—É –∑–∞–¥–∞—á—É –≤ –ø–∞—Ä—É –Ω–∞–∂–∞—Ç–∏–π –∫–ª–∞–≤–∏—à. –ò—Ö –æ–∫–æ–ª–æ 30 (!) –∏ —É–∂ —Å –Ω–∏–º–∏ –í—ã —Ç–æ—á–Ω–æ –Ω–µ –∑–∞–±–ª—É–¥–∏—Ç–µ—Å—å.

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —ç—Ç–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å), –ø—Ä–∏–Ω—Ü–∏–ø–æ–º —Ä–∞–±–æ—Ç—ã –∏ –µ–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.

-   **GetFirst**, **GetLast** `(Node: PVirtualNode = nil)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å–∞–º—ã–π –ø–µ—Ä–≤—ã–π –∏–ª–∏ —Å–∞–º—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–∑–µ–ª –¥–µ—Ä–µ–≤–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ. –°–∞–º—ã–π –ø–µ—Ä–≤—ã–π —É–∑–µ–ª ‚Äî —É–∑–µ–ª `RootNode.FirstChild`. –≠—Ç–æ –∫–æ—Ä–Ω–µ–≤–æ–π —É–∑–µ–ª —Å –Ω—É–ª–µ–≤—ã–º –∏–Ω–¥–µ–∫—Å–æ–º –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ `RootNode`. –°–∞–º—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–∑–µ–ª ‚Äî —Å–∞–º—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª —É —Å–∞–º–æ–≥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —É–∑–ª–∞. –§—É–Ω–∫—Ü–∏—è `GetLast` –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å —É–∑–µ–ª –≤ –∫–∞—á–µ—Å—Ç–≤–µ –≤—Ö–æ–¥–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞. –ï—Å–ª–∏ —Ç–∞–∫–æ–≤–æ–π –±—É–¥–µ—Ç —É–∫–∞–∑–∞–Ω, —Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω–µ—Ç —Å–∞–º—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–∑–µ–ª –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É.

-   **GetFirstChecked** `(State: TCheckState)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—ã–π –ø–æ–ø–∞–≤—à–∏–π—Å—è —É–∑–µ–ª, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–º–µ—Ç–∫–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –≤–æ –≤—Ö–æ–¥–Ω–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–µ.

-   **GetFirstChild** `(Node: PVirtualNode)`, `GetLastChild (Node: PVirtualNode)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø–µ—Ä–≤—ã–π –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —É–∑–ª–∞, —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤–æ –≤—Ö–æ–¥–Ω–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

-   **GetFirstCutCopy** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—ã–π –ø–æ–ø–∞–≤—à–∏–π—Å—è —É–∑–µ–ª, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –≤—ã—Ä–µ–∑–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.

-   **GetFirstInitialized**, **GetLastInitialized** `(Node: PVirtualNode = nil)` ‚Äî –ø–µ—Ä–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—ã–π –ø–æ–ø–∞–≤—à–∏–π—Å—è —É–∑–µ–ª, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–ª–∞–≥ `vsInitialized`, —Ç.–µ. –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –í—Ç–æ—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∞–º—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–∑–µ–ª —Å `vsInitialized` —Ñ–ª–∞–≥–æ–º –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É —É–∑–ª—É, —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –≤–æ –≤—Ö–æ–¥–Ω–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–µ.

-   **GetFirstNoInit**, **GetLastNoInit** `(Node: PVirtualNode = nil)` ‚Äî —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, —Ç–æ–ª—å–∫–æ –¥–µ–ª–∞—é—Ç –≤—Å–µ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –Ω–∞–æ–±–æ—Ä–æ—Ç.

-   **GetFirstSelected** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—ã–π –ø–æ–ø–∞–≤—à–∏–π—Å—è —É–∑–µ–ª, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–ª–∞–≥ `vsSelected`, —Ç.–µ. –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–º –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç.

-   **GetFirstVisible**, **GetLastVisible** `(Node: PVirtualNode = nil)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø–µ—Ä–≤—ã–π –ø–æ–ø–∞–≤—à–∏–π—Å—è –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–∑–µ–ª, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–ª–∞–≥ `vsVisible` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, —Ç.–µ. –∫–æ—Ç–æ—Ä—ã–π –≤–∏–¥–µ–Ω –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç. –í—Ç–æ—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —É–∑–µ–ª –≤–æ –≤—Ö–æ–¥–Ω–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω –ø–æ–∏—Å–∫ —É–∑–ª–∞.

-   **GetFirstVisibleNoInit**, **GetLastVisibleNoInit** `(Node: PVirtualNode = nil)` ‚Äî —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–æ –ø–æ–∏—Å–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —É–∑–ª–∞—Ö –±–µ–∑ —Ñ–ª–∞–≥–∞ `vsInitialized`.

-   **GetFirstVisibleChild** `(Node: PVirtualNode)`, **GetLastVisibleChild** `(Node: PVirtualNode)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø–µ—Ä–≤—ã–π –ø–æ–ø–∞–≤—à–∏–π—Å—è –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —É–∑–ª–∞, —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤–æ –≤—Ö–æ–¥–Ω–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–µ, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–µ–ª–µ–Ω –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

-   **GetFirstVisibleChildNoInit** `(Node: PVirtualNode)`, **GetLastVisibleChildNoInit** `(Node: PVirtualNode)` ‚Äî —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–æ –ø–æ–∏—Å–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —É–∑–ª–∞—Ö –±–µ–∑ —Ñ–ª–∞–≥–∞ `vsInitialized`.

-   **GetNext** `(Node: PVirtualNode)`, **GetPrevious** `(Node: PVirtualNode)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å–ª–µ–¥—É—é—â–∏–π –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —É–∑–ª—ã, —Å–º–µ–∂–Ω—ã–µ (—Å–æ—Å–µ–¥–Ω–∏–µ) —Å —É–∑–ª–æ–º, —É–∫–∞–∑–∞–Ω–Ω–æ–º –≤–æ –≤—Ö–æ–¥–Ω–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–µ. –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç –ø–æ—á—Ç–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã—Ö `GetNextSibling` –∏ `GetPreviousSibling`. –í —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É —É–∑–ª—É –±–æ–ª—å—à–µ –Ω–µ—Ç —Å–æ—Å–µ–¥–µ–π, —Ç–æ `GetNext` –≤–µ—Ä–Ω–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª, —Å–º–µ–∂–Ω—ã–π —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º —É–∑–ª–æ–º, –∞ `GetPrevious` –≤–µ—Ä–Ω–µ—Ç —Å–∞–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —É–∑–µ–ª –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É. –¢–∞–∫–∂–µ –µ—Å–ª–∏ —É —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞ –µ—Å—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã, —Ç–æ `GetNext` –≤–µ—Ä–Ω–µ—Ç –ø–µ—Ä–≤—ã–π –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª, –∞ `GetPrevious` —Å–∞–º—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —É–∑–ª–∞. –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ, —Å–æ —Å–ª–æ–≤ —ç—Ç–æ –¥–æ–≤–æ–ª—å–Ω–æ —Ç—Ä—É–¥–Ω–æ –ø–æ–Ω—è—Ç—å, –ø—Ä–æ—Å—Ç–æ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–ø—Ä–∏–º–µ–Ω—è—Ç—å —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ.

-   **GetNextChecked** `(Node: PvirtualNode; State: TCheckState = csCheckedNormal)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É —Å –æ—Ç–º–µ—Ç–∫–æ–π, —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ–π —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤–æ –≤—Ö–æ–¥–Ω–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–µ.

-   **GetNextCutCopy** `(Node: PVirtualNode)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–ª—è –≤—ã—Ä–µ–∑–∞–Ω–∏—è –∏–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –¢.–µ. —É–∑–µ–ª, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ñ–ª–∞–≥ `vsCutOrCopy`.

-   **GetNextInitialized** `(Node: PVirtualNode)`, **GetPreviousInitialized** `(Node: PVirtualNode)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å–ª–µ–¥—É—é—â–∏–π –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–∑–ª—ã –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –≤–æ –≤—Ö–æ–¥–Ω–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

-   **GetNextNoInit** `(Node: PVirtualNode)`, **GetPreviousNoInit** `(Node: PVirtualNode)` ‚Äî —Ç–æ–∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –∏ `GetNext`. –û—Ç–ª–∏—á–∏–µ –≤ —Ç–æ–º, —á—Ç–æ –ø—Ä–∏ `GetNext` —É–∑–ª—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è, –∞ –ø—Ä–∏ `GetNextNoInit` ‚Äî –Ω–µ—Ç (—Å–ø–∞—Å–∏–±–æ **üë®‚Äçüíªforever** –∑–∞ –ø–æ–¥—Å–∫–∞–∑–∫—É).

-   **GetNextSelected** `(Node: PVirtualNode)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π —É–∑–µ–ª –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –≤–æ –≤—Ö–æ–¥–Ω–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–µ.

-   **GetNextSibling** `(Node: PVirtualNode)`, **GetPreviousSibling** `(Node: PVirtualNode)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å–ª–µ–¥—É—é—â–∏–π —Å–æ—Å–µ–¥–Ω–∏–π —É–∑–µ–ª –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –≤–æ –≤—Ö–æ–¥–Ω–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–µ. –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç `GetNext` –∏ `GetPrevious` —Ç–µ–º, —á—Ç–æ –Ω–∏–∫–∞–∫–∏—Ö –ø–µ—Ä–µ—Å–∫–æ–∫–æ–≤ —á–µ—Ä–µ–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ —É–∑–ª—ã –Ω–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è. –î–∏–∞–ø–∞–∑–æ–Ω –¥–µ–π—Å—Ç–≤–∏—è —Ñ—É–Ω–∫—Ü–∏–π –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–æ—á–µ—Ä–Ω–∏–º–∏ —É–∑–ª–∞–º–∏. –ï—Å–ª–∏ —Å–æ—Å–µ–¥–Ω–∏—Ö —É–∑–ª–æ–≤ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç, —Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–µ—Ä–Ω—É—Ç `nil`.

-   **GetNextVisible** `(Node: PVirtualNode)`, **GetPreviousVisible** `(Node: PVirtualNode)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å–ª–µ–¥—É—é—â–∏–π –≤–∏–¥–∏–º—ã–π —É–∑–µ–ª –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –≤–æ –≤—Ö–æ–¥–Ω–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–µ. –¢.–µ. —É–∑–µ–ª, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ñ–ª–∞–≥ `vsVisible`.

-   **GetNextVisibleNoInit** `(Node: PVirtualNode)`, **GetPreviousVisibleNoInit** `(Node: PVirtualNode)` ‚Äî —Ç–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ –ø–æ–∏—Å–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —É–∑–ª–∞—Ö –±–µ–∑ `vsInitialized` —Ñ–ª–∞–≥–∞.

-   **GetNextVisibleSibling** `(Node: PVirtualNode)`, **GetPreviousVisibleSibling** `(Node: PVirtualNode)` ‚Äî —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –∏ `GetNextVisible` –∏ `GetPreviousSibling`, –Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ —Ç–æ–ª—å–∫–æ —Å–æ—Å–µ–¥–Ω–∏–º–∏ —É–∑–ª–∞–º–∏ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É.

-   **GetNextVisibleSiblingNoInit** `(Node: PVirtualNode)`, **GetPreviousVisibleSiblingNoInit** `(Node: PVirtualNode)` ‚Äî —Ç–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ –ø–æ–∏—Å–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —É–∑–ª–∞—Ö –±–µ–∑ `vsInitialized` —Ñ–ª–∞–≥–∞.

-   **GetSortedCutCopySet** `(Resolve: Boolean)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —É–∑–ª–æ–≤, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –¥–ª—è –≤—ã—Ä–µ–∑–∞–Ω–∏—è –∏–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞. –ï—Å–ª–∏ –≤—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä —Ä–∞–≤–µ–Ω `True`, —Ç–æ –≤ –º–∞—Å—Å–∏–≤ –Ω–µ –±—É–¥—É—Ç –≤–∫–ª—é—á–µ–Ω—ã –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã –≤—ã—Ä–µ–∑–∞–µ–º—ã—Ö –∏–ª–∏ –∫–æ–ø–∏—Ä—É–µ–º—ã—Ö —É–∑–ª–æ–≤. –£–∑–ª—ã —Ä–∞—Å–ø–æ–ª–∞–≥–∞—é—Ç—Å—è –≤ –º–∞—Å—Å–∏–≤–µ –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Ö –ø–æ—è–≤–ª–µ–Ω–∏—è –≤ –¥–µ—Ä–µ–≤–µ.

-   **GetSortedSelection** `(Resolve: Boolean)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤. –û—á–µ–Ω—å –≤–∞–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Drag&Drop –æ–ø–µ—Ä–∞—Ü–∏–π —Å –¥–µ—Ä–µ–≤–æ–º.

–°—Ç–æ–∏—Ç —É–ø–æ–º—è–Ω—É—Ç—å –æ–± –µ—â–µ –æ–¥–Ω–æ–π –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ—Ö–æ–¥–∞ –ø–æ –¥–µ—Ä–µ–≤—É ‚Äî `IterateSubtree`.

```delphi
function TBaseVirtualTree.IterateSubtree(Node: PVirtualNode; Callback: TVTGetNodeProc; Data: Pointer; Filter: TVirtualNodeStates = []; DoInit: Boolean = False; ChildNodesOnly: Boolean = False): PVirtualNode;
```

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±–µ–∑ –æ—Å–æ–±—ã—Ö –∑–∞–±–æ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–π—Ç–∏—Å—å –ø–æ –≤—Å–µ–º —É–∑–ª–∞–º –¥–µ—Ä–µ–≤–∞ –∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–∞–∫–æ–µ-—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ, –∏—Å–ø–æ–ª—å–∑—É—è **callback**-–ø—Ä–æ—Ü–µ–¥—É—Ä—É. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, —Å –ø–æ–º–æ—â—å—é —Ñ–∏–ª—å—Ç—Ä–∞ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥–ª—è –∫–∞–∫–∏—Ö –∏–º–µ–Ω–Ω–æ —É–∑–ª–æ–≤ –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å **callback**-–ø—Ä–æ—Ü–µ–¥—É—Ä—É. `Node` –∑–∞–¥–∞–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã–π —É–∑–µ–ª, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞—á–Ω–µ—Ç—Å—è –ø—Ä–æ—Ö–æ–¥ –ø–æ –¥–µ—Ä–µ–≤—É. `DoInit` –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω–æ –ª–∏ –ø—Ä–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É–∑–µ–ª –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –≤—ã–∑—ã–≤–∞—Ç—å **callback**-–ø—Ä–æ—Ü–µ–¥—É—Ä—É –¥–ª—è –Ω–µ–≥–æ. `ChildNodesOnly` –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É–µ—Ç –ª–∏ –≤—ã–∑—ã–≤–∞—Ç—å **callback**-–ø—Ä–æ—Ü–µ–¥—É—Ä—É –¥–ª—è –≤—Å–µ—Ö —É–∑–ª–æ–≤ –∏–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ—á–µ—Ä–Ω–∏—Ö. –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–∑–µ–ª, –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π **callback**-–ø—Ä–æ—Ü–µ–¥—É—Ä–æ–π.

–°–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Å—á–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤ –≤ –¥–µ—Ä–µ–≤–µ —Å –ø–æ–º–æ—â—å—é `IterateSubtree`.

```delphi
procedure TForm1.IterateNodes(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Data: Pointer; var Abort: Boolean);
begin
  Inc(PInteger(Data)^);
end;

procedure TForm1.VTChange(Sender: TBaseVirtualTree; Node: PVirtualNode);
var
  Sel: Integer;
begin
  Sel := 0;
  VT.IterateSubtree(nil, IterateNodes, @Sel, [vsSelected], False, False);
  Lbl.Caption := '–í—ã–±—Ä–∞–Ω–æ: ' + IntToStr(Sel);
end;
```

–ö–∞–∫ –≤–∏–¥–∏—Ç–µ, **callback**-–ø—Ä–æ—Ü–µ–¥—É—Ä–∞ —Ç–∞–∫–∂–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∫–∞–∫—É—é-–Ω–∏–±—É–¥—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `Abort` –≤ `True`, —Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ—Ö–æ–¥–∞ –ø–æ –¥–µ—Ä–µ–≤—É –ø—Ä–µ—Ä–≤–µ—Ç—Å—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ü–∏–∫–ª–∞ –ø–æ–∏—Å–∫–∞.

###### üí° –ü—Ä–æ–µ–∫—Ç, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π —Ä–∞–±–æ—Ç—É —Å –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏ **VT**, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ *Fig 1.2.*

–í —ç—Ç–æ–π —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å—à–æ–π –≥–ª–∞–≤–µ –º—ã —Ä–∞–∑–æ–±—Ä–∞–ª–∏—Å—å —Å –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏ –∏ –º–µ—Ç–æ–¥–∞–º–∏ **VT**. –ù–æ —ç—Ç–æ –µ—â–µ –¥–∞–ª–µ–∫–æ –Ω–µ –∫–æ–Ω–µ—Ü. –î–∞–ª–µ–µ –º—ã –µ—â–µ –±–æ–ª—å—à–µ —É–≥–ª—É–±–∏–º—Å—è –≤ –Ω–µ–¥—Ä–∞ **VT** –∏ —Ä–µ–∞–ª–∏–∑—É–µ–º –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –≤–µ—â–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ Drag&Drop, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —à–µ–ª–ª–æ–º, —Ä–∞–±–æ—Ç—É —Å –±—É—Ñ–µ—Ä–æ–º –æ–±–º–µ–Ω–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫—É –¥–µ—Ä–µ–≤–∞ –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.

## 3.0. –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Drag&Drop, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —à–µ–ª–ª–æ–º, —Ä–∞–±–æ—Ç–∞ —Å –±—É—Ñ–µ—Ä–æ–º –æ–±–º–µ–Ω–∞.

–ë–µ—Å—Å–ø–æ—Ä–Ω–æ, –Ω–∞ –ª–∞–≤—Ä—ã –æ–¥–Ω–æ–π –∏–∑ —Å–∞–º—ã—Ö —É–¥–æ–±–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –∫–æ—Ç–æ—Ä–∞—è –∫–æ–≥–¥–∞-–ª–∏–±–æ –±—ã–ª–∞ –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∞, –∏–º–µ–µ—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è –ø—Ä–µ—Ç–µ–Ω–¥–æ–≤–∞—Ç—å Drag&Drop (–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º, –ø–æ–∂–∞–ª—É–π, –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞ üñ±Ô∏è), –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –≤—ã–ø–æ–ª–Ω—è—Ç—å –º–Ω–æ–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø—Ä–æ—Å—Ç—ã–º–∏ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è–º–∏ –º—ã—à–∫–æ–π. –ò –æ–Ω–∞ –∂–µ —Å–∞–º–∞—è –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω–∞—è –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—á–∞.

**VT** –≤ —ç—Ç–æ–º –ø–ª–∞–Ω–µ –Ω–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ. –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Drag&Drop —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏, —Å–≤–æ–π—Å—Ç–≤–∞–º–∏ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏, –Ω–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –¥–µ–ª–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —á–∞—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å–∞–º–∏–º.

## 3.1. –ü–æ–¥—Ö–æ–¥—ã –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Drag&Drop.

**VT** –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Drag&Drop –¥–≤—É–º—è –±–∞–∑–æ–≤—ã–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏ (—Å–≤–æ–π—Å—Ç–≤–æ `DragType`):

-   **dtOLE** ‚Äî –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö –∏ —Ñ—É–Ω–∫—Ü–∏—è—Ö, —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ *ActiveX*. –ù–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é, —Ç.–∫. –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Windows –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —Å –º–∏–Ω–∏–º—É–º–æ–º –ø—Ä–æ–±–ª–µ–º. –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Windows-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã `IDataObject`, `IDragManager` –∏ —Ç.–¥.

-   **dtVCL** ‚Äî –ø–æ–¥—Ö–æ–¥, –Ω–∞–≤—è–∑–∞–Ω–Ω—ã–π Borland —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Ä–∞–¥–∏ –æ–±–ª–µ–≥—á–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –ü—Ä–æ –Ω–µ–≥–æ –º–æ–∂–Ω–æ —Ç–æ—á–Ω–æ —Å–∫–∞–∑–∞—Ç—å: –æ–¥–Ω–æ –ª–µ—á–∏—Ç, –∞ –¥—Ä—É–≥–æ–µ –∫–∞–ª–µ—á–∏—Ç. –ì–ª–∞–≤–Ω—ã–π –µ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –≤ —Ç–æ–º, —á—Ç–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª–µ–µ –ø–æ–ª–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ–± –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ –∏ –µ–≥–æ –¥–∞–Ω–Ω—ã—Ö. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤ –Ω–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Drag&Drop –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏. –í—Å–µ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –í–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã. –í —Ä—è–¥–µ —Å–ª—É—á–∞–µ–≤ —ç—Ç–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å –ø—Ä–æ—Ä–≤—É –∫–æ–¥–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –æ—Ç–¥–µ–ª–∏—Ç—å –æ–¥–∏–Ω –∫–ª–∞—Å—Å –æ—Ç –¥—Ä—É–≥–æ–≥–æ. –Ø —É–∂–µ –∏ –Ω–µ –≥–æ–≤–æ—Ä—é –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö –∏—Ö –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–ª–∏—á–∏—è. –°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –∏–∑–±–µ–≥–∞—Ç—å **VCL** –ø–æ–¥—Ö–æ–¥. –û–Ω —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è Drag&Drop –≤–æ–≤—Å–µ.

–î—É–º–∞—é, —Å–ª–µ–¥—É–µ—Ç –ø–æ–±–æ–ª—å—à–µ —Å–∫–∞–∑–∞—Ç—å –æ –≤—ã–±–æ—Ä–µ –∏–∑ —ç—Ç–∏—Ö –¥–≤—É—Ö –º–µ—Ç–æ–¥–æ–≤.

**OLE** –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ª—é–±—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –≤ —Ç–æ–º —á–∏—Å–ª–µ –∏ –∏–∑ —Å–≤–æ–µ–≥–æ. –ü—Ä–∏—á–µ–º **VT** –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ **OLE** —Å–ø–æ—Å–æ–±–µ–Ω —Ç–∞–∫–∂–µ –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –∏–∑ **VCL** –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ Delphi, –æ–±—É—á–µ–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ **VCL** Drag&Drop –æ—Ç Borland.

**VCL** –ø–æ–∑–≤–æ–ª—è–µ—Ç **VT** –æ–±—â–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —Å –∫–æ–Ω—Ç—Ä–æ–ª–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **VCL** –ø–æ–¥—Ö–æ–¥. –ù–æ —ç—Ç–æ, —Ç–µ–º –Ω–µ –º–µ–Ω–µ–µ, –Ω–µ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ **VT** –Ω–µ –±—É–¥–µ—Ç —Å–ø–æ—Å–æ–±–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Å **OLE** –¥–∞–Ω–Ω—ã–º–∏, –µ—Å–ª–∏ –µ–º—É –≤—ã—Å—Ç–∞–≤–∏—Ç—å `dtVCL` —Å–≤–æ–π—Å—Ç–≤–æ.

–¢–æ–≥–¥–∞ –∑–∞—á–µ–º —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `DragType` –≤–æ–æ–±—â–µ, —Å–ø—Ä–æ—Å–∏—Ç–µ –í—ã, –µ—Å–ª–∏ –æ–Ω –≤—Å–µ —Ä–∞–≤–Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç? –°–µ–π—á–∞—Å –≤—Å–µ —Å—Ç–∞–Ω–µ—Ç —è—Å–Ω–æ.

## 3.2. –û–ø—Ü–∏—è toAcceptOLEDrop.

–î–∞–Ω–Ω—ã–π —Å–µ—Ç—Ç–∏–Ω–≥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ TreeOptions.MiscOptions. –û–Ω –∫–∞–∫ —Ä–∞–∑ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∏–ª–∏ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –≤—Å—Ç–∞–≤–∫—É **OLE** –¥–∞–Ω–Ω—ã—Ö. –ï—Å–ª–∏ –æ–ø—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞, —Ç–æ –¥–µ—Ä–µ–≤–æ —Å `dtOLE` –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –≤–æ–æ–±—â–µ –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å Drag&Drop, —Ç–æ–≥–¥–∞ –∫–∞–∫ `dtVCL`-–¥–µ—Ä–µ–≤–æ –±—É–¥–µ—Ç –µ—â–µ —Å–ø–æ—Å–æ–±–Ω–æ –∫ **VCL** Drag&Drop –≤ –í–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ï—Å–ª–∏ –∂–µ –æ–ø—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞, —Ç–æ –¥–µ—Ä–µ–≤–æ –±—É–¥–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª—é–±—ã–º —Ç–∏–ø–æ–º Drag&Drop. –í—Å–µ —ç—Ç–æ —Å—Ç–∞–Ω–µ—Ç –í–∞–º –µ—â–µ –±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–æ, –∫–æ–≥–¥–∞ –º—ã –Ω–∞–ø–∏—à–µ–º –ø—Ä–∏–º–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π, –∫—Å—Ç–∞—Ç–∏, –±—É–¥–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ–±–∞ —ç—Ç–∏—Ö –ø–æ–¥—Ö–æ–¥–∞.

## 3.3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Drag&Drop.

–ü–æ–º–∏–º–æ `DragType`, **VT** –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø–µ—Ä–∞—Ü–∏–∏. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –∏—Ö:

-   **ClipboardFormats** ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ —Ñ–æ—Ä–º–∞—Ç–æ–≤, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–µ–º—ã—Ö **VT** –¥–ª—è **OLE** –º–µ—Ç–æ–¥–∞ (–í **VCL** –≤—Å–µ –ø—Ä–∏–¥–µ—Ç—Å—è –¥–µ–ª–∞—Ç—å —Ä—É—á–∫–∞–º–∏). –ö–∞–∫ –º–∏–Ω–∏–º—É–º, –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω *Plain Text* –∏ *Virtual Tree Data.*

-   **DefaultPasteMode** ‚Äî –ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤—Å—Ç–∞–≤–ª—è–µ–º–æ–π –≤–µ—Ç–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

-   **DragWidth, DragHeight** ‚Äî —Ä–∞–∑–º–µ—Ä—ã –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏, –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–µ–π –∫—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤. –ß–µ–º –±–æ–ª—å—à–µ —Ä–∞–∑–º–µ—Ä, —Ç–µ–º –±–æ–ª—å—à–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –º–æ—â–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –¥–ª—è –æ–±—Å—á–µ—Ç–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏.

-   **DragImageKind** ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –±—É–¥—É—Ç –ª–∏ –≤ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–∞—Ä—Ç–∏–Ω–∫–∏ —É–∑–ª–æ–≤ **VT**.

-   **DragMode** ‚Äî –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –Ω–∞—á–Ω–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ `dmAutomatic` –∏–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏ `dmManual`. –¢–æ–ª—å–∫–æ –Ω–µ –ø–æ–¥—É–º–∞–π—Ç–µ, —á—Ç–æ dmAutomatic –≤—Å–µ —Å–¥–µ–ª–∞–µ—Ç –∑–∞ –í–∞—Å üòä –ù–µ—Ç, —ç—Ç–æ—Ç —Ä–µ–∂–∏–º —á–∞—Å—Ç–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –º–µ—Ç–æ–¥–æ–º *OLE*, —Ç–æ–≥–¥–∞ –∫–∞–∫ dmManual –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è *VCL* –º–µ—Ç–æ–¥–∞.

-   **DragOperations** ‚Äî –ø–µ—Ä–µ—á–µ–Ω—å –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Drag&Drop.

## 3.4. –°–æ–±—ã—Ç–∏—è Drag&Drop.

–í–æ—Ç –æ–Ω–∏:

-   **OnCreateDataObject** ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ drag manager‚Äô—É –Ω–µ–æ–±—Ö–æ–¥–∏–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ `TDataObject` —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏.

-   **OnCreateDragManager** ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ drag manager‚Äô—ã –¥–ª—è –¥–µ—Ä–µ–≤–∞. –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ø –Ω–µ –∏–º–µ—é –æ–ø—ã—Ç–∞ —Ä–∞–±–æ—Ç—ã —Å —ç—Ç–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

-   **OnGetUserClipboardFormats** ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø–æ–ª–Ω–∏—Ç—å –º–∞—Å—Å–∏–≤ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –í—ã —Å–ø–æ—Å–æ–±–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å `OnRenderOLEData`.

-   **OnRenderOLEData** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º **VT**.

-   **OnDragAllowed** ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∏–ª–∏ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

-   **OnDragDrop** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –±—ã–ª–∞ –æ—Ç–ø—É—â–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –º—ã—à–∏ –∏ –±—ã–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ.

-   **OnDragOver** ‚Äî –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç –¥–µ—Ä–µ–≤–∞. –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∏–ª–∏ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –≤ —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç.

-   **OnEndDrag** ‚Äî –°–æ–±—ã—Ç–∏–µ, —Å–ª–µ–¥—É—é—â–µ–µ –ø–æ—Å–ª–µ `OnDragDrop`. –û–ø–æ–≤–µ—â–∞–µ—Ç –æ–± –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏.

-   **OnStartDrag** ‚Äî –æ–ø–æ–≤–µ—â–∞–µ—Ç –æ –Ω–∞—á–∞–ª–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è.

-   **OnNodeCopied** ‚Äî —Å–æ–±—ã—Ç–∏–µ, —Å–≤—è–∑–∞–Ω–Ω–æ–µ —Å `CopyToClipboard` / `CutToClipboard` –º–µ—Ç–æ–¥–∞–º–∏ –¥–µ—Ä–µ–≤–∞. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —É–∑–ª–∞.

-   **OnNodeCopying** ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É, –Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–æ –≤—ã—à–µ—É–ø–æ–º—è–Ω—É—Ç—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–∞–∫–∂–µ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ.

## 3.5. –ü–∏—à–µ–º Drag&Drop –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å VT.

–ú—ã –ø–æ–¥–æ—à–ª–∏ –∫ —Ä–µ—à–∞—é—â–µ–º—É —à–∞–≥—É ‚Äî –Ω–∞–ø–∏—Å–∞–Ω–∏—é —Å–≤–æ–µ–≥–æ –ø–µ—Ä–≤–æ–≥–æ Drag&Drop –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å **VT**. –Ø —Ä–µ—à–∏–ª –≤ —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –Ω–µ —Ç–æ–ª—å–∫–æ Drag&Drop, –Ω–æ –∏ –≤—Å—Ç–∞–≤–∫–∏ –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç—ã —Å —à–µ–ª–ª–æ–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ü–æ—á–µ–º—É –Ø —Å–º–µ—à–∞–ª –≤—Å–µ –≤ –æ–¥–Ω—É –∫–∞—à—É? –î–µ–ª–æ –≤ —Ç–æ–º, —á—Ç–æ –≤ **VT** –∏–º–µ–µ—Ç—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤—Å—Ç–∞–≤–∫–∏ —Å–≤–æ–∏—Ö —É–∑–ª–æ–≤. –ù–æ —á—Ç–æ –µ—Å–ª–∏ –≤ –±—É—Ñ–µ—Ä–µ –æ–±–º–µ–Ω–∞ –Ω–µ —É–∑–ª—ã **VT**, –∞ –∫–∞–∫–∏–µ-—Ç–æ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ? –¢–æ–≥–¥–∞ –≤—Å—Ç–∞–≤–∫—É –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Drag&Drop –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, —á—Ç–æ –º—ã –∏ —Å–¥–µ–ª–∞–µ–º.

–ù–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è:

-   –î–µ—Ä–µ–≤–æ **VT** —Å `dtOLE` –∏ `dmAutomatic` —Å–≤–æ–π—Å—Ç–≤–∞–º–∏.

-   –î–µ—Ä–µ–≤–æ **VT** —Å `dtVCL` –∏ `dmManual` —Å–≤–æ–π—Å—Ç–≤–∞–º–∏.

-   `TRichEdit` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ *OLE* Drag&Drop –¥–∞–Ω–Ω—ã—Ö.

-   `TListBox` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ *VCL* Drag&Drop –¥–∞–Ω–Ω—ã—Ö. –ù–µ –∑–∞–±—É–¥—å—Ç–µ —Ç–∞–∫–∂–µ –≤—ã—Å—Ç–∞–≤–∏—Ç—å –µ–º—É dmAutomatic —Å–≤–æ–π—Å—Ç–≤–æ.

-   –£ –æ–±–æ–∏—Ö **VT**-–¥–µ—Ä–µ–≤—å–µ–≤ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ ClipboardFormats –≤ `True`.

-   –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Ç–∞–∫–∂–µ –≤–∫–ª—é—á–∏—Ç—å `toMultiSelect` –≤ TreeOptions.SelectionOptions, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—ã–¥–µ–ª—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤ —Ä–∞–∑–æ–º.

-   3 –¥–µ–π—Å—Ç–≤–∏—è (`TAction`) –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è, –≤—ã—Ä–µ–∑–∞–Ω–∏—è –∏ –≤—Å—Ç–∞–≤–∫–∏. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –∏–º –≤—ã—Å—Ç–∞–≤–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ *Shortcut*, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—ã–∑—ã–≤–∞—Ç—å –∏—Ö –ø—Ä—è–º–æ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –±–µ–∑ –≤—Å—è–∫–∏—Ö –º–µ–Ω—é –∏ –∫–Ω–æ–ø–æ–∫.

–î–∞–Ω–Ω—ã–µ —É–∑–ª–∞ –≤–æ–∑—å–º–µ–º —Å–∞–º—ã–µ –º–∞–ª–µ–Ω—å–∫–∏–µ, —á—Ç–æ–±—ã –Ω–µ –æ—Ç–≤–ª–µ–∫–∞—Ç—å—Å—è –Ω–∞ –ª–∏—à–Ω–µ–µ:

```delphi
type
  PItemNode = ^TItemNode;

  TItemNode = record
    Name: WideString;
  end;
```

–ó–∞–ø–æ–ª–Ω—è–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—ã:

```delphi
procedure TfrmMain.FormCreate(Sender: TObject);
var
  i: Integer;
begin
  VT.NodeDataSize := SizeOf(TItemNode);
  VT2.NodeDataSize := SizeOf(TItemNode);
  VT.RootNodeCount := 30;
  VT2.RootNodeCount := 30;
  RichEdit.Lines.LoadFromFile('rtf.rtf');
  for i := 0 to 9 do
    ListBox.Items.Add(Format('String %d', [i]));
end;
```

–ó–∞–º–µ—Ç–∏–ª–∏, —á—Ç–æ –º—ã –≤ –≤—ã—à–µ–ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–º –∫–æ–¥–µ –Ω–µ –∑–∞–ø–æ–ª–Ω–∏–ª–∏ —É–∑–ª—ã –Ω–∏–∫–∞–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏? –î–æ —ç—Ç–æ–≥–æ –º—ã –≤ —Ü–∏–∫–ª–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏ –∫–∞–∂–¥—ã–π —É–∑–µ–ª. –ù–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –Ø —Ä–µ—à–∏–ª –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å –µ—â–µ –æ–¥–Ω–∏–º –ø–æ–ª–µ–∑–Ω—ã–º —Å–æ–±—ã—Ç–∏–µ–º **VT** ‚Äî `OnInitNode`. –û–Ω–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø–æ–ª–Ω–∏—Ç—å —É–∑–µ–ª –¥–∞–Ω–Ω—ã–º–∏, –µ—Å–ª–∏ –í—ã –Ω–µ —Å–¥–µ–ª–∞–ª–∏ —ç—Ç–æ–≥–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏. –ü–æ–º–∏–º–æ —ç—Ç–æ–≥–æ, –í–∞–º –±—É–¥–µ—Ç —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –∑–∞–¥–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è —É–∑–ª–∞. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —ç—Ç–æ–≥–æ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –æ–±–æ–∏—Ö –¥–µ—Ä–µ–≤—å–µ–≤ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```delphi
procedure TfrmMain.VTInitNode(Sender: TBaseVirtualTree; ParentNode,
  Node: PVirtualNode; var InitialStates: TVirtualNodeInitStates);
var
  ItemNode: PItemNode;
begin
  ItemNode := Sender.GetNodeData(Node);
  if Assigned(ItemNode) then
    if Length(ItemNode^.Name) = 0 then
      ItemNode^.Name := 'Node Index ‚Ññ ' + IntToStr(Node.Index);
end;
```

–ö–∞–∫ –≤–∏–¥–∏—Ç–µ, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –≥–æ—Ä–∞–∑–¥–æ —É–¥–æ–±–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ, –Ω–µ–∂–µ–ª–∏ –¥–µ–ª–∞—Ç—å –≤—Å–µ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —É–∑–ª–æ–≤. –í–µ–¥—å –≤—Å–µ –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ (–∏–Ω–¥–µ–∫—Å —É–∑–ª–∞) –º—ã –ø–æ–ª—É—á–∞–µ–º –Ω–µ –æ—Ç—Ö–æ–¥—è –æ—Ç –∫–∞—Å—Å—ã, –ø—Ä—è–º–æ –Ω–∞ –º–µ—Å—Ç–µ. –î–∞–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º. –í–ø—Ä–µ–¥—å –í—ã –±—É–¥–µ—Ç–µ –≤–æ–ª—å–Ω—ã —Ä–µ—à–∞—Ç—å, –∫–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –í–∞–º —É–¥–æ–±–Ω–µ–µ.

–°–ª–µ–¥—É—é—â–∏–µ –¥–≤–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –í–∞–º —É–∂–µ –∑–Ω–∞–∫–æ–º—ã, –Ω–∞–∑–Ω–∞—á—å—Ç–µ –∏—Ö –æ–±–æ–∏–º –¥–µ—Ä–µ–≤—å—è–º:

```delphi
procedure TfrmMain.VTGetText(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex; TextType: TVSTTextType; var CellText: WideString);
var
  ItemNode: PItemNode;
begin
  ItemNode := Sender.GetNodeData(Node);
  if Assigned(ItemNode) then
    CellText := ItemNode^.Name;
end;

procedure TfrmMain.VTNewText(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex; NewText: WideString);
var
  ItemNode: PItemNode;
begin
  ItemNode := Sender.GetNodeData(Node);
  if Assigned(ItemNode) then
    ItemNode^.Name := NewText;
end;
```

–í–æ—Ç —Ç–∞–∫ –≤—ã–≥–ª—è–¥—è—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤—ã—Ä–µ–∑–∞–Ω–∏—è –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π –∏–∑ `TActionList`:

```delphi
procedure TfrmMain.BtnCopyClick(Sender: TObject);
begin
  if ActiveControl = VT then
    VT.CopyToClipBoard
  else if ActiveControl = VT2 then
    VT2.CopyToClipBoard
  else if ActiveControl = RichEdit then
    RichEdit.CopyToClipboard;
end;

procedure TfrmMain.BtnCutClick(Sender: TObject);
begin
  if ActiveControl = VT then
    VT.CutToClipBoard
  else if ActiveControl = VT2 then
    VT2.CutToClipBoard
  else if ActiveControl = RichEdit then
    RichEdit.CutToClipBoard;
end;
```

–ê –≤–æ—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –≤—Å—Ç–∞–≤–∫–∏ —É–∂–µ –±—É–¥–µ—Ç —Ä–∞–∑–ª–∏—á–∞—Ç—å—Å—è. –ü–æ–º–Ω–∏—Ç–µ, –Ø –≥–æ–≤–æ—Ä–∏–ª, —á—Ç–æ –≤—Å—Ç–∞–≤–∫—É *OLE* –¥–∞–Ω–Ω—ã—Ö –º—ã —Å–¥–µ–ª–∞–µ–º —á–µ—Ä–µ–∑ —Ç–µ –∂–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, —á—Ç–æ –∏ Drag&Drop? –í–æ—Ç —á—Ç–æ —É –Ω–∞—Å –ø–æ–ª—É—á–∏—Ç—Å—è:

```delphi
procedure TfrmMain.BtnPasteClick(Sender: TObject);
var
  DataObject: IDataObject;
  EnumFormat: IEnumFormatEtc;
  Format: TFormatEtc;
  Formats: TFormatArray;
  Fetched: Integer;
  Tree: TVirtualStringTree;
begin
  if ActiveControl is TVirtualStringTree then
  begin
    Tree := ActiveControl as TVirtualStringTree;
    // –ü–æ–ø—Ä–æ–±—É–µ–º —Å–Ω–∞—á–∞–ª–∞ –≤—Å—Ç–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Å—Ç—ã–º –º–µ—Ç–æ–¥–æ–º VT.
    if not Tree.PasteFromClipboard then
    begin
      // –ï—Å–ª–∏ VT —Å–∞–º –Ω–µ —Å–º–æ–≥ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å–æ –≤—Å—Ç–∞–≤–∫–æ–π, –∑–Ω–∞—á–∏—Ç –ø—Ä–∏—à–ª–∏ –¥–∞–Ω–Ω—ã–µ
      // –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥—Ä—É–≥–æ–≥–æ —Ç–∏–ø–∞, —á–µ–º –ø—Ä–æ—Å—Ç–æ TVirtualNode —É–∑–ª—ã.
      // –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å, –∫ –ø—Ä–∏–º–µ—Ä—É, —Ç–µ–∫—Å—Ç –∏–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞.
      // –°–µ–π—á–∞—Å –º—ã —ç—Ç–æ —É–∑–Ω–∞–µ–º, –ø–æ–∫–æ–ø–∞–≤—à–∏—Å—å –≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞.
      OLEGetClipboard(DataObject);
      // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤ –±—É—Ñ–µ—Ä–µ –æ–±–º–µ–Ω–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –≤ –º–∞—Å—Å–∏–≤ Formats.
      if Succeeded(DataObject.EnumFormatEtc(DATADIR_GET, EnumFormat)) then
      begin
        EnumFormat.Reset;
        while EnumFormat.Next(1, Format, @Fetched) = S_OK do
        begin
          SetLength(Formats, Length(Formats) + 1);
          Formats[High(Formats)] := Format.cfFormat;
        end;
        InsertData(Tree, DataObject, Formats, DROPEFFECT_COPY, Tree.DefaultPasteMode);
      end;
    end;
  end
  else if ActiveControl is TRichEdit then
    RichEdit.PasteFromClipboard;
end;
```

–¢–µ–ø–µ—Ä—å —Å–ª–µ–¥—É—é—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Drag&Drop. –í—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ø –ø–æ–º–µ—Å—Ç–∏–ª –≤ –∫–æ–¥. –î–ª—è –æ–±–æ–∏—Ö –¥–µ—Ä–µ–≤—å–µ–≤ –¥–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞. `onDragDrop` –∏ `onDragOver`:

```delphi
//---------------------------------------------------------------------------
// –ù–∞ –Ω–∞—Å —á—Ç–æ-—Ç–æ –∫–∏–Ω—É–ª–∏...
//---------------------------------------------------------------------------
procedure TfrmMain.VTDragDrop(Sender: TBaseVirtualTree; Source: TObject;
  DataObject: IDataObject; Formats: TFormatArray; Shift: TShiftState;
  Pt: TPoint; var Effect: Integer; Mode: TDropMode);

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫ –ø–æ—Å—Ç—É–ø–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏. –ü–µ—Ä–µ–º–µ—â–∞—Ç—å, –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —Å—Å—ã–ª–∞—Ç—å—Å—è
  procedure DetermineEffect;
  begin
    // –ù–∞–∂–∞—Ç—ã –ª–∏ –∫–∞–∫–∏–µ-–Ω–∏–±—É–¥—å —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ –∫–ª–∞–≤–∏—à–∏?
    if Shift = [] then
    begin
      // –ù–µ–∞, –Ω–µ –Ω–∞–∂–∞—Ç—ã
      // –¢–æ–≥–¥–∞, –µ—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—å - –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä,
      // –µ—Å–ª–∏ —É–∑–ª—ã –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –∏–∑ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –¥–µ—Ä–µ–≤–∞), —Ç–æ
      // –Ω–∞–¥–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —É–∑–ª—ã, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ - –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å.
      if Source = Sender then
        Effect := DROPEFFECT_MOVE
      else
        Effect := DROPEFFECT_COPY;
    end
    else begin
      // –ù–∞–∂–∞—Ç—ã. –í –∑–∞–≤–∏—Å–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Ä–µ—à–∞–µ–º —á—Ç–æ –¥–µ–ª–∞—Ç—å
      if (Shift = [ssAlt]) or (Shift = [ssCtrl, ssAlt]) then
        Effect := DROPEFFECT_LINK
      else
        if Shift = [ssCtrl] then
          Effect := DROPEFFECT_COPY
        else
          Effect := DROPEFFECT_MOVE;
    end;
  end;

var
  Attachmode: TVTNodeAttachMode;
  Nodes: TNodeArray;
  i: Integer;
begin
  Nodes := nil;
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫—É–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å —É–∑–µ–ª –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –∫—É–¥–∞ –±—ã–ª–∞
  // –±—Ä–æ—à–µ–Ω–∞ –≤–µ—Ç–∫–∞.
  case Mode of
    dmAbove:
      AttachMode := amInsertBefore;
    dmOnNode:
      AttachMode := amAddChildLast;
    dmBelow:
      AttachMode := amInsertAfter;
  else
    AttachMode := amNowhere;
  end;
  if DataObject = nil then
  begin
    // –ï—Å–ª–∏ –Ω–µ –ø—Ä–∏—à–ª–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, —Ç–æ –≤—Å—Ç–∞–≤–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ VCL –º–µ—Ç–æ–¥
    if Source is TVirtualStringTree then
    begin
      // –í—Å—Ç–∞–≤–∫–∞ –∏–∑ VT. –ú–æ–∂–µ–º —Å–ø–æ–∫–æ–π–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –µ–≥–æ –º–µ—Ç–æ–¥–∞–º–∏
      // –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è.
      DetermineEffect;
      // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —É–∑–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ Drag&Drop
      Nodes := VT2.GetSortedSelection(True);
      // –ò —Ä–∞–±–æ—Ç–∞–µ–º —Å –∫–∞–∂–¥—ã–º
      if Effect = DROPEFFECT_COPY then
      begin
        for i := 0 to High(Nodes) do
          VT2.CopyTo(Nodes[i], Sender.DropTargetNode, AttachMode, False);
      end
      else
        for i := 0 to High(Nodes) do
          VT2.MoveTo(Nodes[i], Sender.DropTargetNode, AttachMode, False);
    end
    else if Source is TListBox then
    begin
      // –í—Å—Ç–∞–≤–∫–∞ –∏–∑ –æ–±—ä–µ–∫—Ç–∞ –∫–∞–∫–æ–≥–æ-—Ç–æ –¥—Ä—É–≥–æ–≥–æ –∫–ª–∞—Å—Å–∞
      AddVCLText(Sender as TVirtualStringTree,
        (Source as TListBox).Items.Strings[(Source as TListBox).ItemIndex],
        AttachMode);
    end;
  end
  else begin
    // OLE drag&drop.
    // Effect –Ω—É–∂–µ–Ω –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –µ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É drag&drop, —á—Ç–æ–±—ã —Ç–æ—Ç —Ä–µ—à–∏–ª
    // —á—Ç–æ –æ–Ω –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å —Å–æ —Å–≤–æ–∏–º–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
    // –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ DROPEFFECT_MOVE (–ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ) –∏—Ö –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —É–¥–∞–ª–∏—Ç—å,
    // –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.
    if Source is TBaseVirtualTree then
      DetermineEffect
    else begin
      if Boolean(Effect and DROPEFFECT_COPY) then
        Effect := DROPEFFECT_COPY
      else
        Effect := DROPEFFECT_MOVE;
    end;
    InsertData(Sender as TVirtualStringTree, DataObject, Formats, Effect, AttachMode);
  end;
end;

//---------------------------------------------------------------------------
// –í —ç—Ç–æ–º —Å–æ–±—ã—Ç–∏–∏ –º—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ —Å—Ä–µ–¥–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã—Ö –≤–µ—Ç–æ–∫
// —Ä–æ–¥–∏—Ç–µ–ª—å –≤–µ—Ç–∫–∏, –≤ –∫–æ—Ç–æ—Ä—É—é –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ. –í–µ–¥—å –Ω–µ–ª—å–∑—è
// –∂–µ –≤–µ—Ç–∫—É-—Ä–æ–¥–∏—Ç–µ–ª—å –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å –≤ –µ—ë –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã üòä
//---------------------------------------------------------------------------
procedure TfrmMain.VTDragOver(Sender: TBaseVirtualTree; Source: TObject;
  Shift: TShiftState; State: TDragState; Pt: TPoint; Mode: TDropMode;
  var Effect: Integer; var Accept: Boolean);

  // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True, –µ—Å–ª–∏ AParent - –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª ANode.
  function IsNodeParent(AParent, ANode: PVirtualNode): Boolean;
  var
    NextParent: PVirtualNode;
  begin
    NextParent := AParent;
    repeat
      NextParent := NextParent.Parent;
    until
      (NextParent = Sender.RootNode) or (NextParent = nil) or
        (NextParent = ANode);
    Result := ANode = NextParent;
  end;

var
  i: Integer;
  Nodes: TNodeArray;
begin
  Accept := True;
  if (Assigned(Sender.DropTargetNode)) and
    (Sender.DropTargetNode <> Sender.RootNode) then
    Nodes := (Sender as TVirtualStringTree).GetSortedSelection(True);
  if Length(Nodes) > 0 then
  begin
    for i := 0 to Length(Nodes) - 1 do
    begin
      Accept :=
        // –£–∑–µ–ª –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–æ–¥–∏—Ç–µ–ª–µ–º –≤–µ—Ç–∫–∏, –≤ –∫–æ—Ç–æ—Ä—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è
        // –≤—Å—Ç–∞–≤–∫–∞
        (not IsNodeParent(Sender.DropTargetNode, Nodes[i]))
        // –¢–∞–∫–∂–µ, —É–∑–µ–ª –Ω–µ –¥–æ–ª–∂–µ–Ω —Ä–∞–≤–Ω—è—Ç—å—Å—è –≤–µ—Ç–∫–µ-–º–µ—Å—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é –≤—Å—Ç–∞–≤–∫–∏.
        // –¢.–µ. –º—ã –¥–æ–ª–∂–Ω—ã –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –≤—Å—Ç–∞–≤–∫—É —É–∑–ª–∞ –≤ —Å–∞–º–æ–≥–æ —Å–µ–±—è.
        and (not(Sender.DropTargetNode = Nodes[i]));
      // –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å—Ç–∞–≤–∫—É, –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∏–∑ —É—Å–ª–æ–≤–∏–π –≤–µ—Ä–Ω—É–ª–æ False
      if not Accept then
        Exit;
    end;
  end;
end;
```

–≠—Ç–æ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `onDragAllowed` –Ω–∞–∑–Ω–∞—á—å—Ç–µ —Ç–æ–ª—å–∫–æ –¥–µ—Ä–µ–≤—É —Å **VCL** Drag&Drop:

```delphi
procedure TfrmMain.VTDragAllowed(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex; var Allowed: Boolean);
begin
  Allowed := True;
end;
```

–ú–µ—Ç–æ–¥ `InsertData` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –Ω–æ–≤—ã—Ö **OLE** –¥–∞–Ω–Ω—ã—Ö –≤ –¥–µ—Ä–µ–≤–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –º—ã –∏—Ö –ø–æ–ª—É—á–∏–ª–∏. –û–Ω –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å —Å—Ä–µ–¥–∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–ø–æ—Å–æ–±–µ–Ω –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ *Unicode*-—Ç–µ–∫—Å—Ç –∏ —Ñ–∞–π–ª—ã, –±—Ä–æ—à–µ–Ω–Ω—ã–µ –Ω–∞ –Ω–∞—Å –∏–∑ *Explorer*‚Äôa. –í–æ—Ç –∫–∞–∫ –æ–Ω –≤—ã–≥–ª—è–¥–∏—Ç:

```delphi
procedure TfrmMain.InsertData(Sender: TVirtualStringTree;
  DataObject: IDataObject; Formats: TFormatArray;
  Effect: Integer; Mode: TVTNodeAttachMode);
var
  FormatAccepted: Boolean; // True, –µ—Å–ª–∏ –ø—Ä–∏–Ω—è—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏—Å—å
  i: Integer;
begin
  // –ò—â–µ–º –≤ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ–º –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å
  FormatAccepted := False;
  for i := 0 to High(Formats) do
  begin
    case Formats[i] of
      CF_HDROP: // –ü—Ä–∏–±—ã–ª —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏–∑ Explorer'a.
      begin
        if not FormatAccepted then
        begin
          AddFile(DataObject, Sender as TVirtualStringTree, Mode);
          FormatAccepted := True;
        end;
      end;
      CF_UNICODETEXT: // –Æ–ù–ò–ö–û–î-—Ç–µ–∫—Å—Ç
      begin
        if not FormatAccepted then
        begin
          AddUnicodeText(DataObject, Sender as TVirtualStringTree, Mode);
          FormatAccepted := True;
        end;
      end;
      else if Formats[i] = CF_VIRTUALTREE then
      // –†–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç VT. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å—Ç–∞–≤–∫—É —Å–≤–æ–∏—Ö –∂–µ
      // TVirtualNode-—É–∑–ª–æ–≤.
      begin
        if not FormatAccepted then
        begin
          Sender.ProcessDrop(DataObject, Sender.DropTargetNode, Effect, Mode);
          FormatAccepted := True;
        end;
      end;
    end;
  end;
end;
```

–¢–µ–ø–µ—Ä—å –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –≤—ã–≥–ª—è–¥—è—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä—ã `AddVCLText`, `AddFile` –∏ `AddUnicodeText`. –í—Å–µ –æ–Ω–∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∫–æ–≥–æ-—Ç–æ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞ –ø—Ä–∏—à–µ–¥—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –í–æ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–∞–∂–¥–æ–≥–æ –∏–∑ –Ω–∏—Ö —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è:

```delphi
//---------------------------------------------------------------------------
// –ú–µ—Ç–æ–¥ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Æ–ù–ò–ö–û–î-—Ç–µ–∫—Å—Ç–∞, —Ö—Ä–∞–Ω—è—â–µ–≥–æ—Å—è –≤ –±—É—Ñ–µ—Ä–µ
// –æ–±–º–µ–Ω–∞.
// –•—Ä–∞–Ω–∏–º—ã–π —Ç–µ–∫—Å—Ç –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∏ —Ä–∞–∑–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ –ª–∏–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Ç–µ–º
// –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ –¥–µ—Ä–µ–≤–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –Ω–æ–≤—ã—Ö —É–∑–ª–æ–≤.
//---------------------------------------------------------------------------
procedure TfrmMain.AddUnicodeText(DataObject: IDataObject;
  Target: TVirtualStringTree; Mode: TVTNodeAttachMode);
var
  // –°—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ—å –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  FormatEtc: TFormatEtc;
  // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
  Medium: TStgMedium;
  // –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–æ–∫—É
  OLEData,
  // –î–ª—è –ø—Ä–æ—Ö–æ–¥–∞ —Ü–∏–∫–ª–∞ —Å —Ü–µ–ª—å—é —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Å—Ç—Ä–æ–∫–∏
  Head, Tail: PWideChar;
  // –£–∑–µ–ª, –ø–æ–ª—É—á–∞—é—â–∏–π –Ω–æ–≤—É—é –≤–µ—Ç–∫—É
  TargetNode,
  // –ù–æ–≤–∞—è –≤–µ—Ç–∫–∞
  Node: PVirtualNode;
  // –ï—ë –¥–∞–Ω–Ω—ã–µ
  Data: PItemNode;
begin
  if Mode <> amNowhere then
  begin
    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç—Ä—É–∫—É—Ç—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Æ–ù–ò–ö–û–î-—Ç–µ–∫—Å—Ç–∞
    with FormatEtc do
    begin
      cfFormat := CF_UNICODETEXT;
      // –ù–µ—Ç —É –Ω–∞—Å –Ω–∏–∫–∞–∫–æ–≥–æ –¥–µ–≤–∞–π—Å–∞...
      ptd := nil;
      // –ù–∞–º –Ω—É–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ (—Ç–µ–∫—Å—Ç –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ)
      dwAspect := DVASPECT_CONTENT;
      // –ù–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –º—É–ª—å—Ç–∏—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
      lindex := -1;
      // –ú—ã –±—É–¥–µ–º –ø–æ–ª—É—á–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–∞–º—è—Ç—å
      tymed := TYMED_HGLOBAL;
    end;
    // –ï—Å—Ç—å –ª–∏ –Æ–ù–ò–ö–û–î-—Ç–µ–∫—Å—Ç –¥–ª—è –Ω–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞?
    if DataObject.QueryGetData(FormatEtc) = S_OK then
    begin
      // –û–ø–∞, –µ—Å—Ç—å, –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
      if DataObject.GetData(FormatEtc, Medium) = S_OK then
      begin
        // –í–æ—Ç –æ–Ω–∏:
        OLEData := GlobalLock(Medium.hGlobal);
        if Assigned(OLEData) then
        begin
          Target.BeginUpdate;
          // –í—ã–±–∏—Ä–∞–µ–º –º–µ—Å—Ç–æ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ = nil
          TargetNode := Target.DropTargetNode;
          if TargetNode = nil then
            TargetNode := Target.FocusedNode;
          // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç—Ä–æ–∫–∏
          Head := OLEData;
          try
            while Head^ <> #0 do
            begin
              Tail := Head;
              while not (Tail^ in [WideChar(#0), WideChar(#13), WideChar(#10), WideChar(#9)]) do
                Inc(Tail);
              if Head <> Tail then
              begin
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –Ω–æ–¥—É, –µ—Å–ª–∏ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–∏–º–≤–æ–ª
                // –¥–ª—è —Å—Ç—Ä–æ–∫–∏.
                Node := Target.InsertNode(TargetNode, Mode);
                Data := Target.GetNodeData(Node);
                Data^.Name := Head;
                SetLength(Data^.Name, (Tail - Head));
              end;
              // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–∞–±—ã
              if Tail^ = #9 then
                Inc(Tail);
              // –°–∏–º–≤–æ–ª—ã –ø–µ—Ä–µ–Ω–æ—Å–∞ –∫–∞—Ä–µ—Ç–∫–∏ –∏ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏
              if Tail^ = #13 then
                Inc(Tail);
              if Tail^ = #10 then
                Inc(Tail);
              // –®–∞–≥–∞–µ–º –¥–∞–ª—å—à–µ
              Head := Tail;
            end;
          finally
            GlobalUnlock(Medium.hGlobal);
            Target.EndUpdate;
          end;
        end;
        // –í–æ—Ç —ç—Ç–æ –ª—É—á—à–µ –Ω–µ –∑–∞–±—ã–≤–∞—Ç—å –¥–µ–ª–∞—Ç—å
        ReleaseStgMedium(Medium);
      end;
    end;
  end;
end;

//---------------------------------------------------------------------------
// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º—ë–Ω —Ñ–∞–π–ª–æ–≤, –±—Ä–æ—à–µ–Ω—ã—Ö –Ω–∞ –Ω–∞—Å –∏–∑ Explorer‚Äô–∞.
//---------------------------------------------------------------------------
procedure TfrmMain.AddFile(DataObject: IDataObject;
  Target: TVirtualStringTree; Mode: TVTNodeAttachMode);
var
  FormatEtc: TFormatEtc;
  Medium: TStgMedium;
  OLEData: PDropFiles;
  Files: PChar;
  Str: String;
  TargetNode,
  Node: PVirtualNode;
  Data: PItemNode;
begin
  if Mode <> amNowhere then
  begin
    // –ù–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –Ω–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –µ—Å—Ç—å –ª–∏ –≤ –±—É—Ñ–µ—Ä–µ CF_HDROP —Ñ–æ—Ä–º–∞—Ç
    with FormatEtc do
    begin
      cfFormat := CF_HDROP;
      ptd := nil;
      dwAspect := DVASPECT_CONTENT;
      lindex := -1;
      tymed := TYMED_HGLOBAL;
    end;
    if DataObject.QueryGetData(FormatEtc) = S_OK then
    begin
      if DataObject.GetData(FormatEtc, Medium) = S_OK then
      begin
        OLEData := GlobalLock(Medium.hGlobal);
        if Assigned(OLEData) then
        begin
          Target.BeginUpdate;
          TargetNode := Target.DropTargetNode;
          if TargetNode = nil then
            TargetNode := Target.FocusedNode;
          try
            // –ê –≤–æ—Ç —Å —ç—Ç–∏–º –Ø –¥–æ–ª–≥–æ –º—É—á–∞–ª—Å—è. –í Microsoft –∑–∞–∂—Ä–∞–ª–∏—Å—å –∏ –Ω–µ –¥–∞–ª–∏
            // –ø—Ä–∏–º–µ—Ä–∞ —Ä–∞–±–æ—Ç—ã —Å DROPFILES —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.
            // –û–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, —Å–ø–∏—Å–æ–∫ –±—Ä–æ—à–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∞–¥—Ä–µ—Å–µ
            // —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            // + offset, –∫–æ—Ç–æ—Ä—ã–π –∏ –µ—Å—Ç—å OLEData^.pFiles.
            Files := PChar(OLEData) + OLEData^.pFiles;
            // –°–ø–∏—Å–æ–∫ –æ–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –¥–≤–æ–π–Ω—ã–º null —Å–∏–º–≤–æ–ª–æ–º
            while Files^ <> #0 do
            begin
              if OLEData^.fWide then
              begin
                Str := PWideChar(Files);
                // +1 –Ω—É–∂–µ–Ω –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–µ—Ä–µ—à–∞–≥–Ω—É—Ç—å null —Å–∏–º–≤–æ–ª –æ–¥–Ω–æ–≥–æ
                // –∏–∑ –∏–º—ë–Ω —Ñ–∞–π–ª–æ–≤ –≤ —Å–ø–∏—Å–∫–µ
                Inc(Files, (Length(PWideChar(Files)) + 1)*SizeOf(WideChar));
              end
              else begin
                Str := Files;
                // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ
                Inc(Files, (Length(PChar(Files)) + 1)*SizeOf(Char));
              end;
              Node := Target.InsertNode(TargetNode, Mode);
              Data := Target.GetNodeData(Node);
              Data^.Name := Str;
            end;
          finally
            GlobalUnlock(Medium.hGlobal);
            Target.EndUpdate;
          end;
        end;
        ReleaseStgMedium(Medium);
      end;
    end;
  end;
end;

//---------------------------------------------------------------------------
// –ú–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ –∏–∑ VCL –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤.
// –†–µ–∂–µ–º –Ω–∞ –ª–∏–Ω–∏–∏.
//---------------------------------------------------------------------------
procedure TfrmMain.AddVCLText(Target: TVirtualStringTree;
  const Text: WideString; Mode: TVTNodeAttachMode);
var
  Head, Tail: PWideChar;
  TargetNode,
  Node: PVirtualNode;
  Data: PItemNode;
begin
  if Mode <> amNoWhere then
  begin
    Target.BeginUpdate;
    try
      TargetNode := Target.DropTargetNode;
      if TargetNode = nil then
        TargetNode := Target.FocusedNode;
      Head := PWideChar(Text);
      while Head^ <> #0 do
      begin
        Tail := Head;
        while not (Tail^ in [WideChar(#0), WideChar(#13), WideChar(#10), WideChar(#9)]) do
          Inc(Tail);
        if Head <> Tail then
        begin
          Node := Target.InsertNode(TargetNode, Mode);
          Data := Target.GetNodeData(Node);
          SetString(Data^.Name, Head, Tail - Head);
        end;
        if Tail^ = #9 then
          Inc(Tail);
        if Tail^ = #13 then
          Inc(Tail);
        if Tail^ = #10 then
          Inc(Tail);
        Head := Tail;
      end;
    finally
      Target.EndUpdate;
    end;
  end;
end;
```

–ú—ã —Å–¥–µ–ª–∞–ª–∏ —ç—Ç–æ. –ú–æ–∂–µ—Ç–µ —Ç–µ–ø–µ—Ä—å —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å. –í –∫–∞—á–µ—Å—Ç–≤–µ —Ç–µ—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –≤—ã—Ä–µ–∑–∞—Ç—å —É–∑–ª—ã, –ø–µ—Ä–µ–º–µ—â–∞—Ç—å –∏—Ö –º–µ–∂–¥—É –¥–µ—Ä–µ–≤—å—è–º–∏, –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –∏–∑ `TRichEdit`, `TListBox`, *Microsoft Word*, *Visual Studio*, *Total Commander*, –≤—ã–¥–µ–ª–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤ –≤ *Windows Explorer* –∏ –∫–∏–Ω—å—Ç–µ –∏—Ö –Ω–∞ –¥–µ—Ä–µ–≤—å—è. –ú–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –∏ —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏, –∞ —Ç–∞–∫–∂–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å —É–∑–ª—ã –∏–∑ –¥–µ—Ä–µ–≤—å–µ–≤ –≤ `TRichEdit` –∏–ª–∏ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –í—Å–µ –≤ –∏—Ç–æ–≥–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —É—Ä–∞. –ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞–º–∏ –º–µ—Ç–æ–¥–æ–≤ –≤–ø–æ–ª–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç, —Ä–∞–∑–≤–µ —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Å—Ç–∞–≤–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∏ –º—ã –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏, –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å —É–∂–µ —Å–µ–±–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ üòä

–ü–æ–∑–¥—Ä–∞–≤–ª—è—é, –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ Drag&Drop!

###### üí° –ü—Ä–æ–µ–∫—Ç, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π —Ä–∞–±–æ—Ç—É —Å Drag&Drop, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ *Fig 1.3.*

## 4.0. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö. –†–∞–±–æ—Ç–∞ —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º IVTEditLink.

**VT** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –∫—Ä–æ–º–µ –æ–±—ã—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞. –≠—Ç—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã –æ–±–ª–µ–≥—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ä–∞–±–æ—Ç—É —Å –∫–∞–∫–∏–º–∏-—Ç–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–≤–µ—Ç–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **ComboBox** —Å–æ —Å–ø–∏—Å–∫–æ–º —Ü–≤–µ—Ç–æ–≤, –∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞—Ç—ã ‚Äî –≤—ã–∑—ã–≤–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å. –ö–æ–Ω–µ—á–Ω–æ, —ç—Ç–æ –Ω–µ–ø—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–±–∞–≤–∏—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≤–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ.

–ß—Ç–æ–±—ã –∫–∞–∫-—Ç–æ –æ–±–æ–±—â–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–∑–≤–æ–ª–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º –¥–µ—Ä–µ–≤–∞ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `IVTEditLink`. –î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –Ω–µ–±–æ–ª—å—à–æ–π –ø—Ä–∏–º–µ—Ä, –≥–¥–µ –ø–æ—Å—Ç–∞—Ä–∞–µ–º—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö.

### 4.1. –ü–∏—à–µ–º –∫–ª–∞—Å—Å, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å IVTEditLink.

–î–ª—è –Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–∏–º—Å—è, –∫–∞–∫–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö, –∞ —Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã, –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ø—Ä–∏–º–µ—Ä–µ. –î—É–º–∞—é, —ç—Ç–æ–≥–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞:

```delphi
type
  TVTEditorKind = (
    ekString, // TEdit
    ekMemo, // TMemo
    ekComboBox, // TComboBox
    ekColor, // TColorBox
    ekDate, // TDateTimePicker
    ekMask, // TMaskedEdit
    ekProgress // TProgressBar
  );
```

–ú—ã –Ω–∞–ø–∏—à–µ–º –æ–¥–∏–Ω –∫–ª–∞—Å—Å –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞. –≠—Ç–æ –Ω–∞–∏–±–æ–ª–µ–µ —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–π –∫–ª–∞—Å—Å, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –í–æ—Ç –∫–∞–∫ –æ–Ω –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å:

```delphi
TVTCustomEditor = class(TInterfacedObject, IVTEditLink)
private
  FEdit: TWinControl;        // –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
  FTree: TVirtualStringTree; // –°—Å—ã–ª–∫–∞ –Ω–∞ –¥–µ—Ä–µ–≤–æ, –≤—ã–∑–≤–∞–≤—à–µ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  FNode: PVirtualNode;       // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π —É–∑–µ–ª
  FColumn: Integer;          // –ï–≥–æ –∫–æ–ª–æ–Ω–∫–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π –æ–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
protected
  procedure EditKeyDown(Sender: TObject; var Key: Word; Shift: TShiftState);
public
  destructor Destroy; override;

  function BeginEdit: Boolean; stdcall;
  function CancelEdit: Boolean; stdcall;
  function EndEdit: Boolean; stdcall;
  function GetBounds: TRect; stdcall;
  function PrepareEdit(Tree: TBaseVirtualTree; Node: PVirtualNode;
    Column: TColumnIndex): Boolean; stdcall;
  procedure ProcessMessage(var Message: TMessage); stdcall;
  procedure SetBounds(R: TRect); stdcall;
end;
```

–ö–∞–∫ –≤–∏–¥–∏—Ç–µ, –≤—Å–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã –±—É–¥—É—Ç –ø–æ—Ç–æ–º–∫–∞–º–∏ `TWinControl`. –° –ø–æ–º–æ—â—å—é —Ç–∏–ø–∞ `TVTEditorKind` –º—ã –±—É–¥–µ–º –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –∫–∞–∫–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –∫–ª–∞—Å—Å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è. –í –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö, –Ω–∞–ø—Ä–æ—Ç–∏–≤ –ø–æ–ª–µ–π –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è, —É–∫–∞–∑–∞–Ω –∫–ª–∞—Å—Å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è.

–¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ—à–∏—Ç—å, –∫–∞–∫ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞. –ù–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≥–¥–µ-—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –∫–æ—Ç–æ—Ä–∞—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–∏–ø–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –±—É–¥–µ—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –Ω—É–∂–Ω—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∏–ø–∞ `TVTEditorKind`, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –∑–Ω–∞—Ç—å –∫–∞–∫–æ–π —Ç–∏–ø —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É–∑–ª–∞.

–ü–æ–ª—É—á–∞–µ–º:

```delphi
type
  PVTEditNode = ^TVTEditNode;

  TVTEditNode = record
    Kind: TVTEditorKind;
    Value: String;
    Changed: Boolean;
  end;
```

–°—é–¥–∞ –Ø —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–∏–ª –ø–æ–ª–µ *Changed,* —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —á—Ç–æ —É–∑–µ–ª –±—ã–ª –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω –∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–æ–ª—å—à–µ —Å–≤–æ–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –≠—Ç–æ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä.

–ù–∞—à –ø—Ä–∏–º–µ—Ä –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å 2 –∫–æ–ª–æ–Ω–∫–∏ (–ø–∞—Ä–∞–º–µ—Ç—Ä-–∑–Ω–∞—á–µ–Ω–∏–µ) –∏ 7 —É–∑–ª–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞. –ß—Ç–æ–±—ã –Ω–µ –æ—Ç–≤–ª–µ–∫–∞—Ç—å—Å—è –∏ –Ω–µ –ø–∏—Å–∞—Ç—å –ª–∏—à–Ω–µ–≥–æ –∫–æ–¥–∞, –æ–ø—Ä–µ–¥–µ–ª–∏–º –¥–ª—è –¥–∞–Ω–Ω—ã—Ö 3 –º–∞—Å—Å–∏–≤–∞: —Ç–∏–ø—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ —Å–µ–º–∏ —É–∑–ª–æ–≤, –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–æ–ª—è *Changed* –∏ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–µ—Ä–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏.

```delphi
  ValueTypes: array[0..6] of TVTEditorKind = (
    ekString, // –ò–º—è
    ekMemo, // –û–ø–∏—Å–∞–Ω–∏–µ
    ekComboBox, // –¢–∏–ø
    ekColor, // –¶–≤–µ—Ç
    ekDate, // –î–∞—Ç–∞
    ekMask, // –ú–∞—Å–∫–∞
    ekProgress // –ü—Ä–æ—Ü–µ—Å—Å
  );
  // –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  DefaultValues: array[0..6] of String = (
    '–°–≤–∏—Ç–µ—Ä',
    '–ú—è–≥–∫–∏–π –∏ —Ç—ë–ø–ª—ã–π.',
    '–®–µ—Ä—Å—Ç—å',
    'clRed',
    '24.06.2006',
    '798-77-66',
    '70 %'
  );
  // –ò–º–µ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  ValueNames: array[0..6] of String = (
    '–ò–º—è –∏–∑–¥–µ–ª–∏—è',
    '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π',
    '–ú–∞—Ç–µ—Ä–∏–∞–ª',
    '–¶–≤–µ—Ç –∏–∑–¥–µ–ª–∏—è',
    '–î–∞—Ç–∞ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è',
    '–¢–µ–ª–µ—Ñ–æ–Ω —Å–∫–ª–∞–¥–∞',
    '–ü—Ä–æ—Ü–µ—Å—Å –¥–æ—Å—Ç–∞–≤–∫–∏'
  );
```

–í—Å–µ, —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ –Ω–∞–ø–∏—Å–∞–Ω–∏—é –∫–æ–¥–∞, —Ä–µ–∞–ª–∏–∑—É—é—â–µ–≥–æ –º–µ—Ç–æ–¥—ã –Ω–∞—à–µ–≥–æ –∫–ª–∞—Å—Å–∞. –ü–æ —Ö–æ–¥—É —Ä–∞–±–æ—Ç—ã –Ø —Å—Ç–∞—Ä–∞–ª—Å—è –¥–∞–≤–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–ª–Ω—ã–µ –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∫–∞–∂–¥–æ–º—É –¥–µ–π—Å—Ç–≤–∏—é.

```delphi
//---------------------------------------------------------------------------
{* * * * * * * * * * * * * * * * TVTCustomEditor * * * * * * * * * * * * * *}
//---------------------------------------------------------------------------
destructor TVTCustomEditor.Destroy;
begin
  FreeAndNil(FEdit);
  inherited;
end;

//---------------------------------------------------------------------------
// –î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏–π —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
// –û—Ç–º–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ Escape, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ Enter,
// –∏ –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ –ø–æ Up/Down, –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É –∫–æ–º–±–æ –±–æ–∫—Å–∞ –∏–ª–∏
// —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –¥–∞—Ç—ã –Ω–µ –≤—ã–ø—É—â–µ–Ω.
//---------------------------------------------------------------------------
procedure TVTCustomEditor.EditKeyDown(Sender: TObject; var Key: Word; Shift: TShiftState);
var
  CanContinue: Boolean;
begin
  CanContinue := True;
  case Key of
    VK_ESCAPE: // –ù–∞–∂–∞–ª–∏ Escape
      if CanContinue then
      begin
        FTree.CancelEditNode;
        Key := 0;
      end;
    VK_RETURN: // –ù–∞–∂–∞–ª–∏ Enter
      if CanContinue then
      begin
        // –ï—Å–ª–∏ Ctrl –¥–ª—è TMemo –Ω–µ –∑–∞–∂–∞—Ç, —Ç–æ –∑–∞–≤–µ—Ä—à–∞–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        // –°–¥–µ–ª–∞–µ–º —Ç–∞–∫, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ Ctrl+Enter –≤—Å—Ç–∞–≤–ª—è—Ç—å –≤ Memo
        // –Ω–æ–≤—É—é –ª–∏–Ω–∏—é.
        if (FEdit is TMemo) and (Shift = []) then
          FTree.EndEditNode
        else if not(FEdit is TMemo) then
          FTree.EndEditNode;
        Key := 0;
      end;
    VK_UP, VK_DOWN:
      begin
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –∏–¥—ë—Ç –ª–∏ —Ä–∞–±–æ—Ç–∞ —Å —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º. –ï—Å–ª–∏ –∏–¥—ë—Ç, —Ç–æ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å
        // –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–µ—Ä–µ–≤–∞, –µ—Å–ª–∏ –Ω–µ—Ç, —Ç–æ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ –¥–µ—Ä–µ–≤—É.
        CanContinue := Shift = [];
        if FEdit is TComboBox then
          CanContinue := CanContinue and not TComboBox(FEdit).DroppedDown;
        if FEdit is TDateTimePicker then
          CanContinue := CanContinue and not TDateTimePicker(FEdit).DroppedDown;
        if CanContinue then
        begin
          // –ü–µ—Ä–µ–¥–∞—á–∞ –∫–ª–∞–≤–∏—à–∏ –¥–µ—Ä–µ–≤—É
          PostMessage(FTree.Handle, WM_KEYDOWN, Key, 0);
          Key := 0;
        end;
      end;
  end;
end;

//---------------------------------------------------------------------------
// –ù–∞—á–∞–ª–æ—Å—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–º—É —Ñ–æ–∫—É—Å.
//---------------------------------------------------------------------------
function TVTCustomEditor.BeginEdit: Boolean;
begin
  Result := True;
  with FEdit do
  begin
    Show;
    SetFocus;
  end;
end;

//---------------------------------------------------------------------------
// –û—Ç–º–µ–Ω–∏–ª–æ—Å—å, –ø—Ä—è—á–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä.
//---------------------------------------------------------------------------
function TVTCustomEditor.CancelEdit: Boolean;
begin
  Result := True;
  FEdit.Hide;
end;

//---------------------------------------------------------------------------
// –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å, –ø—Ä—è—á–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä, –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —É–∑–ª–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º
// —Ñ–æ–∫—É—Å –¥–µ—Ä–µ–≤—É.
//---------------------------------------------------------------------------
function TVTCustomEditor.EndEdit: Boolean;
var
  Txt: String;
begin
  Result := True;
  if FEdit is TEdit then
    Txt := TEdit(FEdit).Text
  else if FEdit is TMemo then
    Txt := TEdit(FEdit).Text
  else if FEdit is TComboBox then
    Txt := TComboBox(FEdit).Text
  else if FEdit is TColorBox then
    Txt := ColorToString(TColorBox(FEdit).Selected)
  else if FEdit is TDateTimePicker then
  begin
    Txt := DateToStr(TDateTimePicker(FEdit).DateTime);
  end
  else if FEdit is TMaskEdit then
    Txt := TMaskEdit(FEdit).Text
  else if FEdit is TProgressBar then
    Txt := IntToStr(TProgressBar(FEdit).Position) + ' %';
  // –ò–∑–º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç —É–∑–ª–∞ (–ø–æ–ª–µ Value —É TVTEditNode) —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–µ OnNewText
  // —É –¥–µ—Ä–µ–≤–∞
  FTree.Text[FNode, FColumn] := Txt;
  FEdit.Hide;
  FTree.SetFocus;
end;

//---------------------------------------------------------------------------
// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞.
//---------------------------------------------------------------------------
function TVTCustomEditor.GetBounds: TRect;
begin
  Result := FEdit.BoundsRect;
end;

//---------------------------------------------------------------------------
// –í –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –º—ã –¥–æ–ª–∂–Ω—ã —Å–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä TWinControl
// –Ω—É–∂–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ –ø–æ—Ç–æ–º–∫–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø–æ–ª–µ–º Kind —É TVTEditNode.
//---------------------------------------------------------------------------
function TVTCustomEditor.PrepareEdit(Tree: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex): Boolean;
var
  VTEditNode: PVTEditNode;
begin
  Result := True;
  FTree := Tree as TVirtualStringTree;
  FNode := Node;
  FColumn := Column;
  FreeAndNil(FEdit);
  VTEditNode := FTree.GetNodeData(Node);
  case VTEditNode.Kind of
    ekString:
    begin
      FEdit := TEdit.Create(nil);
      with FEdit as TEdit do
      begin
        AutoSize := False;
        Visible := False;
        Parent := Tree;
        Text := VTEditNode.Value;
        OnKeyDown := EditKeyDown;
      end;
    end;
    ekMemo:
    begin
      FEdit := TMemo.Create(nil);
      with FEdit as TMemo do
      begin
        Visible := False;
        Parent := Tree;
        ScrollBars := ssVertical;
        Text := VTEditNode.Value;
        OnKeyDown := EditKeyDown;
      end;
    end;
    ekComboBox:
    begin
      FEdit := TComboBox.Create(nil);
      with FEdit as TComboBox do
      begin
        Visible := False;
        Parent := Tree;
        Text := VTEditNode.Value;
        Items.Add('–®–µ—Ä—Å—Ç—å');
        Items.Add('–•–ª–æ–ø–æ–∫');
        Items.Add('–®—ë–ª–∫');
        Items.Add('–ö–æ–∂–∞');
        Items.Add('–í–µ–ª—é—Ä');
        OnKeyDown := EditKeyDown;
      end;
    end;
    ekColor:
    begin
      FEdit := TColorBox.Create(nil);
      with FEdit as TColorBox do
      begin
        Visible := False;
        Parent := Tree;
        Selected := StringToColor(VTEditNode.Value);
        Style := Style + [cbPrettyNames];
        OnKeyDown := EditKeyDown;
      end;
    end;
    ekMask:
    begin
      FEdit := TMaskEdit.Create(nil);
      with FEdit as TMaskEdit do
      begin
        AutoSize := False;
        Visible := False;
        Parent := Tree;
        EditMask := '999-99-99';
        Text := VTEditNode.Value;
        OnKeyDown := EditKeyDown;
      end;
    end;
    ekDate:
    begin
      FEdit := TDateTimePicker.Create(nil);
      with FEdit as TDateTimePicker do
      begin
        Visible := False;
        Parent := Tree;
        Date := StrToDate(VTEditNode.Value);
        OnKeyDown := EditKeyDown;
      end;
    end;
    ekProgress:
    begin
      FEdit := TProgressBar.Create(nil);
      with FEdit as TProgressBar do
      begin
        Visible := False;
        Parent := Tree;
        Position := StrToIntDef(VTEditNode.Value, 70);
      end;
    end
  else
    Result := False;
  end;
end;

//---------------------------------------------------------------------------
// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π Windows –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞.
//---------------------------------------------------------------------------
procedure TVTCustomEditor.ProcessMessage(var Message: TMessage);
begin
  FEdit.WindowProc(Message);
end;

//---------------------------------------------------------------------------
// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —à–∏—Ä–∏–Ω–æ–π –∏ –≤—ã—Å–æ—Ç–æ–π
// –∫–æ–ª–æ–Ω–∫–∏.
//---------------------------------------------------------------------------
procedure TVTCustomEditor.SetBounds(R: TRect);
var
  Dummy: Integer;
begin
  FTree.Header.Columns.GetColumnBounds(FColumn, Dummy, R.Right);
  FEdit.BoundsRect := R;
  if FEdit is TMemo then
    FEdit.Height := 80;
end;
```

–û—Å–Ω–æ–≤–Ω—É—é —Ä–∞–±–æ—Ç—É –º—ã –ø—Ä–æ–¥–µ–ª–∞–ª–∏. –ù–∞—Å—Ç–∞–ª–æ –≤—Ä–µ–º—è —Å–æ–µ–¥–∏–Ω–∏—Ç—å –Ω–∞—à –∫–ª–∞—Å—Å —Å **VT**. –î–µ–ª–∞–µ—Ç—Å—è —ç—Ç–æ –ø–µ—Ä–µ–¥–∞—á–µ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ —Å–æ–±—ã—Ç–∏–∏ `OnCreateEditor`:

```delphi
procedure TfrmMain.VTCreateEditor(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex; out EditLink: IVTEditLink);
begin
  EditLink := TVTCustomEditor.Create;
end;
```

–°—É—Ç—å –µ–≥–æ –≤ –ø—Ä–æ—Å—Ç–æ–π –ø–µ—Ä–µ–¥–∞—á–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –Ω–∞—à–µ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞. –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –Ω–∞—á–∞–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è **VT** –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –Ω–∞—à–µ–≥–æ –∫–ª–∞—Å—Å–∞ –≤–º–µ—Å—Ç–æ —Å–≤–æ–µ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–º–µ–Ω–∏–≤—à–∏–µ—Å—è –ø–æ–ª—è –¥–µ—Ä–µ–≤–∞:

```delphi
procedure TfrmMain.VTNewText(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex; NewText: WideString);
var
  VTEditNode: PVTEditNode;
begin
  VTEditNode := Sender.GetNodeData(Node);
  with VTEditNode^ do
  begin
    if not Changed then
      Changed := Value <> NewText;
    Value := StringReplace(NewText, #13#10, ' ', [rfReplaceAll]);
  end;
end;
```

–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∞–º–æ –ø–æ —Å–µ–±–µ –Ω–µ –≤–∫–ª—é—á–∏—Ç—Å—è. –í —Å–æ–±—ã—Ç–∏–∏ `OnEditing` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –µ–≥–æ:

```delphi
procedure TfrmMain.VTEditing(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex; var Allowed: Boolean);
begin
  Allowed := Column > 0;
end;
```

–û–± –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö –í—ã –º–æ–∂–µ—Ç–µ —Å–∞–º–∏ –ø–æ–∑–∞–±–æ—Ç–∏—Ç—å—Å—è, –±–ª–∞–≥–æ –∑–Ω–∞–Ω–∏–π —É –í–∞—Å —É–∂–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –í–∫–ª—é—á–∏—Ç–µ —Å–≤–æ–π—Å—Ç–≤–æ `TreeOptions.MiscOptions.toEditable` —É **VT** –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ö–∞–∂–¥—ã–π –∏–∑ —Å–µ–º–∏ —É–∑–ª–æ–≤ –±—É–¥–µ—Ç –æ–±–ª–∞–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º.

–ü—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –∑–∞–ø–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏—Ö –≤ **VT**. –í—ã –∏–º–µ–µ—Ç–µ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–∑–ª–æ–≤, –≥—Ä–∞–Ω–∏—Ü—ã –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç—Å—è –ª–∏—à—å –≤–∞—à–µ–π —Ñ–∞–Ω—Ç–∞–∑–∏–µ–π. –í –∫–∞—á–µ—Å—Ç–≤–µ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è –º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–≤—è–∑–∞—Ç—å **VT** —Å —á–∏—Å–ª–æ–≤—ã–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º.

###### üí° –ü—Ä–æ–µ–∫—Ç, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π —Ä–∞–±–æ—Ç—É —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ *Fig 1.4.*

## 5.0. –ü–æ–ª–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –¥–µ—Ä–µ–≤–∞. –ö–ª–∞—Å—Å TVirtualDrawTree.

–í —ç—Ç–æ–π –≥–ª–∞–≤–µ –º—ã —Å –í–∞–º–∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ä–∞–±–æ—Ç—É —Å –∫–ª–∞—Å—Å–æ–º `TVirtualDrawTree`, —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –≤ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —É–∑–ª–æ–≤. –û–Ω –Ω–µ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–∫–∏—Ö-—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –≤—Ä–æ–¥–µ —Ç–µ–∫—Å—Ç–∞. `TVirtualDrawTree` —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–∏–∑–∞–π–Ω–∞ –≤–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã.

–í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–∏–¥–æ–∏–∑–º–µ–Ω–µ–Ω–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞, –Ω–∞–ø–æ–º–∏–Ω–∞—é—â–µ–≥–æ —Å–æ–±–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–∫–∞—á–µ–∫ Mozilla Firefox —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –ù–æ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–∑–±–µ—Ä–µ–º—Å—è –≤ –æ—Ç–ª–∏—á–∏—è—Ö `TVirtualDrawTree` –æ—Ç `TVirtualStringTree`, —Å –∫–æ—Ç–æ—Ä—ã–º –º—ã —Ä–∞–Ω–µ–µ —Ä–∞–±–æ—Ç–∞–ª–∏.

## 5.1. –û—Ç–ª–∏—á–∏—Ç–µ–ª—å–Ω—ã–µ —á–µ—Ä—Ç—ã –∫–ª–∞—Å—Å–∞ TVirtualDrawTree.

–†–∞–∑–ª–∏—á–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã. –°—Ä–∞–∑—É –±—Ä–æ—Å–∞–µ—Ç—Å—è –≤ –≥–ª–∞–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–≤—ã—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π `OnGetText` –∏ `OnNewText`, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ –Ω–µ–ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ä–µ–≤–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, –í—ã –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã, –≤—Å–µ –¥–ª—è —ç—Ç–æ–≥–æ –Ω–∞ –º–µ—Å—Ç–µ. –ü–æ—è–≤–∏–ª–æ—Å—å —Ü–µ–ª—ã—Ö —á–µ—Ç—ã—Ä–µ –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è:

-   **OnDrawNode** ‚Äî –µ—Å–ª–∏ —É `TVirtualStringTree` –æ—Å–Ω–æ–≤–∞ ‚Äî —Å–æ–±—ã—Ç–∏–µ `OnGetText`, —Ç–æ —É `TVirtualDrawTree` —ç—Ç–æ `OnDrawNode`. –í —ç—Ç–æ–º —Å–æ–±—ã—Ç–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å—é –æ—Ç—Ä–∏—Å–æ–≤–∫—É —É–∑–ª–∞.

-   **OnGetNodeWidth** ‚Äî –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–æ –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è —à–∏—Ä–∏–Ω—ã —É–∑–ª–∞. –ù–∞–ø–æ–º–Ω—é, —á—Ç–æ –≤—ã—Å–æ—Ç–∞ —É–∑–ª–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ DefaultNodeHeight –¥–ª—è –¥–µ—Ä–µ–≤—å–µ–≤ —Å —É–∑–ª–∞–º–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –≤—ã—Å–æ—Ç—ã –∏–ª–∏ –≤ —Å–æ–±—ã—Ç–∏–∏ `OnMeasureItem` –¥–ª—è –¥–µ—Ä–µ–≤—å–µ–≤ —Å —É–∑–ª–∞–º–∏ —Ä–∞–∑–ª–∏—á–Ω–æ–π –≤—ã—Å–æ—Ç—ã.

-   **OnGetHintSize** ‚Äî –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–æ –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏.

-   **OnDrawHint** ‚Äî —Å–æ–±—ã—Ç–∏–µ, –ø–æ–∑–≤–æ–ª—è—é—â–µ–µ –æ—Ç—Ä–∏—Å–æ–≤–∫—É –≤—Å–ø–ª—ã–≤–∞—é—â–µ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏. –î–æ —Å–∏—Ö –ø–æ—Ä –º—ã –º–æ–≥–ª–∏ –ª–∏—à—å —É–∫–∞–∑–∞—Ç—å —Ç–µ–∫—Å—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏, –Ω–æ —Å —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –º—ã –¥–æ–ª–∂–Ω—ã –±—É–¥–µ–º –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –ø–æ–ª–Ω—ã–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –Ω–µ –ø—Ä–µ—Ç–µ—Ä–ø–µ–ª–æ –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.

## 5.2. –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∑–ª–æ–≤ –∏ –∏—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫.

–í —Ç–µ–∫—Å—Ç–µ –¥–∞–Ω–Ω–æ–π –≥–ª–∞–≤—ã –Ø –æ–≥—Ä–∞–Ω–∏—á–∏–ª—Å—è –ª–∏—à—å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏–º–µ—Ä–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π `OnDrawNode` –∏ `OnDrawHint`, –∞ —Ç–∞–∫–∂–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ—Ç–æ–∫–∞. –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –≤ —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–π –≥–ª–∞–≤—ã –¥–æ–≤–æ–ª—å–Ω–æ –æ–±—ä–µ–º–Ω–æ –∏ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –¥–ª—è –Ω–∞—Å –±–æ–ª—å—à–æ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞, –ø–æ—ç—Ç–æ–º—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã –Ω–∞—à–∏—Ö —Ç—Ä—É–¥–æ–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä –∏–∑ –ø–∞–ø–∫–∏ *Fig 1.5.*

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –Ω–µ–±–æ–ª—å—à—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞. –ú—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –∏–∑–¥–µ–ª–∏–π, –∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π, —Ü–µ–Ω –∏ —Ç.–¥. –¢–∞–∫–∂–µ, –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫–æ–≥–æ-—Ç–æ –∑–∞–∫–∞–∑–∞. –ó–∞–¥–∞–Ω–∏–µ –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω–æ–µ, –Ω–æ –≤–ø–æ–ª–Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ–º–æ–µ —Å –ø–æ–º–æ—â—å—é `TVirtualDrawTree`.

–ö–∞–∫ –æ–±—ã—á–Ω–æ, –Ω–∞—á–∏–Ω–∞–µ–º —Å –ø—Ä–æ–¥—É–º—ã–≤–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞:

```delphi
type
  PItemNode = ^TItemNode;

  TItemNode = record
    Image, Name: String;
    Mass, PriceKg: Word;
    Process: Byte;
    PersonalThread: Cardinal;
  end;
```

–ù–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ö—Ä–∞–Ω–∏—Ç—å –ø—É—Ç—å –∫ –∫–∞—Ä—Ç–∏–Ω–∫–µ, –∏–º—è –∏–∑–¥–µ–ª–∏—è, –≤–µ—Å –∏ —Ü–µ–Ω—É –∑–∞ –∫–∏–ª–æ–≥—Ä–∞–º–º. –ü–æ–ª–µ *Process* –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏. –ï–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ –º—ã –±—É–¥–µ–º –∏–∑–º–µ–Ω—è—Ç—å —Å –ø–æ–º–æ—â—å—é –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞, –∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å –ø–æ–º–æ—â—å—é `TProgressBar` –≤ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–º —É–∑–ª–µ. –•–µ–Ω–¥–ª –ø–æ—Ç–æ–∫–∞ –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ø–æ–ª–µ *PersonalThread.*

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π:

```delphi
//---------------------------------------------------------------------------
// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏.
//---------------------------------------------------------------------------
procedure TfrmMain.VTDrawHint(Sender: TBaseVirtualTree; HintCanvas: TCanvas;
  Node: PVirtualNode; R: TRect; Column: TColumnIndex);
var
  NodeData: PItemNode;
  Th: Integer;
  ImgRect, RealRect, NameRect, PriceRect: TRect;
  Img: TPicture;
begin
  // –û–±–ª–∞—Å—Ç–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
  Th := HintCanvas.TextHeight('Wj');
  RealRect := R;
  // –ì—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ä—Ç–∏–Ω–∫–∏
  ImgRect := RealRect;
  with ImgRect do
  begin
    Inc(Left, 16);
    Inc(Top, 8);
    Right := Left + 64;
    Bottom := Top + 64;
  end;
  // –ì—Ä–∞–Ω–∏—Ü—ã —Ç–µ–∫—Å—Ç–∞ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è
  NameRect := RealRect;
  with NameRect do
  begin
    Inc(Left, 96);
    Inc(Top, 8);
    Bottom := Top + Th;
  end;
  // –ì—Ä–∞–Ω–∏—Ü—ã —Ç–µ–∫—Å—Ç–∞ –æ–±—â–µ–π —Ü–µ–Ω—ã
  PriceRect := RealRect;
  with PriceRect do
  begin
    Inc(Left, 96);
    Dec(Bottom, 16);
    Top := Bottom - Th;
  end;
  // –†–∏—Å—É–µ–º —Ñ–æ–Ω
  with HintCanvas do
  begin
    with Brush do
    begin
      Color := clInfoBk;
      Style := bsSolid;
    end;
    Pen.Color := clBlack;
    Pen.Width := 1;
    // –ñ—ë–ª—Ç—ã–π —Ñ–æ–Ω –∏ —á—ë—Ä–Ω–∞—è —Ä–∞–º–∫–∞ –ø–æ –±–æ–∫–∞–º
    Rectangle(RealRect);
  end;
  // –¢–µ–∫—Å—Ç
  NodeData := Sender.GetNodeData(Node);
  with HintCanvas do
  begin
    Brush.Style := bsClear;
    Font.Color := clWindowText;
    // –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
    Font.Style := [fsBold];
    if NodeData^.Process = 0 then
      TextOut(NameRect.Left, NameRect.Top, NodeData^.Name + ' (–Ω–µ –¥–æc—Ç–∞–≤–ª–µ–Ω–æ)')
    else if (NodeData^.Process > 0) and (NodeData^.Process < 100) then
      TextOut(NameRect.Left, NameRect.Top, NodeData^.Name + ' (–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è)')
    else if NodeData^.Process = 100 then
      TextOut(NameRect.Left, NameRect.Top, NodeData^.Name + ' (–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)');
    // –û–±—â–∞—è —Ü–µ–Ω–∞
    Font.Style := [];
    TextOut(PriceRect.Left, PriceRect.Top, '–û–±—â–∞—è —Ü–µ–Ω–∞: ' + IntToStr(NodeData^.PriceKg * NodeData^.Mass) + ' —Ä.');
  end;
  // –ö–∞—Ä—Ç–∏–Ω–∫–∞
  Img := TPicture.Create;
  try
    Img.LoadFromFile(NodeData^.Image);
    HintCanvas.Draw(ImgRect.Left, ImgRect.Top, Img.Graphic);
    with HintCanvas, ImgRect do
    begin
      Pen.Width := 2;
      Pen.Color := $00B99D7F;
      Rectangle(Rect(ImgRect.Left, Top, Left + Img.Width, Top + Img.Height));
    end;
  finally
    FreeAndNil(Img);
  end;
  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
  with FProgress do
  begin
    Position := NodeData^.Process;
    Width := RealRect.Right - 96 - 16;
    PaintTo(HintCanvas, NameRect.Left, NameRect.Top + Th + Th div 2);
  end;
end;

//---------------------------------------------------------------------------
// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —É–∑–ª–∞.
//---------------------------------------------------------------------------
procedure TfrmMain.VTDrawNode(Sender: TBaseVirtualTree;
  const PaintInfo: TVTPaintInfo);
var
  NodeData: PItemNode;
  Th: Integer;
  ImgRect, RealRect, NameRect, GetRect, CancelRect, MassRect, PriceRect: TRect;
  Img: TPicture;
begin
  // –û–±–ª–∞—Å—Ç–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
  Th := PaintInfo.Canvas.TextHeight('Wj');
  RealRect := PaintInfo.CellRect;
  ImgRect := RealRect;
  with ImgRect do
  begin
    Inc(Left, 16);
    Inc(Top, 16);
    Right := Left + 64;
    Bottom := Top + 64;
  end;
  NameRect := RealRect;
  with NameRect do
  begin
    Inc(Left, 96);
    Inc(Top, 16);
    Bottom := Top + Th;
  end;
  GetRect := RealRect;
  with GetRect do
  begin
    Dec(Bottom, 16 + Th);
    Top := Bottom - Th;
    Dec(Right, 16);
    Left := Right - PaintInfo.Canvas.TextWidth('–î–æ—Å—Ç–∞–≤–∏—Ç—å');
  end;
  CancelRect := GetRect;
  with CancelRect do
  begin
    Inc(Top, Th);
    Inc(Bottom, Th);
  end;
  MassRect := RealRect;
  with MassRect do
  begin
    Inc(Left, 96);
    Dec(Bottom, 16 + Th);
    Top := Bottom - Th;
  end;
  PriceRect := MassRect;
  with PriceRect do
  begin
    Inc(Top, Th);
    Inc(Bottom, Th);
  end;
  // –†–∏—Å—É–µ–º —Ñ–æ–Ω
  with PaintInfo.Canvas do
  begin
    with Brush do
    begin
      Color := clWindow;
      Style := bsSolid;
    end;
    Pen.Color := $00B99D7F;
  end;
  if PaintInfo.Node = Sender.FocusedNode then
    GradFill(PaintInfo.Canvas.Handle, RealRect, $00EAE2D9, $00D7C8B7, gkVert)
  else
    PaintInfo.Canvas.FillRect(RealRect);
  // –¢–µ–∫—Å—Ç
  NodeData := Sender.GetNodeData(PaintInfo.Node);
  with PaintInfo.Canvas do
  begin
    Brush.Style := bsClear;
    Font.Color := clWindowText;
    // –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
    Font.Style := [fsBold];
    if NodeData^.Process = 0 then
      TextOut(NameRect.Left, NameRect.Top, NodeData^.Name + ' (–Ω–µ –¥–æc—Ç–∞–≤–ª–µ–Ω–æ)')
    else if (NodeData^.Process > 0) and (NodeData^.Process < 100) then
      TextOut(NameRect.Left, NameRect.Top, NodeData^.Name + ' (–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è)')
    else if NodeData^.Process = 100 then
      TextOut(NameRect.Left, NameRect.Top, NodeData^.Name + ' (–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)');
    // –ú–∞—Å—Å–∞
    Font.Style := [];
    TextOut(MassRect.Left, MassRect.Top, '–ú–∞—Å—Å–∞: ' + IntToStr(NodeData^.Mass) + ' –∫–≥.');
    // –¶–µ–Ω–∞
    TextOut(PriceRect.Left, PriceRect.Top, '–¶–µ–Ω–∞ –∑–∞ –∫–∏–ª–æ–≥—Ä–∞–º–º: ' + IntToStr(NodeData^.PriceKg) + ' —Ä.');
    // –î–æ—Å—Ç–∞–≤–∏—Ç—å
    with Font do
    begin
      Style := [fsUnderline];
      Color := clBlue;
    end;
    TextOut(GetRect.Left, GetRect.Top, '–î–æ—Å—Ç–∞–≤–∏—Ç—å');
    // –û—Ç–º–µ–Ω–∞
    TextOut(CancelRect.Left, CancelRect.Top, '–û—Ç–º–µ–Ω–∞');
  end;
  // –ö–∞—Ä—Ç–∏–Ω–∫–∞
  Img := TPicture.Create;
  try
    Img.LoadFromFile(NodeData^.Image);
    PaintInfo.Canvas.Draw(ImgRect.Left, ImgRect.Top, Img.Graphic);
    if PaintInfo.Node = Sender.FocusedNode then
      with PaintInfo.Canvas, ImgRect do
      begin
        Pen.Width := 2;
        Rectangle(Rect(ImgRect.Left, Top, Left + Img.Width, Top + Img.Height));
      end;
  finally
    FreeAndNil(Img);
  end;
  // –ü—Ä–æ—Ü–µ—Å—Å
  if PaintInfo.Node = Sender.FocusedNode then
    with FProgress do
    begin
      Position := NodeData^.Process;
      Width := RealRect.Right - 96 - 16;
      PaintTo(PaintInfo.Canvas, NameRect.Left, NameRect.Top + Th + Th div 2);
    end;
end;

//---------------------------------------------------------------------------
// –ú–µ—Ç–æ–¥ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫—É—Ä—Å–æ—Ä–∞ —Ä—É–∫–∏ –Ω–∞–¥ –Ω–∞–¥–ø–∏—Å—è–º–∏ "–î–æ—Å—Ç–∞–≤–∏—Ç—å"
// –∏ "–û—Ç–º–µ–Ω–∞", –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω—ã –≤ —Å—Ç–∏–ª–µ —Å—Å—ã–ª–æ–∫.
//---------------------------------------------------------------------------
procedure TfrmMain.VTGetCursor(Sender: TBaseVirtualTree; var Cursor: TCursor);
var
  Pt: TPoint;
  Node: PVirtualNode;
  NRect: TRect;
  D: Integer;
  Inf: tagScrollInfo;
begin
  GetCursorPos(Pt);
  Pt := Sender.ScreenToClient(Pt);
  Node := Sender.GetNodeAt(Pt.X, Pt.Y);
  with Inf do
  begin
    cbSize := SizeOf(tagScrollInfo);
    fMask := SIF_RANGE;
  end;
  GetScrollInfo(Sender.Handle, SB_VERT, Inf);
  if (Inf.nMax > Sender.Height) then
    D := GetSystemMetrics(SM_CXHTHUMB)
  else
    D := 0;
  if Node <> nil then
  begin
    NRect := Sender.GetDisplayRect(Node, -1, False);
    if ((Pt.X > Sender.Width - 71 - D) and (Pt.X < Sender.Width - 16 - D) and
      (Pt.Y > NRect.Bottom - 42) and
      (Pt.Y < NRect.Bottom - 29))
      or
      ((Pt.X > Sender.Width - 71 - D) and (Pt.X < Sender.Width - 35 - D) and
      (Pt.Y > NRect.Bottom - 29) and
      (Pt.Y < NRect.Bottom - 16))
    then
      Cursor := crHandPoint
    else
      Cursor := crDefault;
  end;
end;

//---------------------------------------------------------------------------

procedure TfrmMain.VTGetHintSize(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex; var R: TRect);
begin
  with R do
  begin
    Left := 0;
    Top := 0;
    Right := 250;
    Bottom := 80;
  end;
end;

//---------------------------------------------------------------------------
// –ü–æ–ª—É—á–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã —É–∑–ª–∞. –ï—Å–ª–∏ –í—ã –≤–∫–ª—é—á–∏–ª–∏ –æ–ø—Ü–∏—é toFullRowSelect, —Ç–æ
// –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.
//---------------------------------------------------------------------------
procedure TfrmMain.VTGetNodeWidth(Sender: TBaseVirtualTree; HintCanvas: TCanvas;
  Node: PVirtualNode; Column: TColumnIndex; var NodeWidth: Integer);
var
  D: Integer;
  Inf: tagScrollInfo;
begin
  // –°–º–æ—Ç—Ä–∏–º, –≤–∏–¥–µ–Ω –ª–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª.
  // –ï—Å–ª–∏ –µ—Å—Ç—å, —Ç–æ –µ–≥–æ —à–∏—Ä–∏–Ω—É –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤—ã—á–µ—Å—Ç—å –∏–∑ —à–∏—Ä–∏–Ω—ã —É–∑–ª–∞
  with Inf do
  begin
    cbSize := SizeOf(tagScrollInfo);
    fMask := SIF_RANGE;
  end;
  GetScrollInfo(Sender.Handle, SB_VERT, Inf);
  if (Inf.nMax > Sender.Height) then
    D := GetSystemMetrics(SM_CXHTHUMB)
  else
    D := 0;
  // –í—ã—á–∏—Ç–∞–µ–º –∏–∑ —à–∏—Ä–∏–Ω—ã –¥–µ—Ä–µ–≤–∞ —à–∏—Ä–∏–Ω—É –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–∞, –æ—Ç—Å—Ç—É–ø–∞ –∏ –∫—Ä–∞—è
  // –¥–µ—Ä–µ–≤–∞
  NodeWidth := Sender.Width - D - VT.Indent - VT.Margin;
end;
```

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–∞, –∏–º–∏—Ç–∏—Ä—É—é—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å –¥–æ—Å—Ç–∞–≤–∫–∏, –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫ (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–∞–Ω—ã –ø–æ —Ö–æ–¥—É –ª–∏—Å—Ç–∏–Ω–≥–∞):

```delphi
// –ü–æ—Ç–æ–∫, –∏–º–∏—Ç–∏—Ä—É—é—â–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞–∫–æ–π-—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏–∏
TProcessThread = class(TThread)
private
  FWnd: HWND; // –•–µ–Ω–¥–ª —Ñ–æ—Ä–º—ã. –ù–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –æ—Ç—Å—ã–ª–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –µ–º—É
  FNode: PVirtualNode; // –£–∑–µ–ª, –∑–∞ –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Ç–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç
  FValue: Byte; // –ü—Ä–æ—Ü–µ—Å—Å –¥–æ—Å—Ç–∞–≤–∫–∏
  procedure RepaintTree;
  procedure CheckDeleted;
public
  constructor Create(Suspended: Boolean; var InitialValue: Byte;
    CallingForm: HWND; VTNode: PVirtualNode);
protected
  procedure Execute; override;
end;

constructor TProcessThread.Create(Suspended: Boolean;
  var InitialValue: Byte; CallingForm: HWND; VTNode: PVirtualNode);
begin
  inherited Create(Suspended);
  FWnd := CallingForm;
  FNode := VTNode;
  FValue := InitialValue;
  FreeOnTerminate := True;
end;

//---------------------------------------------------------------------------
// –û—Ç—Å—ã–ª–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Ñ–æ—Ä–º–µ –æ —Ç–æ–º, —á—Ç–æ —É–∑–ª—É FNode –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞
// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
//   WParam - –∞–¥—Ä–µ—Å —É–∑–ª–∞;
//   LParam - —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏.
//---------------------------------------------------------------------------
procedure TProcessThread.RepaintTree;
begin
  SendMessage(FWnd, VT_REPAINTTREE, Integer(FNode), FValue);
end;

//---------------------------------------------------------------------------
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –±—ã–ª –ª–∏ —É–¥–∞–ª—ë–Ω —É–∑–µ–ª, –∑–∞ –∫–æ—Ç–æ—Ä—ã–π –º—ã –æ—Ç–≤–µ—á–∞–µ—Ç. –ï—Å–ª–∏ –±—ã–ª, —Ç–æ
// –¥–µ–ª–∞—Ç—å –Ω–∞–º –±–æ–ª—å—à–µ –Ω–µ—á–µ–≥–æ.
//---------------------------------------------------------------------------
procedure TProcessThread.CheckDeleted;
begin
  if not Assigned(FNode) then
    Terminate;
end;

//---------------------------------------------------------------------------

procedure TProcessThread.Execute;
begin
  while FValue < 100 do
  begin
    Sleep(100);
    Synchronize(CheckDeleted);
    Inc(FValue);
    Synchronize(RepaintTree);
  end;
end;
```

–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è `VT_REPAINTTREE` —É —Ñ–æ—Ä–º—ã:

```delphi
const
  // –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –ø–æ—Ç–æ–∫–æ–º –æ —Ç–æ–º, —á—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
  // –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å —É–∫–∞–∑–∞–Ω–Ω—ã–π —É–∑–µ–ª
  VT_REPAINTTREE = WM_USER + 500;

procedure TfrmMain.VTREPAINTTREE(var Message: TMessage);
var
  Node: PVirtualNode;
  ItemNode: PItemNode;
begin
  Node := Pointer(Message.WParam);
  if Assigned(Node) then
  begin
    ItemNode := VT.GetNodeData(Node);
    ItemNode^.Process := Message.LParam;
    VT.RepaintNode(Node);
  end;
end;
```

–î–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–º–µ—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–µ—Ä–µ–≤–æ. –ß—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ `HintMode` –Ω–∞ `hmHint` (—ç—Ç–æ —Å–≤–æ–π—Å—Ç–≤–æ –±—É–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–µ–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–æ –ø–æ–∑–∂–µ).

–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏, –Ω–∞—à–µ –∑–∞–¥–∞–Ω–∏–µ –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∏ —Å –ø–æ–º–æ—â—å—é –æ–±—ã—á–Ω–æ–≥–æ `TVirtualStringTree`, –Ω–æ –æ–Ω –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ –∫–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–æ–≥—É—Ç –ø–æ–¥–∂–∏–¥–∞—Ç—å –í–∞—Å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –Ω–∏–º. –ü—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–º–Ω–∏—Ç–µ, –µ—Å–ª–∏ –í–∞–º —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, —Ç–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `TVirtualDrawTree`, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ `TVirtualStringTree`.

###### üí° –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—É—é –æ—Ç—Ä–∏—Å–æ–≤–∫—É –¥–µ—Ä–µ–≤–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `TVirtualDrawTree`, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ *Fig 1.5.* –í –Ω–µ–º —Ç–∞–∫–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∫–æ–¥—É.

## 6.0. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ VT –∏–∑ —Ñ–∞–π–ª–∞.

–ö–∞–∫–æ–π —Ç–æ–ª–∫ –æ—Ç –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –Ω–∏–≥–¥–µ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å? –î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º —á—Ç–æ –µ—Å—Ç—å –≤ **VT** –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏ –∫–∞–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏ —ç—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å. –ú—ã –≤–æ–∑—å–º–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä: —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –¥–µ—Ä–µ–≤–æ –∏–∑ –¥–≤—É—Ö –∫–æ–ª–æ–Ω–æ–∫ —Å –≤–æ–∑–º–æ–∂–Ω–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å—é —É–∑–ª–æ–≤. –¢–∞–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏.

## 6.1. –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏.

**VT** —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ç–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã, –∫–∞–∫ `LoadFromFile` –∏ `SaveToFile`, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –≤ —Ñ–∞–π–ª. –û—Å–Ω–æ–≤–∞ –∏—Ö –¥–µ–π—Å—Ç–≤–∏—è ‚Äî –º–µ—Ç–æ–¥—ã `LoadFromStream` –∏ `SaveToStream`, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Ç–æ–∫–æ–º –¥–∞–Ω–Ω—ã—Ö. –î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º –≤—ã–∑–≤–∞—Ç—å –∏—Ö –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ñ–∞–π–ª.

–î–∞–Ω–Ω—ã–µ –¥–ª—è —É–∑–ª–∞:

```delphi
type
  PNodeData = ^TNodeData;

  TNodeData = record
    Caption: WideString;
    Value: Integer;
  end;
```

–ó–∞–ø–æ–ª–Ω—è–µ–º –¥–µ—Ä–µ–≤–æ —Å–ª—É—á–∞–π–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

```delphi
const
  Strs: array[0..4] of WideString = (
    'ŒïŒ∫ŒªŒøŒ≥Œ≠œÇ œÉœÑŒø ŒôœÉœÅŒ±ŒÆŒª',
    'ŒëœÄŒµŒ≤ŒØœâœÉŒµ Œø ŒìŒπŒ¨ŒΩŒΩŒ∑œÇ ŒûŒµŒΩŒ¨Œ∫Œ∑œÇ',
    'ŒúŒµœÑŒ±ŒºœåœÉœáŒµœÖœÉŒ∑ œáŒµœÅŒπŒøœç',
    'Œ£Œ¨ŒºœÄŒ±, Œ∫ŒªœåŒøœÖŒΩ, ŒºŒ±œÉŒ∫Œ±œÅŒ¨Œ¥ŒµœÇ Œ∫Œ±Œπ œÄŒµŒΩŒπŒ≠œÇ',
    'ŒîŒøŒ∫ŒπŒºŒ¨Œ∂ŒµŒπ œÑŒπœÇ Œ±ŒΩœÑŒøœáŒ≠œÇ œÑŒøœÖ'
  );
  Ints: array[0..4] of Integer = (
    938,
    5346,
    23,
    789,
    2888
  );

procedure TfrmMain.BtnFillClick(Sender: TObject);
var
  i, j: Integer;
  NewNode1, NewNode2: PVirtualNode;
  ItemData: PNodeData;
begin
  Randomize;
  for i := 0 to 1 do
  begin
    NewNode1 := VT.AddChild(nil);
    ItemData := VT.GetNodeData(NewNode1);
    with ItemData^ do
    begin
      Caption := Strs[Random(4)];
      Value := Ints[Random(4)];
    end;
    for j := 0 to 9 do
    begin
      NewNode2 := VT.AddChild(NewNode1);
      ItemData := VT.GetNodeData(NewNode2);
      with ItemData^ do
      begin
        Caption := Strs[Random(4)];
        Value := Ints[Random(4)];
      end;
    end;
  end;
end;
```

–ü–æ–ø—Ä–æ–±—É–µ–º –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Ç–µ–ª–æ–¥–≤–∏–∂–µ–Ω–∏–π –ø—Ä–æ—Å—Ç–æ –≤—ã–∑–≤–∞—Ç—å –æ–±–∞ –º–µ—Ç–æ–¥–∞ –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```delphi
procedure TfrmMain.BtnLoadClick(Sender: TObject);
begin
  VT.LoadFromFile('vt.dat');
end;

procedure TfrmMain.BtnSaveClick(Sender: TObject);
begin
  VT.SaveToFile('vt.dat');
end;
```

–î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `OnGetText` –¥–µ—Ä–µ–≤—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É, –∫–æ—Ç–æ—Ä–æ–π –Ω–∞–∑–Ω–∞—á–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `BtnFillClick`, —á—Ç–æ–±—ã –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–µ—Ä–µ–≤–æ. –ó–∞—Ç–µ–º –∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è. –í –ø–∞–ø–∫–µ —Å –ø—Ä–∏–º–µ—Ä–æ–º –ø–æ—è–≤–∏—Ç—Å—è —Ñ–∞–π–ª *vt.dat,* –æ—Ç–∫—Ä–æ–µ–º –µ–≥–æ –±–ª–æ–∫–Ω–æ—Ç–æ–º –∏–ª–∏ –ª—é–±—ã–º hex-—Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º. –ß—Ç–æ –º—ã –≤–∏–¥–∏–º? –ë–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ—Å–∫–∞–∫–∏–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –æ—á–µ–≤–∏–¥–Ω–æ –≤–∑—è—Ç–∞—è –∏–∑ –ø–æ–ª—è *Caption* –Ω–∞—à–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –•–æ—Ä–æ—à–æ, –æ—á–∏—Å—Ç–∏—Ç–µ –¥–µ—Ä–µ–≤–æ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–≥—Ä—É–∑–∫–∏. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ—Ä–µ–≤–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è, –Ω–æ –≤—Å–µ –µ–≥–æ —É–∑–ª—ã –±—É–¥—É—Ç –ø—É—Å—Ç—ã... –ó–∞—á–µ–º –∂–µ —Ç–æ–≥–¥–∞ –≤ –ø–æ–ª—É—á–µ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —É–∑–ª–æ–≤? –î–µ—Ä–µ–≤–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —É–∑–ª–æ–≤, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –Ω–∏–∫–∞–∫ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –µ–≥–æ. –ü–æ–ª—É—á–∞–µ—Ç—Å—è, —á—Ç–æ —ç—Ç–æ –º—É—Å–æ—Ä –≤ —Ñ–∞–π–ª–µ? –ò –¥–∞, –∏ –Ω–µ—Ç.

–¢–∞–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –æ–±—ä—è—Å–Ω—è–µ—Ç—Å—è —Ç–µ–º, —á—Ç–æ —Ç–µ–∫—Å—Ç —É–∑–ª–æ–≤ (–Ω–æ –Ω–µ –¥–∞–Ω–Ω—ã–µ —É–∑–ª–∞) –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –ø–æ—Ç–æ–∫ `TStream` –ø—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Å –±—É—Ñ–µ—Ä–æ–º –æ–±–º–µ–Ω–∞ –∏ Drag&Drop. –ó–∞—Ç–µ–º –æ–Ω —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ –ø–æ—Ç–æ–∫–∞ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —É–∑–ª–∞. –ù–æ –Ω—É–∂–Ω–æ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–µ–∫—Å—Ç–∞ —É–∑–ª–æ–≤ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∞–º, –Ω–∞–ø—Ä–∏–º–µ—Ä `TRichEdit` –∏–ª–∏ *Microsoft Word* (–æ–Ω–∏ –∂–µ –Ω–∏—á–µ–≥–æ –ø—Ä–æ –¥–∞–Ω–Ω—ã–µ —É–∑–ª–∞ –∑–Ω–∞—Ç—å –Ω–µ –º–æ–≥—É—Ç), –∞ –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º —Å —Ñ–∞–π–ª–æ–º, –ø–æ—ç—Ç–æ–º—É —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –¥–µ—Ä–µ–≤–æ–º, –∫–∞–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞.

–ù–æ —á—Ç–æ —Ç–æ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è? –ö–∞–∫ –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç —ç—Ç–æ–≥–æ ¬´–º—É—Å–æ—Ä–∞¬ª –≤ —Ñ–∞–π–ª–µ? –î–ª—è –Ω–∞—á–∞–ª–∞, –∑–∞–ø—Ä–µ—Ç–∏–º –¥–µ—Ä–µ–≤—É –ø–æ–º–µ—â–∞—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –ø–æ—Ç–æ–∫. –ó–∞ —ç—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç –æ–ø—Ü–∏—è `toSaveCaptons` –∏–∑ StringOptions —Ä–∞–∑–¥–µ–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–µ—Ä–µ–≤–∞, –∫–æ—Ç–æ—Ä—É—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –≤ `False`. –¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —É–∑–ª–∞ –≤ –ø–æ—Ç–æ–∫. –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–º –≤ –ø–æ–º–æ—â—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–≤–∞ –ø—Ä–æ—Å—Ç—ã—Ö —Å–æ–±—ã—Ç–∏—è:

-   **OnLoadNode** ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞.

-   **OnSaveNode** ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –Ω–∞—à–∞ –∑–∞–¥–∞—á–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –ø–æ –º–µ—Ä–µ –∑–∞–ø–∏—Å–∏ –≤ –Ω–µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–µ—Ä–µ–≤–∞. –û –∑–∞–ø–∏—Å–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–µ—Ä–µ–≤–∞ **VT** –∑–∞–±–æ—Ç–∏—Ç—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

–î–æ–±–∞–≤–∏–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ–±–æ–∏–º —Å–æ–±—ã—Ç–∏—è–º:

```delphi
procedure TfrmMain.VTLoadNode(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Stream: TStream);
var
  Reader: TReader;
  NodeData: PNodeData;
begin
  Reader := TReader.Create(Stream, 8096);
  try
    NodeData := Sender.GetNodeData(Node);
    with NodeData^, Reader do
    begin
      Caption := ReadWideString;
      Value := ReadInteger;
    end;
  finally
    FreeAndNil(Reader);
  end;
end;

procedure TfrmMain.VTSaveNode(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Stream: TStream);
var
  Writer: TWriter;
  NodeData: PNodeData;
begin
  Writer := TWriter.Create(Stream, 8096);
  try
    NodeData := Sender.GetNodeData(Node);
    with Writer, NodeData^ do
    begin
      WriteWideString(Caption);
      WriteInteger(Value);
    end;
  finally
    FreeAndNil(Writer);
  end;
end;
```

–¢–µ–º, –∫—Ç–æ —Ä–∞–±–æ—Ç–∞–ª —Å –º–∞—Å—Å–∏–≤–∞–º–∏ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞–ª –∏—Ö –º–µ—Ç–æ–¥—ã –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, —ç—Ç–æ—Ç –∫–æ–¥ –ø–æ–∫–∞–∂–µ—Ç—Å—è –¥–æ–≤–æ–ª—å–Ω–æ –∑–Ω–∞–∫–æ–º—ã–º. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∞—Å—Å—ã `TReader` –∏ `TWriter` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Ç–æ–∫–æ–º. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –º—ã –ø–æ–º–µ—â–∞–µ–º –≤ –ø–æ—Ç–æ–∫ —Å—Ç—Ä–æ–∫—É –∏ —á–∏—Å–ª–æ –æ—Ç –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ–Ω–∏ —Ç–∞–∫–∂–µ –ª–µ–≥–∫–æ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –ø–æ—Ç–æ–∫–∞. –°–Ω–æ–≤–∞ —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é –¥–µ—Ä–µ–≤–∞ –≤ —Ñ–∞–π–ª. –ù–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –º—ã —É–≤–∏–¥–∏–º –∏–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É. –í —Ñ–∞–π–ª–µ —É–∂–µ –Ω–µ –±—É–¥–µ—Ç –ø—Ä–µ–∂–Ω–µ–≥–æ –º—É—Å–æ—Ä–∞, –∞ —Å—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –Æ–Ω–∏–∫–æ–¥–µ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã *null-terminating* (`\#0`) —Å–∏–º–≤–æ–ª–æ–º. –ü–æ —Å–æ—Å–µ–¥—Å—Ç–≤—É —Å –Ω–∏–º–∏ –±—É–¥—É—Ç —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è —á–∏—Å–ª–∞. –í–µ—Ä–Ω–µ–º—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –û—á–∏—Å—Ç–∏—Ç–µ –¥–µ—Ä–µ–≤–æ –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–≥—Ä—É–∑–∫–∏.

–í—É–∞–ª—è! –î–µ—Ä–µ–≤–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ —Å–≤–æ–µ–º –ø–µ—Ä–≤–æ–∑–¥–∞–Ω–Ω–æ–º –≤–∏–¥–µ. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –í—ã –º–æ–∂–µ—Ç–µ —Ö—Ä–∞–Ω–∏—Ç—å –ª—é–±—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö (–∫—Ä–æ–º–µ *referenced* –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ) –≤ –±–∏–Ω–∞—Ä–Ω–æ–º —Ñ–∞–π–ª–µ –∏ –ª–µ–≥–∫–æ –∏—Ö –∑–∞–≥—Ä—É–∂–∞—Ç—å.

## 6.2. –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –≤ XML —Ñ–∞–π–ª–µ.

–ù–æ —á—Ç–æ –µ—Å–ª–∏ –í–∞—Å –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –≤ –±–∏–Ω–∞—Ä–Ω–æ–º —Ñ–∞–π–ª–µ? –ß—Ç–æ –µ—Å–ª–∏ —É –í–∞—Å –µ—Å—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π –í—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å? –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ –∑–∞–≥—Ä—É–∑–∫–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∞–º–æ–º—É. –í–æ—Ç –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –∫–∞–∫ –º–æ–∂–Ω–æ —Ç–æ –∂–µ —Å–∞–º–æ–µ –¥–µ—Ä–µ–≤–æ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ —Ö—Ä–∞–Ω–∏—Ç—å –≤ **XML** —Ñ–∞–π–ª–µ. –î–ª—è —Ä–∞–±–æ—Ç—ã —Å **XML** –Ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞—Ä—Å–µ—Ä –æ—Ç Microsoft (`TXMLDocument`). –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, –í–∞–º –Ω–∏—á—Ç–æ –Ω–µ –º–µ—à–∞–µ—Ç –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ø—Ä–∏–º–µ—Ä –ø–æ–¥ –í–∞—à –ª—é–±–∏–º—ã–π –ø–∞—Ä—Å–µ—Ä.

–ó–∞–≥—Ä—É–∑–∫–∞:

```delphi
procedure TfrmMain.BtnLoadXMLClick(Sender: TObject);
var
  XMLDocument: TXMLDocument;

  procedure LoadXML(const ANodeList: IXMLNodeList; AParent: PVirtualNode);
  var
    i: Integer;
    NewNode: PVirtualNode;
    NodeData: PNodeData;
  begin
    for i := 0 to ANodeList.Count - 1 do
    begin
      NewNode := VT.AddChild(AParent);
      NodeData := VT.GetNodeData(NewNode);
      with NodeData^ do
      begin
        Caption := VarToWideStr(ANodeList[i].Attributes['Caption']);
        Value := StrToIntDef(
                VarToStr(
                ANodeList[i].Attributes['Value']
                ), 0);
      end;
      LoadXML(ANodeList[i].ChildNodes, NewNode);
    end;
  end;

begin
  if not FileExists('vt.xml') then
  begin
    MessageBox(Handle, '–§–∞–π–ª vt.xml –Ω–µ –Ω–∞–π–¥–µ–Ω.', PChar(Application.Title),
      MB_ICONINFORMATION + MB_OK);
    Exit;
  end;
  XMLDocument := TXMLDocument.Create(Self);
  try
    XMLDocument.LoadFromFile('vt.xml');
    // –î–ª—è –∫–∞–∂–¥–æ–π –≤–µ—Ç–∫–∏ XML –¥–µ—Ä–µ–≤–∞ —Å–æ–∑–¥–∞—Ç—å —É–∑–µ–ª –≤ –¥–µ—Ä–µ–≤–µ –∏ –∑–∞—Ä—É–∑–∏—Ç—å –ø–æ–ª—è
    // –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∞—Ç—Ç—Ä–∏–±—É—Ç–æ–≤
    // –ù–µ –∑–∞–±—ã–≤–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–ª–æ–∫–∏ Begin/End Update.
    VT.BeginUpdate;
    try
      LoadXML(XMLDocument.DocumentElement.ChildNodes, nil);
    finally
      VT.EndUpdate;
    end;
  finally
    FreeAndNil(XMLDocument);
  end;
end;
```

–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:

```delphi
procedure TfrmMain.BtnSaveXMLClick(Sender: TObject);
var
  XMLDocument: TXMLDocument;

  procedure SaveXML(ANode: PVirtualNode; const AParent: IXMLNode);
  var
    i: Integer;
    NewNode: IXMLNode;
    NextNode: PVirtualNode;
    NodeData: PNodeData;
  begin
    NextNode := ANode.FirstChild;
    if Assigned(NextNode) then
      repeat
        NodeData := VT.GetNodeData(NextNode);
        NewNode := AParent.AddChild('Node');
        with NewNode, NodeData^ do
        begin
          Attributes['Caption'] := Caption;
          Attributes['Value'] := Value;
        end;
        SaveXML(NextNode, NewNode);
        NextNode := NextNode.NextSibling;
      until
        NextNode = nil;
  end;

begin
  XMLDocument := TXMLDocument.Create(Self);
  try
    with XMLDocument do
    begin
      Active := True;
      Encoding := 'UTF-16';
      AddChild('VirtualTreeview');
      Options := Options + [doNodeAutoIndent];
    end;
    SaveXML(VT.RootNode, XMLDocument.DocumentElement);
    XMLDocument.SaveToFile('vt.xml');
  finally
    FreeAndNil(XMLDocument);
  end;
end;
```

## 6.3. –≠–∫—Å–ø–æ—Ä—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –¥–µ—Ä–µ–≤–∞ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã.

**VT** –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö. –ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç, –Æ–Ω–∏–∫–æ–¥, **RTF** –∏ **HTML**. –ß—Ç–æ –ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ, **VT** —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ —Ç–µ–∫—Å—Ç, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º —Ç–∞–±–ª–∏—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –í–æ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–∏–º–µ—Ä —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ **HTML** —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ —Ñ–∞–π–ª. –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∂–µ.

```delphi
procedure TfrmMain.BtnExportHTMLClick(Sender: TObject);
const
  HTMLHead = '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">'#13#10 +
    '<html>'#13#10 +
    '<head>'#13#10 +
    '  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">'#13#10 +
    '  <title>Virtual Treeview HTML</title>'#13#10 +
    '</head>'#13#10 +
    '<body>'#13#10;
  HTMLFoot = '</body>'#13#10 +
    '</html>' + #13#10;
var
  Fs: TFileStream;
  Str: String;
  Data: Pointer;
begin
  Fs := TFileStream.Create('html.html', fmCreate);
  try
    Str := HTMLHead + VT.ContentToHTML(tstAll) + HTMLFoot;
    Data := PChar(Str);
    Fs.WriteBuffer(Data^, Length(Str));
  finally
    FreeAndNil(fs);
  end;
  ShellExecute(Handle, 'open', 'html.html', nil, nil, SW_RESTORE);
end;
```

###### üí° –ü—Ä–∏–º–µ—Ä, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π –∑–∞–≥—Ä—É–∑–∫—É –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ *Fig 1.6.*

## 7.0. –û–±–∑–æ—Ä —Ç–∏–ø–∞ TVirtualNode.

–î–æ —Å–∏—Ö –ø–æ—Ä –Ω–∞—à–∞ —Ä–∞–±–æ—Ç–∞ —Å **VT** –Ω–µ–∏–∑–º–µ–Ω–Ω–æ –±—ã–ª–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —É–∑–ª–∞–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–∏–ø–æ–º `TVirtualNode`, –Ω–æ –º—ã –Ω–µ —É–¥–µ–ª—è–ª–∏ –µ–º—É –æ—Å–æ–±–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è. –ê –≤–µ–¥—å –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –º–Ω–æ–≥–æ –ø–æ–ª–µ–∑–Ω—ã—Ö –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞—Ç—å —Ç–∏–ø –æ—Ç–º–µ—Ç–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —É–∑–ª–æ–≤ –∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫–æ –º–Ω–æ–≥–∏–º –µ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞–º. –í–æ—Å–ø–æ–ª–Ω–∏–º —ç—Ç–æ—Ç –ø—Ä–æ–±–µ–ª.

## 7.1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞.

–ö–∞–∂–¥—ã–π —É–∑–µ–ª, —è–≤–ª—è—è—Å—å —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º —Ç–∏–ø–∞ `TVirtualNode`, —Å–æ–¥–µ—Ä–∂–∏—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å —É—Å–ø–µ—Ö–æ–º –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–¥–∏ –ª—é–±—ã—Ö —Ü–µ–ª–µ–π.

-   **Index** ‚Äî –∏–Ω–¥–µ–∫—Å —É–∑–ª–∞ –≤ –¥–µ—Ä–µ–≤–µ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –∫ —Å–≤–æ–µ–º—É —Ä–æ–¥–∏—Ç–µ–ª—é. –¢.–µ. –∞–±—Å–æ–ª—é—Ç–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º –æ–Ω –Ω–µ —è–≤–ª—è–µ—Ç—Å—è.

-   **ChildCount** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–∑–ª–∞. –í—Ä—É—á–Ω—É—é –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è. –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Å–æ–±—ã—Ç–∏—è `OnInitChildren`.

-   **NodeHeight** ‚Äî –≤—ã—Å–æ—Ç–∞ —É–∑–ª–∞. **VT** –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∑–ª–∞–º –∏–º–µ—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ç–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±—É–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–µ–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–æ –Ω–∏–∂–µ. –§–∞–∫—Ç–∏—á–µ—Å–∫–∏, —ç—Ç–æ *read-only* –ø–æ–ª–µ, —Ç.–∫. –µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –∫—Ä–æ–º–µ –∫–∞–∫ –∫ –≥–ª—é–∫–∞–º –æ—Ç—Ä–∏—Å–æ–≤–∫–∏, –Ω–∏ –∫ —á–µ–º—É –Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —ç—Ç–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤ —Å–æ–±—ã—Ç–∏–∏ `OnMeasureItem`. –ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–≥–æ –ø–æ–ª—è, —Ç–æ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏—Ç—å `TreeOptions.MiscOptions.toVariableNodeHeight` –æ–ø—Ü–∏—é –¥–µ—Ä–µ–≤–∞.

-   **States** ‚Äî –Ω–∞–±–æ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–∑–ª–∞.

    -   **vsInitialized** ‚Äî `True`, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–π —É–∑–µ–ª –ø—Ä–æ—à–µ–ª —Å–æ–±—ã—Ç–∏–µ `OnInitNode`.

    -   **vsChecking** ‚Äî `True`, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∂–∞–ª –æ—Ç–º–µ—Ç–∫—É –∏ –µ—â–µ –Ω–µ –æ—Ç–ø—É—Å—Ç–∏–ª –∫–Ω–æ–ø–∫—É –º—ã—à–∏.

    -   **vsCutOrCopy** ‚Äî —É–∑–µ–ª –±—ã–ª –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –≤—Å—Ç–∞–≤–∫–∏.

    -   **vsDisabled** ‚Äî —É–∑–µ–ª –≤—ã–∫–ª—é—á–µ–Ω –∏ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    -   **vsDeleting** ‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –¥–µ—Ä–µ–≤–æ–º –≤ `True` —Å—Ä–∞–∑—É –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ —É–∑–µ–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–¥–∞–ª–µ–Ω.

    -   **vsExpanded** ‚Äî `True`, –µ—Å–ª–∏ —É–∑–µ–ª —Ä–∞—Å–∫—Ä—ã—Ç.

    -   **vsHasChildren** ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –Ω–∞–ª–∏—á–∏–µ –¥–æ—á–µ—Ä–Ω–∏—Ö —É–∑–ª–æ–≤. –ü—Ä–∏ —ç—Ç–æ–º —É–∑–µ–ª –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–µ–Ω –∏—Ö –∏–º–µ—Ç—å.

    -   **vsVisible** ‚Äî `True`, –µ—Å–ª–∏ —É–∑–µ–ª –≤–∏–¥–Ω–æ –≤ –¥–µ—Ä–µ–≤–µ.

    -   **vsSelected** ‚Äî `True`, –µ—Å–ª–∏ —É–∑–µ–ª –≤—ã–¥–µ–ª–µ–Ω.

    -   **vsAllChildrenHidden** ‚Äî `True`, –µ—Å–ª–∏ —É —É–∑–ª–∞ –≤–∫–ª—é—á–µ–Ω–æ —Å–≤–æ–π—Å—Ç–≤–æ `vsHasChildren`, –Ω–æ –≤—Å–µ –µ–≥–æ –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø—Ä—è—Ç–∞–Ω—ã (–∏–º–µ—é—Ç —Å–≤–æ–π—Å—Ç–≤–æ `vsVisible` –≤ `True`).

    -   **vsClearing** ‚Äî `True`, –µ—Å–ª–∏ –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã –Ω–∞—á–∞–ª–∏ —É–¥–∞–ª—è—Ç—å—Å—è.

    -   **vsMultiline** ‚Äî `True`, –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç —É–∑–ª–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω, —á—Ç–æ–±—ã —Å–æ–≤–ø–∞—Å—Ç—å —Å —à–∏—Ä–∏–Ω–æ–π –∫–æ–ª–æ–Ω–∫–∏.

    -   **vsHeightMeasured** ‚Äî `True`, –µ—Å–ª–∏ –≤—ã—Å–æ—Ç–∞ —É–∑–ª–∞ –±—ã–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Å–æ–±—ã—Ç–∏—è `OnMeasureItem`.

    -   **vsToggling** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ—Ä–µ–≤–æ–º –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è –ø—Ä–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–∏/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —É–∑–ª–∞.

-   **Align** ‚Äî —Å–º–µ—â–µ–Ω–∏–µ —É–∑–ª–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç **0** –¥–æ **255**. –ß–µ–º –±–æ–ª—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–µ–º –Ω–∏–∂–µ –±—É–¥—É—Ç —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –∏ –æ—Ç–º–µ—Ç–∫–∞. –î–∞–Ω–Ω–æ–µ –ø–æ–ª–µ —Ç–µ–º –Ω–µ –º–µ–Ω–µ–µ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ —É–∑–ª–µ. –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å–æ —Å–≤–æ–π—Å—Ç–≤–æ–º –¥–µ—Ä–µ–≤–∞ `NodeAlignment`, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–æ –Ω–∏–∂–µ. –í–æ–∑–º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Å–æ–±—ã—Ç–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

-   **CheckState** ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–º–µ—Ç–∫–∏.

    -   **csUncheckedNormal** ‚Äî —É–∑–µ–ª –Ω–µ –æ—Ç–º–µ—á–µ–Ω –∏ –Ω–µ –∑–∞–∂–∞—Ç.

    -   **csUncheckedPressed** ‚Äî —É–∑–µ–ª –Ω–µ –æ—Ç–º–µ—á–µ–Ω, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É –º—ã—à–∏ –Ω–∞–¥ –æ—Ç–º–µ—Ç–∫–æ–π.

    -   **csCheckedNormal** ‚Äî —É–∑–µ–ª –æ—Ç–º–µ—á–µ–Ω.

    -   **csCheckedPressed** ‚Äî —É–∑–µ–ª –∑–∞–∂–∞—Ç, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É –º—ã—à–∏ –Ω–∞–¥ –æ—Ç–º–µ—Ç–∫–æ–π.

    -   **csMixedNormal** ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–º–µ—Ç–æ–∫ —Ç–∏–ø–∞ `TCheckBox` –≤ —É–∑–ª–∞—Ö —Å–æ —Å–≤–æ–π—Å—Ç–≤–æ–º `ctTriStateCheckBox`. –û–±–æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ—Ç–º–µ—Ç–∫–∞ –∏–º–µ–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–∞–Ω–∞–ª–æ–≥ `Grayed` –≤ `TCheckBox`).

    -   **csMixedPressed** ‚Äî —Ç–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ –æ—Ç–º–µ—Ç–∫–∞ –∑–∞–∂–∞—Ç–∞ –ª–µ–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏.

-   **CheckType** ‚Äî —Ç–∏–ø –æ—Ç–º–µ—Ç–∫–∏. –í–æ–∑–º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Å–æ–±—ã—Ç–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

    -   **ctNone** ‚Äî —É–∑–µ–ª –±–µ–∑ –æ—Ç–º–µ—Ç–∫–∏.

    -   **ctTriStateCheckBox** ‚Äî —É–∑–µ–ª —Å –æ—Ç–º–µ—Ç–∫–æ–π —Ç–∏–ø–∞ `TCheckBox`, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –∏–º–µ—Ç—å 3 —Å–æ—Å—Ç–æ—è–Ω–∏—è (–æ—Ç–º–µ—á–µ–Ω–∞, *grayed,* –Ω–µ –æ—Ç–º–µ—á–µ–Ω–∞).

    -   **ctCheckBox** ‚Äî —É–∑–µ–ª —Å –æ—Ç–º–µ—Ç–∫–æ–π —Ç–∏–ø–∞ `TCheckBox`, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –∏–º–µ—Ç—å 2 —Å–æ—Å—Ç–æ—è–Ω–∏—è.

    -   **ctRadioButton** ‚Äî —É–∑–µ–ª —Å –æ—Ç–º–µ—Ç–∫–æ–π —Ç–∏–ø–∞ `TRadioButton`.

    -   **ctButton** ‚Äî —É–∑–µ–ª —Å –∫–Ω–æ–ø–∫–æ–π —Å–ª–µ–≤–∞ –æ—Ç –Ω–∞–¥–ø–∏—Å–∏.

-   **Dummy** ‚Äî –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —É–∑–ª–∞ –¥–æ —á–µ—Ç—ã—Ä–µ—Ö –±–∞–π—Ç–æ–≤ (`DWORD`).

-   **TotalCount** ‚Äî —Å—É–º–º–∞ —É–∑–ª–∞ –∏ –≤—Å–µ—Ö –µ–≥–æ –¥–æ—á–µ—Ä–Ω–∏—Ö —É–∑–ª–æ–≤ –∏ –∏—Ö –¥–æ—á–µ—Ä–Ω–∏—Ö —É–∑–ª–æ–≤ –∏ —Ç.–¥.

-   **TotalHeight** ‚Äî –æ–±—â–∞—è –≤—ã—Å–æ—Ç–∞, –∑–∞–Ω–∏–º–∞–µ–º–∞—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ –¥–∞–Ω–Ω—ã–º —É–∑–ª–æ–º –∏ –≤—Å–µ–º–∏ –µ–≥–æ –¥–æ—á–µ—Ä–Ω–∏–º–∏ —É–∑–ª–∞–º–∏.

-   **Parent** ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —É–∑–µ–ª —Ä–æ–¥–∏—Ç–µ–ª—è –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞.

-   **PrevSibling** ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —É–∑–µ–ª —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–π —É–∑–µ–ª —è–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º –≤ —Å–ø–∏—Å–∫–µ, —Ç–æ –ø–æ–ª–µ —Ä–∞–≤–Ω–æ `nil`.

-   **NextSibling** ‚Äî —Ç–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª –≤ —Å–ø–∏—Å–∫–µ.

-   **FirstChild** ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å–∞–º—ã–π –ø–µ—Ä–≤—ã–π –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª.

-   **LastChild** ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å–∞–º—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª.

## 7.2. –û—Ç–º–µ—Ç–∫–∏ –¥–ª—è —É–∑–ª–∞.

–ö–∞–∫ –í—ã –º–æ–≥–ª–∏ —É–∂–µ –≤–∏–¥–µ—Ç—å –≤—ã—à–µ, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `TListView` –∏ `TTreeView` —É **VT** –µ—Å—Ç—å –∞–∂ —á–µ—Ç—ã—Ä–µ (!) –≤–∏–¥–∞ –æ—Ç–º–µ—Ç–∫–∏. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–∞–∂–¥—ã–π –ø–æ–¥—Ä–æ–±–Ω–µ–µ.

-   **ctCheckBox** ‚Äî –æ—Ç–º–µ—Ç–∫–∞ —Ç–∏–ø–∞ `TCheckBox`, –∑–Ω–∞–∫–æ–º–∞—è –í–∞–º –ø–æ `TListView` –∏ `TTreeView`. –û–¥–∏–Ω —Ä–∞–∑ –Ω–∞–∂–∞–ª ‚Äî –ø–æ–≤–µ—Å–∏–ª –≥–∞–ª–æ—á–∫—É, –¥—Ä—É–≥–æ–π —Ä–∞–∑ –Ω–∞–∂–∞–ª ‚Äî —Å–Ω—è–ª –≥–∞–ª–æ—á–∫—É.

-   **ctRadioButton** ‚Äî –æ—Ç–º–µ—Ç–∫–∞ —Ç–∏–ø–∞ `TRadioButton`. –í —Å–ø–∏—Å–∫–µ —É–∑–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–º–µ—á–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —É–∑–µ–ª.

-   **ctTriStateCheckBox** ‚Äî —ç—Ç–æ –æ—Ç–º–µ—Ç–∫–∞ –Ω–∞–ø–æ–¥–æ–±–∏–µ `TCheckBox`, –Ω–æ –≤–∫–ª—é—á–∞—é—â–∞—è –≤ —Å–µ–±—è —Ç–∞–∫–∂–µ —Ç—Ä–µ—Ç—å–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ *(grayed)*, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–Ω–æ–µ –≤ –≤–∏–¥–µ –∫–≤–∞–¥—Ä–∞—Ç–∞, –∞ –Ω–µ –≥–∞–ª–∫–∏. –¢–∞–∫–æ–π –≤–∏–¥ –æ—Ç–º–µ—Ç–æ–∫ —á–∞—Å—Ç–æ –º–æ–∂–Ω–æ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, –ø—Ä–µ–¥–ª–∞–≥–∞—é—â–∏—Ö –≤—ã–±—Ä–∞—Ç—å –∫–∞–∫–æ–π-—Ç–æ –Ω–∞–±–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏. –í –Ω–∏—Ö –æ—Ç–º–µ—Ç–∫–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç *grayed*-–≤–∏–¥, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏.

-   **ctButton** ‚Äî –Ω–µ–º–Ω–æ–≥–æ –Ω–µ–æ–±—ã—á–Ω—ã–π –≤–∏–¥ –æ—Ç–º–µ—Ç–∫–∏. –û—á–µ–Ω—å —É–¥–æ–±–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–æ–∫–∞–∑–∞ popup-–º–µ–Ω—é –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ —É–∑–ª–∞. –°–º–æ—Ç—Ä–∏—Ç—Å—è –¥–æ–≤–æ–ª—å–Ω–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ.

–£—á—Ç–∏—Ç–µ, —á—Ç–æ –æ—Ç–º–µ—Ç–∫–∏ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –≤ –≥–ª–∞–≤–Ω–æ–π –∫–æ–ª–æ–Ω–∫–µ –¥–µ—Ä–µ–≤–∞, —Ç.–µ. –≤ —Ç–æ–π, —á—Ç–æ –∏–º–µ–µ—Ç –∏–Ω–¥–µ–∫—Å **MainColumn**.

–ò–¥–µ–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–º–µ—Ç–æ–∫ ‚Äî —Å–æ–±—ã—Ç–∏–µ `OnInitNode`:

```delphi
procedure TfrmMain.VTInitChildren(Sender: TBaseVirtualTree; Node: PVirtualNode;
  var ChildCount: Cardinal);
begin
  if Sender.GetNodeLevel(Node) < 5 then
    ChildCount := 6
  else
    ChildCount := 0;
end;

procedure TfrmMain.VTInitNode(Sender: TBaseVirtualTree; ParentNode,
  Node: PVirtualNode; var InitialStates: TVirtualNodeInitStates);
var
  Lvl: Integer;
begin
  Lvl := Sender.GetNodeLevel(Node);
  if Lvl < 5 then
  begin
    InitialStates := InitialStates + [ivsHasChildren];
    case Lvl of
      0: Node.CheckType := ctButton;
      1: Node.CheckType := ctRadioButton;
      2: Node.CheckType := ctTriStateCheckBox;
      3: Node.CheckType := ctTriStateCheckBox;
      4: Node.CheckType := ctCheckBox;
      5: Node.CheckType := ctNone;
    end;
  end;
end;
```

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –¥–µ—Ä–µ–≤–æ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è —à–µ—Å—Ç—å—é —É–∑–ª–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —É–∑–ª–∞ –ø–æ–∫–∞ –∏—Ö —É—Ä–æ–≤–µ–Ω—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç —à–µ—Å—Ç–∏. –¢–∏–ø –æ—Ç–º–µ—Ç–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —É—Ä–æ–≤–Ω–µ–º –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ —É–∑–ª–∞.

–° –æ—Ç–º–µ—Ç–∫–∞–º–∏ —Å–≤—è–∑–∞–Ω—ã —Å–æ–±—ã—Ç–∏—è:

-   **OnChecking** ‚Äî –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –æ—Ç–º–µ—Ç–∫—É –∏ –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –æ—Ç–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ –º—ã—à–∏.

-   **OnChecked** ‚Äî –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –±—ã–ª–∞ –æ—Ç–ø—É—â–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –º—ã—à–∏.

**VT** —Ç–∞–∫–∂–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ—Ç–º–µ—Ç–æ–∫. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –æ—Ç–º–µ—Ç–∫–∏ –∏ –µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π. **VT** —É–∂–µ –∏–º–µ–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥–æ—Ç–æ–≤—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –¥–ª—è –æ—Ç–º–µ—Ç–æ–∫, –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ö –≤ —Å–≤–æ–π—Å—Ç–≤–µ `CheckImageKind`. –ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –ø–æ–º–µ—Å—Ç–∏—Ç–µ –∏—Ö –≤ `TImageList` –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ –∫ –¥–µ—Ä–µ–≤—É —á–µ—Ä–µ–∑ —Å–≤–æ–π—Å—Ç–≤–æ `CustomCheckImages`. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ —Å–≤–æ–π—Å—Ç–≤–æ CheckImageKind –≤ ckCustom –∏ –æ—Ç–º–µ—Ç–∫–∏ –ø—Ä–∏–º—É—Ç –≤–∏–¥ –í–∞—à–∏—Ö –∫–∞—Ä—Ç–∏–Ω–æ–∫. –í –ø–∞–ø–∫–µ `Fig 1.7/res` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ñ–∞–π–ª-–ø—Ä–∏–º–µ—Ä, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–º–µ—Ç–æ–∫. –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –∫–∞–∫ —à–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

## 7.3. –û–ø—Ü–∏—è toAutoTriStateTracking.

–ï—Å–ª–∏ –í—ã —É–∂–µ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–ª–∏ –ø—Ä–∏–º–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä–∏–ª–∏ –µ–≥–æ —Ä–∞–±–æ—Ç—É, —Ç–æ –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ –∑–∞–º–µ—Ç–∏–ª–∏, —á—Ç–æ —É —É–∑–ª–æ–≤ —Å –æ—Ç–º–µ—Ç–∫–æ–π —Ç–∏–ø–∞ ctTriStateCheckBox —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –æ—Ç–º–µ—Ç–∫–∏ –¥–æ—á–µ—Ä–Ω–∏—Ö —É–∑–ª–æ–≤. –ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω –∏–∑ –¥–æ—á–µ—Ä–Ω–∏—Ö —É–∑–ª–æ–≤ –Ω–µ –æ—Ç–º–µ—á–µ–Ω, —Ç–æ –∏ –¥–∞–Ω–Ω—ã–π —É–∑–µ–ª –Ω–µ –æ—Ç–º–µ—á–µ–Ω. –ï—Å–ª–∏ –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã –æ—Ç–º–µ—á–µ–Ω—ã, —Ç–æ –∏ –¥–∞–Ω–Ω—ã–π —É–∑–µ–ª –æ—Ç–º–µ—á–µ–Ω. –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å –¥–æ—á–µ—Ä–Ω–∏—Ö —É–∑–ª–æ–≤ –æ—Ç–º–µ—á–µ–Ω–∞, —Ç–æ –¥–∞–Ω–Ω—ã–π —É–∑–µ–ª –±—É–¥–µ—Ç –∏–º–µ—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–º–µ—Ç–∫–∏ *grayed* (`csMixedNormal`). –ù–∞–¥–æ –æ—Ç–¥–∞—Ç—å –¥–æ–ª–∂–Ω–æ–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∑–∞ —Ç–∞–∫—É—é —É–¥–æ–±–Ω—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å. –í–ø—Ä–æ—á–µ–º, –µ—Å–ª–∏ –í—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∏–∑–±–µ–∂–∞—Ç—å —Ç–∞–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞, —Ç–æ –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ –æ–ø—Ü–∏—é `toAutoTriStateTracking`, –æ–±–∏—Ç–∞—é—â—É—é –≤ TreeOptions.AutoOptions. –ò–º–µ–Ω–Ω–æ –æ–Ω–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤—Å–µ —ç—Ç–æ.

–ß—Ç–æ–±—ã –ª—É—á—à–µ –∑–∞–∫—Ä–µ–ø–∏—Ç—å –∑–Ω–∞–Ω–∏—è –æ `TVirtualNode` —Ç–∏–ø–µ, –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –ø—Ä–∏–º–µ—Ä–æ–º Figure 1.7. –í –Ω–µ–º –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ –≤–∏–¥–Ω–∞ —Ä–∞–±–æ—Ç–∞ –∫–∞–∂–¥–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞ —Ç–∏–ø–∞.

###### üí° –ü—Ä–æ–µ–∫—Ç, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π —Ä–∞–±–æ—Ç—É —Å —Ç–∏–ø–æ–º `TVirtualNode`, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ *Fig 1.7.*

## 8.0. –ù–µ–±–æ–ª—å—à–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞. –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤ VT, –Ω–µ –ø–æ–ø–∞–¥–∞—é—â–∏—Ö –ø–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –≤—ã—à–µ.

–Ø —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Ä–µ—à–∏–ª –≤—ã–¥–µ–ª–∏—Ç—å —Ç–∞–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –≥–ª–∞–≤—É, —á—Ç–æ–±—ã –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∫–∞—à—É —Å—Ä–µ–¥–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ –≤ —Ç–æ –∂–µ –≤—Ä–µ–º—è –∞–∫—Ü–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –∏ –Ω–∞ –Ω–∏—Ö. –í –∫–æ–Ω—Ü–µ —Å—Ç–∞—Ç—å–∏ –Ø —Ç–∞–∫–∂–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞—Å—Å–º–æ—Ç—Ä—é –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≤—Å–µ—Ö –æ–ø—Ü–∏–π **VT**.

## 8.1. –¶–≤–µ—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

**VT** –≤—ã–¥–µ–ª—è–µ—Ç –≤—Å–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Ü–≤–µ—Ç–∞ (–∫—Ä–æ–º–µ `Color`) –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –Ω–µ–±–æ–ª—å—à–æ–π –∫–ª–∞—Å—Å ‚Äî `TVTColors`, –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã–π –æ—Ç `TPersistent`, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ –í—ã —Å–º–æ–∂–µ—Ç–µ –ª–µ–≥–∫–æ –æ–±–º–µ–Ω–∏–≤–∞—Ç—å —Ü–≤–µ—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ–∂–¥—É –¥–µ—Ä–µ–≤—å—è–º–∏ –ø—Ä–æ—Å—Ç—ã–º –º–µ—Ç–æ–¥–æ–º Assign. –í—Å–µ —Ü–≤–µ—Ç–∞ **VT** –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–æ–ª–µ `Colors`.

-   **BorderColor** ‚Äî —Ü–≤–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –≥—Ä–∞–Ω–∏—Ü—ã, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º–æ–π –≤ —Å–≤–æ–π—Å—Ç–≤–µ **BorderWidth**.

-   **DisabledColor** ‚Äî —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ (vsDisabled) —É–∑–ª–∞.

-   **DropMarkColor** ‚Äî —Ü–≤–µ—Ç –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç–º–µ—Ç–∫–∏, –ø–æ—è–≤–ª—è—é—â–µ–π—Å—è –ø—Ä–∏ Drag&Drop –ø–µ—Ä–µ–Ω–æ—Å–µ —É–∑–ª–∞ –ø–æ –≤–µ—Ä—Ö—É –∏–ª–∏ –ø–æ –Ω–∏–∑—É –¥—Ä—É–≥–æ–≥–æ.

-   **DropTargetBorder** ‚Äî —Ü–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞, –∑–∞–∫—Ä–∞—à–∏–≤–∞—é—â–µ–≥–æ —É–∑–µ–ª, –≤ –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è Drag&Drop –≤—Å—Ç–∞–≤–∫–∞ (`DropTargetNode`).

-   **DragTargetColor** ‚Äî —Ü–≤–µ—Ç —Å–∞–º–æ–≥–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞, –∑–∞–∫—Ä–∞—à–∏–≤–∞—é—â–µ–≥–æ —É–∑–µ–ª, –≤ –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è Drag&Drop –≤—Å—Ç–∞–≤–∫–∞ (`DropTargetNode`).

-   **FocusedSelectionBorderColor** ‚Äî —Ü–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —É–∑–ª–∞.

-   **FocusedSelectionColor** ‚Äî —Ü–≤–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —É–∑–ª–∞.

-   **GridLineColor** ‚Äî —Ü–≤–µ—Ç –ª–∏–Ω–∏–π —Å–µ—Ç–∫–∏ —É –¥–µ—Ä–µ–≤–∞.

-   **HeaderHotColor** ‚Äî —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∫–æ–ª–æ–Ω–∫–∏, –Ω–∞–¥ –∫–æ—Ç–æ—Ä–æ–π —Å–µ–π—á–∞—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∫—É—Ä—Å–æ—Ä.

-   **HotColor** ‚Äî —Ü–≤–µ—Ç —É–∑–ª–∞, –Ω–∞–¥ –∫–æ—Ç–æ—Ä—ã–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∫—É—Ä—Å–æ—Ä.

-   **SelectionRectangleBlendColor** ‚Äî —Ü–≤–µ—Ç —Ñ–æ–Ω–∞, –∑–∞–ø–æ–ª–Ω—è—é—â–µ–≥–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –≤—ã–¥–µ–ª–µ–Ω–∏—è.

-   **SelectionRectangleBorderColor** ‚Äî —Ü–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è.

-   **TreeLineColor** ‚Äî —Ü–≤–µ—Ç —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ª–∏–Ω–∏–π —É–∑–ª–æ–≤.

-   **UnfocusedSelectionBorderColor** ‚Äî —Ü–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ, –Ω–æ –Ω–µ –∏–º–µ—é—â–µ–≥–æ —Ñ–æ–∫—É—Å —É–∑–ª–∞.

-   **UnfocusedSelectionColor** ‚Äî —Ü–≤–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ, –Ω–æ –Ω–µ –∏–º–µ—é—â–µ–≥–æ —Ñ–æ–∫—É—Å —É–∑–ª–∞.

–û—Å–æ–±–µ–Ω–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã –ø–∞—Ä—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –≥–¥–µ –æ–¥–∏–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—É, –∞ –¥—Ä—É–≥–æ–π –∑–∞ —Ñ–æ–Ω. –ö–æ–º–±–∏–Ω–∏—Ä—É—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ü–≤–µ—Ç–∞ –º–µ–∂–¥—É –Ω–∏–º–∏, –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –¥–æ–≤–æ–ª—å–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è.

## 8.2. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏.

**VT** –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É —Ç—Ä–µ–º—è —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏. –†–µ–∂–∏–º –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∑–∞–¥–∞–µ—Ç—Å—è –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `HintMode`:

-   **hmDefault** ‚Äî –ø–µ—Ä–µ–¥–∞–µ—Ç –≤—ã–≤–æ–¥ –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º **VCL**. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –≤ –ø–æ–¥—Å–∫–∞–∑–∫–µ –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω —Ç–µ–∫—Å—Ç –∏–∑ –ø–æ–ª—è `Hint`.

-   **hmHint** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å–æ–±—ã—Ç–∏–µ `OnGetHint`. –ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω –¥–ª—è –≤—ã–≤–æ–¥–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞.

-   **hmHintAndDefault** ‚Äî –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –¥–≤—É—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –ï—Å–ª–∏ –∫—É—Ä—Å–æ—Ä –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞–¥ —É–∑–ª–æ–º, —Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –±—É–¥–µ—Ç —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ –¥–µ–π—Å—Ç–≤–∏—é –ø–∞—Ä–∞–º–µ—Ç—Ä—É `hmHint`, –µ—Å–ª–∏ –∂–µ –∫—É—Ä—Å–æ—Ä –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞–¥ –ø—É—Å—Ç–æ–π –æ–±–ª–∞—Å—Ç—å—é –¥–µ—Ä–µ–≤–∞, —Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –±—É–¥–µ—Ç —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—É `hmDefault`.

-   **hmTooltip** ‚Äî –æ—Å–æ–±—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è, –µ—Å–ª–∏ –í—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É –Ω–∞–¥ —É–∑–ª–∞–º–∏, —Ç–µ–∫—Å—Ç –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ —É–º–µ—â–∞–µ—Ç—Å—è –≤ –∫–æ–ª–æ–Ω–∫–µ –∏ –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è `OnGetHint` –Ω–µ –Ω—É–∂–Ω–∞, **VT** —Å–∞–º –≤—Å–µ —Å–¥–µ–ª–∞–µ—Ç –∑–∞ –í–∞—Å. –£—á—Ç–∏—Ç–µ, —á—Ç–æ –µ—Å–ª–∏ –í—ã –≤—Å–µ –∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç–µ —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ, —Ç–æ —Å–≤–æ–∏–º –¥–µ–π—Å—Ç–≤–∏–µ–º –æ–Ω–æ –ø–µ—Ä–µ–∫—Ä–æ–µ—Ç —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä.

–ù–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä ‚Äî `hmTooltip`. –û–Ω –Ω–µ –æ–±—è–∑—É–µ—Ç –í–∞—Å –ª–∏—à–Ω–∏–º–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ –∏ –≤ —Ç–æ –∂–µ –≤—Ä–µ–º—è –æ–±–ª–µ–≥—á–∞–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ –¥–µ—Ä–µ–≤—É —Å —É–∑–ª–∞–º–∏ —Å –¥–ª–∏–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º. –ï—Å–ª–∏ –∂–µ –í—ã —Ö–æ—Ç–∏—Ç–µ –≤—ã–≤–æ–¥–∏—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ –ø–æ–¥—Å–∫–∞–∑–∫–µ, —Ç–æ –º–æ–∂–µ—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `hmHint`. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–π:

```delphi
procedure TfrmMain.VTGetHint(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex; var LineBreakStyle: TVTTooltipLineBreakStyle;
  var HintText: WideString);
begin
  if VT.HintMode <> hmTooltip then
    HintText := '–•–∏–Ω—Ç –∏–∑ OnGetHint —Å–æ–±—ã—Ç–∏—è: —Ç–µ–∫—Å—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏...'
  else
    HintText := VT.Text[Node, Column];
end;
```

–ü–∞—Ä–∞–º–µ—Ç—Ä `hmDefault` –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤. –≠—Ç–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–µ—Ä–µ–≤–∞ –∏–∑ –µ–≥–æ –ø–æ–ª—è `Hint`, –∫–∞–∫ –∏ —É –ª—é–±—ã—Ö –¥—Ä—É–≥–∏—Ö **VCL** –∫–ª–∞—Å—Å–æ–≤.

**VT** –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è –≤—Å–ø–ª—ã–≤–∞—é—â–µ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏. –ï–µ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `HintAnimation` –¥–µ—Ä–µ–≤–∞.

-   **hatNone** ‚Äî –≤—ã–∫–ª—é—á–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ–¥—Å–∫–∞–∑–∫–∏.

-   **hatFade** ‚Äî —ç—Ñ—Ñ–µ–∫—Ç –∑–∞—Ç—É—Ö–∞–Ω–∏—è, –ø–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏.

-   **hatSlide** ‚Äî —Å–∫–æ–ª—å–∑—è—â–∏–π —ç—Ñ—Ñ–µ–∫—Ç –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–∫–∏.

-   **hatSystemDefault** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —ç—Ñ—Ñ–µ–∫—Ç –∞–Ω–∏–º–∞—Ü–∏–∏, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –≤ —Å–∏—Å—Ç–µ–º–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä.

## 8.3. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è.

–¶–≤–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è –∑–∞–¥–∞–µ—Ç—Å—è –≤ –ø–æ–ª—è—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `Colors`, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –±—ã–ª —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω –≤—ã—à–µ. –ö—Ä–æ–º–µ —ç—Ç–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, **VT** –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —á–µ—Ä–µ–∑ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ —É–∑–ª—ã –±—É–¥–µ—Ç –ø—Ä–æ—Å–≤–µ—á–∏–≤–∞—Ç—å—Å—è —Ñ–æ–Ω –¥–µ—Ä–µ–≤–∞. –°—Ç–µ–ø–µ–Ω—å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞–µ—Ç—Å—è –≤ –ø–æ–ª–µ `SelectionBlendFactor`. –°–∞–º–∞ —ç—Ç–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –¥–µ—Ä–µ–≤–∞. –í–∫–ª—é—á–∏—Ç—å –µ–µ –º–æ–∂–Ω–æ, –∏–∑–º–µ–Ω–∏–≤ –æ–ø—Ü–∏—é `TreeOptions.PaintOptions.toUseBlendedSelection` –≤ `True`.

–ü–æ–º–∏–º–æ —ç—Ç–æ–≥–æ, **VT** –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –≤—ã–¥–µ–ª–µ–Ω–∏—è. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –≤—ã–¥–µ–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ –∑–∞–∫—Ä—É–≥–ª–∏—Ç—å —Å –ø–æ–º–æ—â—å—é –ø–æ–ª—è `SelectionCurveRadius`.

###### üí° –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ

**VT** –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è. –¢.–µ. –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—è `SelectionCurveRadius` –æ–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –æ–ø—Ü–∏–∏ `toUseBlendedSelection`.

–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –≤—ã–¥–µ–ª–µ–Ω–∏—è (—Ç–æ—Ç, —á—Ç–æ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –º—ã—à—å—é) —Ç–æ–∂–µ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Å–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –° –ø–æ–º–æ—â—å—é –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `DrawSelectionMode` –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –µ–≥–æ —Å—Ç–∏–ª—å. `smDottedRectangle` –¥–ª—è –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ –≤ –≤–∏–¥–µ —Ç–æ—á–µ–∫ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º –∑–∞–ª–∏–≤–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ `TTreeView` –∏ `TListView`), `smBlendedRectangle` –¥–ª—è –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤ —Å—Ç–∏–ª–µ Windows (–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Å–∏–Ω–∏–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é). –°–≤–æ–π—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Ç–µ–º–∞—Ö –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ –¥–µ—Ä–µ–≤–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏, —Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç `smBlendedRectangle`.

## 8.4. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–Ω–∏–º–∞—Ü–∏–∏.

–ù–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏.

-   **AnimationDuration** ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏–∏/—Å–∫—Ä—ã—Ç–∏–∏ —É–∑–ª–∞. –ê–Ω–∏–º–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç—Å—è –æ–ø—Ü–∏–µ–π `TreeOptions.AnimationOptions.toAnimatedToggle` –¥–µ—Ä–µ–≤–∞.

-   **AutoExpandDelay** ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞—É–∑—ã –ø–µ—Ä–µ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ä–∞—Å–∫—Ä—ã—Ç–∏–∏ —É–∑–ª–∞. –í–∫–ª—é—á–∞–µ—Ç—Å—è –æ–ø—Ü–∏–µ–π `TreeOptions.AutoOptions.toAutoExpand` –¥–µ—Ä–µ–≤–∞.

-   **AutoScrollDelay** ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞—É–∑—ã –ø–µ—Ä–µ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π –¥–µ—Ä–µ–≤–∞. –í–∫–ª—é—á–∞–µ—Ç—Å—è –æ–ø—Ü–∏–µ–π `TreeOptions.AutoOptions.toAutoScroll` –¥–µ—Ä–µ–≤–∞.

-   **AutoScrollInterval** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤, –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º–æ–µ –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –∫–æ–ª–µ—Å–∏–∫–∞ –º—ã—à–∏.

## 8.5. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–∏–Ω–∏–π —Å–µ—Ç–∫–∏ –∏ —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ª–∏–Ω–∏–π —É–∑–ª–æ–≤.

–î–∞–∂–µ –¥–ª—è —Ç–∞–∫–æ–π –º–µ–ª–æ—á–∏ –∫–∞–∫ —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ –∏ –ª–∏–Ω–∏–∏ —Å–µ—Ç–∫–∏ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏. –¶–≤–µ—Ç, –∫–∞–∫ –í—ã —É–∂–µ –∑–Ω–∞–µ—Ç–µ, –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `GridLineColor` –∏ `TreeLineColor`. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã, —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –∑–¥–µ—Å—å, –ø–æ–∑–≤–æ–ª—è—é—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç–∏–ª–µ–º –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —ç—Ç–∏—Ö —Å–∞–º–∏—Ö –ª–∏–Ω–∏–π.

–î–ª—è –ª–∏–Ω–∏–π, —Å–æ–µ–¥–∏–Ω—è—é—â–∏—Ö —É–∑–ª—ã, –∏–º–µ–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `LineMode`. –û–Ω –∏–Ω—Ç–µ—Ä–µ—Å–µ–Ω —Ç–µ–º, —á—Ç–æ –ø–æ–º–∏–º–æ –æ–±—ã—á–Ω–æ–≥–æ —Å—Ç–∏–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ `lmNormal` (–∞-–ª—è `TTreeView` / `TListView`) –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å —Å—Ç–∏–ª—å `lmBands`. –¢–æ–≥–¥–∞ —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ —É–∑–ª–æ–≤ –±—É–¥—É—Ç –æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å —Ä—è–¥—ã –∏ –∫–æ–ª–æ–Ω–∫–∏, –ø–æ—Ö–æ–∂–∏–µ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É –∏–ª–∏ –¥–∏–∞–≥—Ä–∞–º–º—É. –°–º–æ—Ç—Ä–∏—Ç—Å—è –¥–æ–≤–æ–ª—å–Ω–æ –Ω–µ–æ–±—ã—á–Ω–æ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ–±—ã—á–Ω—ã–º —Å—Ç–∏–ª–µ–º.

–î–ª—è –ª–∏–Ω–∏–π —Å–µ—Ç–∫–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `LineStyle`:

-   **lsCustomStyle** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —á—Ç–æ –í—ã —Å–∞–º–∏ –±—É–¥–µ—Ç–µ –∑–∞–¥–∞–≤–∞—Ç—å —Å—Ç–∏–ª—å –ª–∏–Ω–∏–π —Å–µ—Ç–∫–∏ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–µ `OnGetLineStyle`.

-   **lsDotted** ‚Äî –ª–∏–Ω–∏–∏ —Å–µ—Ç–∫–∏ –≤ –≤–∏–¥–µ –ø—É–Ω–∫—Ç–∏—Ä–∞.

-   **lsSolid** ‚Äî —Å—Ç–∏–ª—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π `TTreeView` / `TListView` (–æ–±—ã—á–Ω—ã–µ —Å–ø–ª–æ—à–Ω—ã–µ –ª–∏–Ω–∏–∏).

–ï—Å–ª–∏ –≤–∞–º –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —Å—Ç–∏–ª–µ–π *lsDotted* –∏ *lsSolid*, —Ç–æ –í—ã –≤–æ–ª—å–Ω—ã —É–∫–∞–∑–∞—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Å–æ–±—ã—Ç–∏—è `OnGetLineStyle`. –ï–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—É `Bits` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞—Ç—å –±–∏—Ç–º–∞–ø __6\*6__ –ø–∏–∫—Å–µ–ª–µ–π, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª–µ–º –Ω–∞ –º–∞—Å—Å–∏–≤ –±–∞–π—Ç (`TByteArray`). –í–æ—Ç –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä, —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–∏–π —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –ø—É–Ω–∫—Ç–∏—Ä–∞–º–∏ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ:

```delphi
procedure TfrmMain.VTGetLineStyle(Sender: TBaseVirtualTree; var Bits: Pointer);
var
  i: Integer;
begin
  Bits := @Arr;
  for i := 0 to Length(Arr) - 1 do
    Arr[i] := 254;
end;
```

## 8.6. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∑–ª–∞.

–ù–∞–º–∏ –æ—Å—Ç–∞–ª–∏—Å—å –Ω–µ—Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–º–∏ –µ—â–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–≤–æ–π—Å—Ç–≤, –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ –ø–æ–ª–æ–∂–µ–Ω–∏–µ —É–∑–ª–∞ –≤ —è—á–µ–π–∫–µ.

`NodeAlignment` –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —á–µ–≥–æ –±—É–¥–µ—Ç —Å–º–µ—â–∞—Ç—å—Å—è —É–∑–µ–ª. –°–º–µ—â–µ–Ω–∏–µ, –∫–∞–∫ –í—ã –ø–æ–º–Ω–∏—Ç–µ, –∑–∞–¥–∞–µ—Ç—Å—è –≤ –ø–æ–ª–µ `Align` `TVirtualNode` –∑–∞–ø–∏—Å–∏.

-   **naFromBottom** ‚Äî —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–∏–∂–Ω–µ–≥–æ –∫—Ä–∞—è —è—á–µ–π–∫–∏.

-   **naFromTop** ‚Äî —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ –∫—Ä–∞—è.

-   **naProportional** ‚Äî –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ, –Ω–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –Ω–∏ –≤ —Ç—É, –Ω–∏ –≤ –¥—Ä—É–≥—É—é —Å—Ç–æ—Ä–æ–Ω—É. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω–∞ –ø–æ–ª–æ–∂–µ–Ω–∏–µ —É–∑–ª–∞ –±—É–¥–µ—Ç –≤–ª–∏—è—Ç—å —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è `Align`.

–ü–∞—Ä–∞–º–µ—Ç—Ä `ButtonStyle` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è/—Å–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —É–∑–ª–∞. –£ –Ω–µ–≥–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Å–µ–≥–æ –¥–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è:

-   **bsRectangle** ‚Äî –∫–Ω–æ–ø–∫–∞ –≤ –≤–∏–¥–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ —Å –ø–ª—é—Å–æ–º/–º–∏–Ω—É—Å–æ–º.

-   **bsTriangle** ‚Äî –∫–Ω–æ–ø–∫–∞ –≤ –≤–∏–¥–µ –Ω–µ–±–æ–ª—å—à–æ–≥–æ —á–µ—Ä–Ω–æ–≥–æ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞. –ü–æ—Ö–æ–∂–∏–π –∏–º–µ—é—Ç —Å–ø–∏—Å–∫–∏ –∏ –¥–µ—Ä–µ–≤—å—è –±—Ä–∞—É–∑–µ—Ä–∞ Opera.

–ü–∞—Ä–∞–º–µ—Ç—Ä –∞–∫—Ç–∏–≤–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Å—Ç–∏–ª—è—Ö –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è.

–ò, –Ω–∞–∫–æ–Ω–µ—Ü, –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä ‚Äî `Indent`. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –¥–ª–∏–Ω—É –æ—Ç—Å—Ç—É–ø–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ —É–∑–ª–æ–≤. –ß–µ–º –±–æ–ª—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞, —Ç–µ–º –¥–∞–ª—å—à–µ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞ –±—É–¥—É—Ç —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –¥–æ—á–µ—Ä–Ω–∏–µ –∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ —É–∑–ª—ã.

## 8.7. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤.

–í–æ –≤—Å–µ—Ö –Ω–∞—à–∏—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –º—ã –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–µ—Ä–µ–≤–∞ ‚Äî –µ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞. –î—É–º–∞—é, –æ–± —ç—Ç–æ–º —Å—Ç–æ–∏—Ç —Å–∫–∞–∑–∞—Ç—å –ø–∞—Ä—É —Å–ª–æ–≤.

–ó–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫—É –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –æ—Ç–≤–µ—á–∞—é—Ç —Ç—Ä–∏ —Å–æ–±—ã—Ç–∏—è: `OnAdvancedHeaderDraw`, `OnHeaderDrawQueryElements` –∏ `OnHeaderDraw`. –í —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–∏ –Ø —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–ª –ø–µ—Ä–≤—ã–µ –¥–≤–∞, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã –≤ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏, –Ω–µ–∂–µ–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–µ. –° –Ω–∏–º —É–∂ –∫–∞–∫-–Ω–∏–±—É–¥—å —Å–∞–º–∏ —Å–ø—Ä–∞–≤–∏—Ç–µ—Å—å üòä

**VT** —Ä–µ–∞–ª–∏–∑—É–µ—Ç –æ—á–µ–Ω—å —É–¥–æ–±–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –ø–æ–∑–≤–æ–ª—è—è –∫–∞–∫–∏–µ-—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ä–∏—Å–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∞ –∫–∞–∫–∏–µ-—Ç–æ –æ—Å—Ç–∞–≤–ª—è—Ç—å –Ω–∞ –ø–æ–ø–µ—á–µ–Ω–∏–µ **VT**. –ù–∞–ø—Ä–∏–º–µ—Ä, –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –æ—Ç—Ä–∏—Å–æ–≤–∫—É —Ñ–æ–Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∫–æ–ª–æ–Ω–∫–∏, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –æ—Å—Ç–∞–≤–∏—Ç—å –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º –µ–µ —Ç–µ–∫—Å—Ç. –ò–ª–∏ –∂–µ –≤–æ–æ–±—â–µ –∏–∑–º–µ–Ω–∏—Ç—å –æ—Ç—Ä–∏—Å–æ–≤–∫—É —Ç–æ–ª—å–∫–æ –∫–∞–∫–æ–≥–æ-—Ç–æ –æ–¥–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞, –æ—Å—Ç–∞–≤–∏–≤ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –≤–∏–¥–µ. –ß—Ç–æ –ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ, –∏–∑–º–µ–Ω–µ–Ω–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–∞–∫ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Å—Ç–∏–ª—è—Ö –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è, —Ç–∞–∫ –∏ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã—Ö.

–°–æ–±—ã—Ç–∏–µ `OnHeaderDrawQueryElements` –∫–∞–∫ —Ä–∞–∑ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞—Ç—å –¥–µ—Ä–µ–≤—É —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω—è–µ–º—ã—Ö –≤–∞–º–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞.

-   **hpeBackground** ‚Äî —Ñ–æ–Ω –∑–∞–≥–æ–ª–æ–≤–∫–∞.

-   **hpeDropMark** ‚Äî –∏–∫–æ–Ω–∫–∞ Drag&Drop –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è.

-   **hpeHeaderGlyph** ‚Äî –∏–∫–æ–Ω–∫–∞ —Å–ª–µ–≤–∞ –æ—Ç —Ç–µ–∫—Å—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞.

-   **hpeSortGlyph** ‚Äî –∏–∫–æ–Ω–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏.

-   **hpeText** ‚Äî —Ç–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞.

–í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã –∑–∞–º–µ–Ω–∏–º —Ñ–æ–Ω –∏ —Ç–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞, –æ—Å—Ç–∞–≤–∏–≤ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```delphi
//---------------------------------------------------------------------------
// –ü–µ—Ä–µ–¥–∞—ë–º –≤ –Ω–∞–±–æ—Ä —Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –±—É–¥–µ–º –∑–∞–º–µ–Ω—è—Ç—å.
// –ù–µ–ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (hpeDropMark, hpeHeaderGlyph, hpeSortGlyph)
// –æ—Å—Ç–∞–Ω—É—Ç—Å—è –Ω–∞ —Å–æ–≤–µ—Å—Ç–∏ –¥–µ—Ä–µ–≤–∞.
//---------------------------------------------------------------------------
procedure TfrmMain.VTHeaderDrawQueryElements(Sender: TVTHeader;
  var PaintInfo: THeaderPaintInfo; var Elements: THeaderPaintElements);
begin
  // –ú—ã –±—É–¥–µ–º –∑–∞–º–µ–Ω—è—Ç—å —Ç–µ–∫—Å—Ç –∫–æ–ª–æ–Ω–æ–∫ –∏ —Ñ–æ–Ω –≤—Å–µ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞
  Elements := [hpeBackground, hpeText];
end;
```

–ê –≤–æ—Ç —Ç–∞–∫ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–∞–º–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏:

```delphi
procedure TfrmMain.VTAdvancedHeaderDraw(Sender: TVTHeader;
  var PaintInfo: THeaderPaintInfo; const Elements: THeaderPaintElements);
begin
  if hpeBackground in Elements then
    with PaintInfo.TargetCanvas do
    begin
      // –†–∏—Å—É–µ–º —Ñ–æ–Ω –≤—Å–µ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –¥–µ—Ä–µ–≤–∞
      Brush.Color := $00C9C9C9;
      FillRect(PaintInfo.PaintRectangle);
      // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç
      StretchDraw(PaintInfo.PaintRectangle, ImgGrad.Graphic);
      if PaintInfo.Column <> nil then
      begin
        // –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞–∫–æ–π-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–æ–ª–æ–Ω–∫–∏
        case PaintInfo.Column.Index of
          // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
          0: Draw(PaintInfo.PaintRectangle.Left + ((PaintInfo.PaintRectangle.Right - PaintInfo.PaintRectangle.Left) div 2) - (ImgUser.Width div 2),
            PaintInfo.PaintRectangle.Top, ImgUser.Graphic);
          // –ö–æ–ª-–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
          1: Draw(PaintInfo.PaintRectangle.Left + ((PaintInfo.PaintRectangle.Right - PaintInfo.PaintRectangle.Left) div 2) - (ImgMsg.Width div 2),
            PaintInfo.PaintRectangle.Top, ImgMsg.Graphic);
        end;
      end;
    end;
end;
```

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤–∫–ª—é—á–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–Ω—É—é –æ—Ç—Ä–∏—Å–æ–≤–∫—É –æ–ø—Ü–∏–µ–π –∑–∞–≥–æ–ª–æ–≤–∫–∞ `hoOwnerDraw`.

## 8.8. –ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ –Ω–∞–¥–ø–∏—Å–∏ –≤ —É–∑–ª–∞—Ö.

**VT** –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–≤–æ–∏–º —É–∑–ª–∞–º –∏–º–µ—Ç—å –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ –Ω–∞–¥–ø–∏—Å–∏, —Ä–∞–∑—Ä–µ—à–∞—è —ç—Ç–æ –æ–ø—Ü–∏–µ–π `vsMultiline` –¥–ª—è —É–∑–ª–∞. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–µ—Ä–µ–≤–∞ –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π —Å —É–¥–æ–±–Ω–æ–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π –ø–æ–ª–æ—Å–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏.

–ö—Ä–æ–º–µ —Å–≤–æ–µ–≥–æ —è–≤–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è (—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –≤ –æ–¥–Ω–æ–º —É–∑–ª–µ), —ç—Ç–æ —Å–≤–æ–π—Å—Ç–≤–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É –æ–±—Ä–µ–∑–∞—é—â–µ–º—É—Å—è —Ç–µ–∫—Å—Ç—É, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —É–º–µ—â–∞–µ—Ç—Å—è –≤ –≥—Ä–∞–Ω–∏—Ü–∞—Ö –∫–æ–ª–æ–Ω–∫–∏. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –Ω–µ—É–º–µ—â–∞—é—â–∏–π—Å—è —Ç–µ–∫—Å—Ç –Ω–∞ –Ω–æ–≤—ã–µ –∏ –Ω–æ–≤—ã–µ –ª–∏–Ω–∏–∏. –î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ—Å—Ç–∏ –ø—Ä–∏–Ω—è—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —É–∑–ª–∞:

```delphi
procedure TfrmMain.VTInitNode(Sender: TBaseVirtualTree; ParentNode,
  Node: PVirtualNode; var InitialStates: TVirtualNodeInitStates);
begin
  // –í–∫–ª—é—á–∞–µ–º/–≤—ã–∫–ª—é—á–∞–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ—Å—Ç–∏
  if CbMultiline.Checked then
    Include(InitialStates, ivsMultiline)
  else begin
    Exclude(InitialStates, ivsMultiline);
    // –ù–ï –ó–ê–ë–´–í–ê–ô–¢–ï –í–´–ü–û–õ–ù–Ø–¢–¨ –≠–¢–û:
    Node.States := Node.States - [vsMultiline];
    // –≠—Ç–æ –≤—ã–∫–ª—é—á–∏—Ç –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ—Å—Ç—å –¥–ª—è —É–∑–ª–æ–≤, –≥–¥–µ –æ–Ω–∞ —Ä–∞–Ω—å—à–µ –±—ã–ª–∞.
  end;
end;
```

–ù–æ —ç—Ç–æ –µ—â–µ –Ω–µ –≤—Å–µ. –≠—Ç–æ—Ç –∫–æ–¥ –ø–æ–º–æ–∂–µ—Ç —Ä–∞–∑–±–∏—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ –ª–∏–Ω–∏–∏, –Ω–æ –≤—ã—Å–æ—Ç—É —É–∑–ª–æ–≤ –æ–Ω –Ω–µ –∏–∑–º–µ–Ω–∏—Ç. –¢.–µ. –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è —Ç–∞–∫, —á—Ç–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—ã–µ –ª–∏–Ω–∏–∏ —Ç–µ–∫—Å—Ç–∞ —É–∂–µ –Ω–µ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã. –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ–¥–±–æ—Ä–∞ –≤—ã—Å–æ—Ç—ã —Å —É—á–µ—Ç–æ–º –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ—Å—Ç–∏ **VT** –∏–º–µ–µ—Ç –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω—ã–π –º–µ—Ç–æ–¥ ‚Äî `ComputeNodeHeight`. –û–Ω –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—ã—Å–æ—Ç—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–∑–ª–∞ –≤ —è—á–µ–π–∫–µ. –ü—Ä–∏–º–µ–Ω—è—Ç—å –º—ã –µ–≥–æ –±—É–¥–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Å–æ–±—ã—Ç–∏—è `OnMeasureItem`, —Ç–∞–º, –≥–¥–µ –∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤—ã—Å–æ—Ç–∞ —É–∑–ª–æ–≤:

```delphi
//---------------------------------------------------------------------------
// –ü–æ–¥—Å—á—ë—Ç –≤—ã—Å–æ—Ç—ã —É–∑–ª–æ–≤ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –≤—ã—Å–æ—Ç–æ–π –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
//---------------------------------------------------------------------------
procedure TfrmMain.VTMeasureItem(Sender: TBaseVirtualTree;
  TargetCanvas: TCanvas; Node: PVirtualNode; var NodeHeight: Integer);
begin
  if CbMultiline.Checked then
  begin
    NodeHeight := VT.ComputeNodeHeight(TargetCanvas, Node, 0) + 4;
    NodeHeight := Max(18, NodeHeight);
  end
  else
    NodeHeight := 18;
end;
```

–¢–µ–ø–µ—Ä—å –≤—Å–µ —Å–¥–µ–ª–∞–Ω–æ –≤–µ—Ä–Ω–æ.

## 8.9. –§–æ–Ω –¥–µ—Ä–µ–≤–∞.

–ü–æ—Å–ª–µ–¥–Ω–µ–µ –Ω–∞—à–µ —É–ø—É—â–µ–Ω–∏–µ ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `Background`, `BackgroundOffsetX` –∏ `BackgroundOffsetY`.

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–Ω–∏, –∫–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –Ω–∞ —Ñ–æ–Ω–µ –¥–µ—Ä–µ–≤–∞ —á—Ç–æ-—Ç–æ –Ω–∞–ø–æ–¥–æ–±–∏–µ —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏, ¬´–≤–æ–¥—è–Ω–æ–≥–æ¬ª (–ø—Ä–æ–∑—Ä–∞—á–Ω–æ–≥–æ) –∑–Ω–∞–∫–∞. –Ø—Ä–∫–∏–π –ø—Ä–∏–º–µ—Ä ‚Äî –ø–∞–ø–∫–∏ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –∏–ª–∏ –º—É–∑—ã–∫–∏ –≤ Windows XP, –≥–¥–µ –≤ –Ω–∏–∂–Ω–µ–º –ø—Ä–∞–≤–æ–º —É–≥–ª—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∞ —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∏–∑ –ø–∞–ø–æ–∫, –æ—Ç—Ä–∞–∂–∞—é—â–∞—è –µ–µ —Å—É—Ç—å.

-   **Background** ‚Äî —Å–∞–º–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è.

-   **BackgroundOffsetX** –∏ **BackgroundOffsetY** ‚Äî –µ–µ —Å–º–µ—â–µ–Ω–∏—è –ø–æ **X** –∏ **Y** –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–ø—Ü–∏—é –¥–µ—Ä–µ–≤–∞ `TreeOptions.PaintOptions.toShowBackground` –≤ `True`. –û–ø—Ü–∏—è `toStaticBackround` –∏–∑ —Ç–æ–≥–æ –∂–µ —Ä–∞–∑–¥–µ–ª–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∏–ª–∏ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –Ω–∞ –≤—Å—é –≤–∏–¥–∏–º—É—é –æ–±–ª–∞—Å—Ç—å.

–í —Å–æ–±—ã—Ç–∏–∏ `OnResize` –æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å –ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –µ–µ:

```delphi
//---------------------------------------------------------------------------
// –†–∞—Å–ø–æ–ª–∞–≥–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É –ø–æ —Ü–µ–Ω—Ç—Ä—É.
//---------------------------------------------------------------------------
procedure TfrmMain.VTResize(Sender: TObject);
begin
  VT.BackgroundOffsetX := (VT.Width div 2) - (VT.Background.Width div 2);
  VT.BackgroundOffsetY := (VT.Height div 2) - (VT.Background.Height div 2);
end;
```

###### üí° –ü—Ä–æ–µ–∫—Ç, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤ –∏ —Å–æ–±—ã—Ç–∏–π VT, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ *Fig 1.8.*

## 9.0. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ VT.

–ö–∞–∫ –∏ –æ–±–µ—â–∞–ª, –ø—Ä–∏–≤–æ–∂—É –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫ **VT** (TreeOptions) —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.

-   **AnimationOptions**:

    -   **toAnimatedToggle** ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∞–Ω–∏–º–∞—Ü–∏—é —Å–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è/—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

-   **AutoOptions**:

    -   **toAutoDropExpand** ‚Äî —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–µ—Ç —É–∑–µ–ª, –µ—Å–ª–∏ –æ–Ω –±—É–¥–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Ü–µ–ª—å—é Drag&Drop (`DropTargetNode`) –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è, –∑–∞–¥–∞–Ω–Ω–æ–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º AutoExpandDelay. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ `True`.

    -   **toAutoExpand** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç/—Å–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —É–∑–µ–ª –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–º —Ñ–æ–∫—É—Å–∞.

    -   **toAutoScroll** ‚Äî –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç –¥–µ—Ä–µ–≤–æ, –µ—Å–ª–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏—è Drag&Drop –∏ –∫—É—Ä—Å–æ—Ä –º—ã—à–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ä—è–¥–æ–º —Å –∫—Ä–∞—è–º–∏ –¥–µ—Ä–µ–≤–∞.

    -   **toAutoScrollOnExpand** ‚Äî –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç –¥–µ—Ä–µ–≤–æ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ–µ —á–∏—Å–ª–æ –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ —É–∑–ª–∞.

    -   **toAutoSort** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–µ—Ä–µ–≤–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `Header.SortDirection`, –∏–ª–∏ `Header.SortColumn`, –∏–ª–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —É–∑–ª–∞.

    -   **toAutoSpanColumns** ‚Äî –¥–æ–≤–æ–ª—å–Ω–æ –Ω–µ–æ–±—ã—á–Ω–∞—è –æ–ø—Ü–∏—è. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç, –Ω–µ –ø–æ–º–µ—â–∞—é—â–∏–π—Å—è –≤ –¥–∞–Ω–Ω–æ–π –∫–æ–ª–æ–Ω–∫–µ –Ω–∞ —Å–æ—Å–µ–¥–Ω—é—é, –µ—Å–ª–∏ –æ–Ω–∞ –ø—É—Å—Ç–∞ (–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç–∞).

    -   **toAutoTristateTracking** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ *grayed*-—Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —É–∑–ª–æ–≤ —Å —Ç–∏–ø–æ–º –æ—Ç–º–µ—Ç–∫–∏ `ctTriStateCheckBox`.

    -   **toAutoHideButtons** ‚Äî –∫–Ω–æ–ø–∫–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è/—Å–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞—Ç—å—Å—è –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞, –µ—Å–ª–∏ –≤—Å–µ –µ–≥–æ –¥–æ—á–µ—Ä–Ω–∏–µ –±—É–¥—É—Ç —Å–ø—Ä—è—Ç–∞–Ω—ã (`vsVisible`).

    -   **toAutoDeleteMovedNodes** ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å—Å—è –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–π Drag&Drop.

    -   **toDisableAutoscrollOnFocus** ‚Äî –≤—ã–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É –∫–æ–ª–æ–Ω–∫–∏ –∫ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏, –µ—Å–ª–∏ –æ–Ω–∞ –ø–æ–ª—É—á–∞–µ—Ç —Ñ–æ–∫—É—Å.

    -   **toAutoChangeScale** ‚Äî –∏–∑–º–µ–Ω—è–µ—Ç –≤—ã—Å–æ—Ç—É —É–∑–ª–æ–≤ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–æ–≤ Windows.

    -   **toAutoFreeOnCollapse** ‚Äî –ø—Ä–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–∏ —É–∑–ª–∞ –≤—Å–µ –µ–≥–æ –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã, –Ω–æ –æ–ø—Ü–∏—è `vsHasChildren` –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è.

    -   **toDisableAutoscrollOnEdit** ‚Äî –Ω–µ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç –¥–µ—Ä–µ–≤–æ –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —É–∑–ª–∞, —á—Ç–æ–±—ã —Ä–∞—Å–ø–æ–ª–æ–∂–∏—Ç—å –≤–∏–¥–∏–º—É—é –æ–±–ª–∞—Å—Ç—å –ø–æ —Ü–µ–Ω—Ç—Ä—É.

-   **MiscOptions**:

    -   **toAcceptOLEDrop** ‚Äî –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ä–µ–≤–æ, –∫–∞–∫ –≤–æ–∑–º–æ–∂–Ω—É—é —Ü–µ–ª—å –¥–ª—è *OLE* Drag&Drop.

    -   **toCheckSupport** ‚Äî –≤–∫–ª—é—á–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ—Ç–º–µ—Ç–æ–∫ –¥–ª—è —É–∑–ª–æ–≤.

    -   **toEditable** ‚Äî –≤–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —É–∑–ª–æ–≤. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä **VT** –∏ –í–∞—à–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ.

    -   **toFullRepaintOnResize** ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å –¥–µ—Ä–µ–≤–æ –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –µ–≥–æ —Ä–∞–∑–º–µ—Ä–æ–≤.

    -   **toGridExtensions** ‚Äî –≤–∫–ª—é—á–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ç–∫–∏ (–Ω–∞–ø–æ–¥–æ–±–∏–µ `TDBGrid`). –í —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –∏–∑–º–µ–Ω—è–µ—Ç—Å—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏. –£–¥–æ–±–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö —Å **VT**.

    -   **toInitOnSave** ‚Äî –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —É–∑–ª–æ–≤ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –ø–æ—Ç–æ–∫ –∏–ª–∏ —Ñ–∞–π–ª.

    -   **toReportMode** ‚Äî –¥–µ—Ä–µ–≤–æ –≤–µ–¥–µ—Ç —Å–µ–±—è –∫–∞–∫ `TListView` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π report mode.

    -   **toToggleOnDblClick** ‚Äî —É–∑–ª—ã –±—É–¥—É—Ç —Å–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å—Å—è/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å—Å—è –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º –∫–ª–∏–∫–µ –Ω–∞ –Ω–∏—Ö.

    -   **toWheelPanning** ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ –¥–µ—Ä–µ–≤—É —Å –ø–æ–º–æ—â—å—é –¥–≤–∏–∂–µ–Ω–∏–π –º—ã—à–∏ (panning). –≠—Ç–æ –æ—Å–æ–±—ã–π —Ä–µ–∂–∏–º –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –¥–µ—Ä–µ–≤–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π –æ–Ω–æ –≤—Ö–æ–¥–∏—Ç –ø–æ –Ω–∞–∂–∞—Ç–∏—é —Å—Ä–µ–¥–Ω–µ–π –∫–Ω–æ–ø–∫–∏ –º—ã—à–∏. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∫—É—Ä—Å–æ—Ä –Ω–∞—á–Ω–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤–∏–¥ —Å—Ç—Ä–µ–ª–æ–∫ –∏ –¥–µ—Ä–µ–≤–æ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞—Ç—å –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º, –ø–µ—Ä–µ–¥–≤–∏–≥–∞—è –∫—É—Ä—Å–æ—Ä –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –∫—Ä–∞—è–º –¥–µ—Ä–µ–≤–∞. –ß–µ–º –±–ª–∏–∂–µ –ø–æ–¥–æ–¥–≤–∏–≥–∞—Ç—å –∫—É—Ä—Å–æ—Ä, —Ç–µ–º –±—ã—Å—Ç—Ä–µ–µ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫–∞.

    -   **toReadOnly** ‚Äî –∑–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è –ª—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞, –≤ —Ç–æ–º —á–∏—Å–ª–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —É–∑–ª–∞–º–∏ –∏ –∏—Ö —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

    -   **toVariableNodeHeight** ‚Äî –≤–∫–ª—é—á–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∑–ª–æ–≤ —Ä–∞–∑–ª–∏—á–Ω–æ–π –≤—ã—Å–æ—Ç—ã. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –≤—ã—Å–æ—Ç—É —É–∑–ª–æ–≤ –¥–µ—Ä–µ–≤–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–±—ã—Ç–∏—è `OnMeasureItem`.

    -   **toFullRowDrag** ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –Ω–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è —É–∑–ª–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –º—ã—à—å—é –≤ –ª—é–±—É—é –æ–±–ª–∞—Å—Ç—å —É–∑–ª–∞, –∞ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ —Ç–µ–∫—Å—Ç—É –∏–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–µ. –î–æ–ª–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤–º–µ—Å—Ç–µ —Å –æ–ø—Ü–∏–µ–π `toDisableDrawSelection`.

-   **PaintOptions**:

    -   **toHideFocusRect** ‚Äî –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø—É–Ω–∫—Ç–∏—Ä–Ω—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —Ñ–æ–∫—É—Å–∞ –ø–æ –≥—Ä–∞–Ω–∏—Ü–∞–º —É–∑–ª–∞.

    -   **toHideSelection** ‚Äî –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –±–µ–∂–µ–≤—ã–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –≤—ã–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤, –∫–æ–≥–¥–∞ —Å–∞–º–æ –¥–µ—Ä–µ–≤–æ –Ω–µ –∏–º–µ–µ—Ç —Ñ–æ–∫—É—Å–∞. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ, –∫–æ–≥–¥–∞ –¥–µ—Ä–µ–≤–æ –Ω–µ –±—É–¥–µ—Ç –∏–º–µ—Ç—å —Ñ–æ–∫—É—Å–∞, –í—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ —É–∑–ª—ã –æ—Ç –Ω–µ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö.

    -   **toHotTrack** ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É–∑–ª–∞, –Ω–∞—Ö–æ–¥—è—â–µ–≥–æ—Å—è –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Ç–∞–∫–æ–π —É–∑–µ–ª –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–º, –µ—Å–ª–∏ –í—ã –≤–∫–ª—é—á–∏—Ç–µ —ç—Ç—É –æ–ø—Ü–∏—é.

    -   **toPopupMode** ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–µ—Ä–µ–≤–æ, –∫–∞–∫ –±—É–¥—Ç–æ –±—ã –æ–Ω–æ –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç —Ñ–æ–∫—É—Å.

    -   **toShowBackground** ‚Äî –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å —Ñ–æ–Ω–æ–≤—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É, –µ—Å–ª–∏ –µ—Å—Ç—å (–ø–∞—Ä–∞–º–µ—Ç—Ä `Background`).

    -   **toShowButtons** ‚Äî –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è/—Å–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞–ø—Ä–æ—Ç–∏–≤ —É–∑–ª–æ–≤.

    -   **toShowDropmark** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–Ω–∞—á–æ–∫, –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–∏–π –ø–æ–ª–æ–∂–µ–Ω–∏–µ –±—É–¥—É—â–µ–≥–æ —É–∑–ª–∞ –ø—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö Drag&Drop.

    -   **toShowHorzGridLines** ‚Äî –≤–∫–ª—é—á–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ª–∏–Ω–∏–π —Å–µ—Ç–∫–∏.

    -   **toShowRoot** ‚Äî —É—á–∏—Ç—ã–≤–∞—Ç—å –æ—Ç—Å—Ç—É–ø –∏ —Ä–∏—Å–æ–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ –¥–ª—è —Å–∞–º—ã—Ö –≤–µ—Ä—Ö–Ω–∏—Ö —É–∑–ª–æ–≤ –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ (–¥–æ—á–µ—Ä–Ω–∏—Ö —É–∑–ª–æ–≤ RootNode).

    -   **toShowTreeLines** ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ –¥–ª—è —É–∑–ª–æ–≤.

    -   **toShowVertGridLines** ‚Äî –≤–∫–ª—é—á–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö –ª–∏–Ω–∏–π —Å–µ—Ç–∫–∏.

    -   **toThemeAware** ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞ (–∫–Ω–æ–ø–æ–∫, –æ—Ç–º–µ—Ç–æ–∫ –∏ —Ç.–¥.) –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ–∫—É—â–µ–π —Ç–µ–º–æ–π –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è Windows XP. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è.

    -   **toUseBlendedImages** ‚Äî –≤–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–ª—è ghosted —É–∑–ª–æ–≤ –∏ –¥–ª—è —É–∑–ª–æ–≤, —É—á–∞—Å—Ç–≤—É—é—â–∏—Ö –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏/–≤—ã—Ä–µ–∑–∞–Ω–∏–∏.

    -   **toGhostedIfUnfocused** ‚Äî –∫–∞—Ä—Ç–∏–Ω–∫–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º–∏ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ —É–∑–µ–ª –Ω–µ –±—É–¥–µ—Ç –≤—ã–¥–µ–ª–µ–Ω.

    -   **toFullVertGridLines** ‚Äî –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ —Å–µ—Ç–∫–∏ –¥–æ –∫–æ–Ω—Ü–∞ –¥–µ—Ä–µ–≤–∞. –ï—Å–ª–∏ –¥–∞–Ω–Ω–∞—è –æ–ø—Ü–∏—è –±—É–¥–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω–∞, —Ç–æ –ª–∏–Ω–∏–∏ –∑–∞–∫–æ–Ω—á–∞—Ç—Å—è –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º –≤–∏–¥–∏–º–æ–º —É–∑–ª–µ.

    -   **toAlwaysHideSelection** ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —É–∑–ª—ã –∫–∞–∫ –Ω–µ–≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è.

    -   **toUseBlendedSelection** ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ —É–∑–ª—ã –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º–∏.

    -   **toStaticBackground** ‚Äî –∑–∞–ø—Ä–µ—â–∞–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å —Ñ–æ–Ω–æ–≤–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–æ–π –≤–∏–¥–∏–º—É—é –æ–±–ª–∞—Å—Ç—å –¥–µ—Ä–µ–≤–∞.

-   **SelectionOptions** (—Ç–æ–ª—å–∫–æ –¥–ª—è `TVirtualStringTree` –¥–µ—Ä–µ–≤–∞):

    -   **toDisableDrawSelection** ‚Äî –∑–∞–ø—Ä–µ—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–æ–±–∞–≤–ª—è—Ç—å –≤ —Ç–µ–∫—É—â–µ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É–∑–ª—ã —Å –ø–æ–º–æ—â—å—é –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è.

    -   **toExtendedFocus** ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–¥–µ–ª—è—Ç—å —è—á–µ–π–∫–∏ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –≤–æ –≤—Å–µ—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≤ `MainColumn`.

    -   **toFullRowSelect** ‚Äî –¥–µ—Ä–µ–≤–æ –±—É–¥–µ—Ç —Ä–∏—Å–æ–≤–∞—Ç—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –≤—ã–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –≤—Å—é —Å–≤–æ—é —à–∏—Ä–∏–Ω—É –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –¥–ª–∏–Ω–∞ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è –Ω–µ –±—É–¥–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —à–∏—Ä–∏–Ω—ã —Ç–µ–∫—Å—Ç–∞. –ü–æ–º–∏–º–æ —ç—Ç–æ–≥–æ, —É–∑–ª—ã –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ–º –º—ã—à–∏ –≤ –ª—é–±—É—é –æ–±–ª–∞—Å—Ç—å –¥–µ—Ä–µ–≤–∞, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ —Ç–µ–∫—Å—Ç—É —É–∑–ª–∞.

    -   **toLevelSelectConstraint** ‚Äî –∑–∞–ø—Ä–µ—â–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ —Ç–µ–∫—É—â–µ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–º–æ–≥—É—Ç –ø–æ–ø–∞—Å—Ç—å —Ç–æ–ª—å–∫–æ —É–∑–ª—ã —Å —Ç–∞–∫–∏–º –∂–µ —É—Ä–æ–≤–Ω–µ–º –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏, —á—Ç–æ –∏ —É –ø–µ—Ä–≤–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ.

    -   **toMiddleClickSelect** ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤ —Å—Ä–µ–¥–Ω–µ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏.

    -   **toMultiSelect** ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ –±–æ–ª–µ–µ —á–µ–º –æ–¥–Ω–æ–≥–æ —É–∑–ª–∞.

    -   **toRightClickSelect** ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏.

    -   **toSiblingSelectConstraint** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —É–∑–ª–∞–º–∏ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ —Ä–æ–¥–∏—Ç–µ–ª—è.

    -   **toCenterScrollIntoView** ‚Äî —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ—Ç –≤–∏–¥–∏–º—É—é (–∫–ª–∏–µ–Ω—Ç—Å–∫—É—é) –æ–±–ª–∞—Å—Ç—å –¥–µ—Ä–µ–≤–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —É–∑–ª—É, –ø–æ–ª—É—á–∞—é—â–µ–º—É —Ñ–æ–∫—É—Å. –û—á–µ–Ω—å —É–¥–æ–±–Ω–æ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤.

    -   **toSimpleDrawSelection** ‚Äî —É–ø—Ä–æ—â–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –≤—ã–¥–µ–ª–µ–Ω–∏—è —É–∑–ª–æ–≤, –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ—Å–µ–∫—Å—è —Å —Ç–µ–∫—Å—Ç–æ–º —É–∑–ª–∞ –¥–ª—è –µ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è. –ï—Å–ª–∏ –æ–ø—Ü–∏—è –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ `False`, —Ç–æ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —É–∑–ª–∞ –ø—Ä–∏–¥–µ—Ç—Å—è —Ç–∞—â–∏—Ç—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –≤—ã–¥–µ–ª–µ–Ω–∏—è –¥–æ —Ç–µ–∫—Å—Ç–∞ `MainColumn` –∫–æ–ª–æ–Ω–∫–∏.

-   **StringOptions**:

    -   **toSaveCaptions** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ —è—á–µ–µ–∫ —É–∑–ª–∞ –ø—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Å –±—É—Ñ–µ—Ä–æ–º –æ–±–º–µ–Ω–∞, Drag&Drop –∏ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –ø–æ—Ç–æ–∫ –∏–ª–∏ —Ñ–∞–π–ª. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–∫–ª—é—á–∞—Ç—å –ø—Ä–∏ Drag&Drop –∏ –≤—ã–∫–ª—é—á–∞—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ñ–∞–π–ª–∞–º–∏, —Ç.–∫. —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —É–∑–ª–∞ –≤ –ø–æ—Ç–æ–∫–µ —Å—Ç—Ä–æ–≥–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–µ–ª–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

    -   **toShowStaticText** ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ä—è–¥–æ–º —Å –æ–±—ã—á–Ω—ã–º, –Ω–æ –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –Ω–µ–≥–æ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º **VT**.

    -   **toAutoAcceptEditChange** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –±—ã–ª–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ –ø–æ <kbd>Esc</kbd> –∏–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –ø–æ <kbd>Enter</kbd>. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è `OnNewText`.

## 9.1. –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –≤ VT.

**VT** —Å–æ–¥–µ—Ä–∂–∏—Ç –≤ —Å–µ–±–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à –ø–æ—á—Ç–∏ –¥–ª—è –≤—Å–µ—Ö —Å–≤–æ–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π. –ù–∏–∂–µ–ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à –≤–∑—è—Ç –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ö–µ–ª–ø–∞, –∏ –ø–æ —Å–µ–º—É –∑–¥–µ—Å—å –í—ã –≤–∏–¥–∏—Ç–µ –µ–≥–æ –ø–µ—Ä–µ–≤–æ–¥. –ù–µ –ø–æ–ª–µ–Ω–∏—Ç–µ—Å—å –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å —ç—Ç–∏–º —Å–ø–∏—Å–∫–æ–º, –æ–Ω –¥–æ–≤–æ–ª—å–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π üòä

| –ö–ª–∞–≤–∏—à–∞               | –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã          | –†–µ–∑—É–ª—å—Ç–∞—Ç
| --------------------- | --------------------- | -
| <kbd>Home</kbd>       | –ù–µ—Ç                   | –í—ã–¥–µ–ª—è–µ—Ç –ø–µ—Ä–≤—ã–π –≤–∏–¥–∏–º—ã–π —É–∑–µ–ª –≤ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–ª–æ–Ω–∫–µ. –≠—Ç–æ—Ç —É–∑–µ–ª —Ç–∞–∫–∂–µ –ø–æ–ª—É—á–∞–µ—Ç —Ñ–æ–∫—É—Å –≤–≤–æ–¥–∞.<br/>*–î–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ grid mode:* –ê–∫—Ç–∏–≤–Ω—ã–π —É–∑–µ–ª –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è, –Ω–æ —Ñ–æ–∫—É—Å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø–µ—Ä–≤–æ–π –≤–∏–¥–∏–º–æ–π –∫–æ–ª–æ–Ω–∫–µ.
|                       | <kbd>Shift</kbd>      | –í—ã–¥–µ–ª—è–µ—Ç –ø–µ—Ä–≤—ã–π –≤–∏–¥–∏–º—ã–π —É–∑–µ–ª –≤ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–ª–æ–Ω–∫–µ –∏ –≤–∫–ª—é—á–∞–µ—Ç –≤ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤—Å–µ –≤–∏–¥–∏–º—ã–µ —É–∑–ª—ã –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–æ –Ω–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ. –≠—Ñ—Ñ–µ–∫—Ç –æ—á–µ–Ω—å —Å—Ö–æ–∂ —Å –ü—Ä–æ–≤–æ–¥–Ω–∏–∫–æ–º Windows.<br/>*–î–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ grid mode:* –ê–∫—Ç–∏–≤–Ω—ã–π —É–∑–µ–ª –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è, –Ω–æ —Ñ–æ–∫—É—Å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø–µ—Ä–≤–æ–π –≤–∏–¥–∏–º–æ–π –∫–æ–ª–æ–Ω–∫–µ. –í—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è.
|                       | <kbd>Ctrl</kbd>       | –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç –¥–µ—Ä–µ–≤–æ –¥–æ –ª–µ–≤–æ–≥–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ –∫—Ä–∞—è, –Ω–µ –∏–∑–º–µ–Ω—è—è –Ω–∏ —Ñ–æ–∫—É—Å, –Ω–∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ.
| <kbd>End</kbd>        | –ù–µ—Ç                   | –í—ã–¥–µ–ª—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–∏–¥–∏–º—ã–π —É–∑–µ–ª –≤ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–ª–æ–Ω–∫–µ. –≠—Ç–æ—Ç —É–∑–µ–ª —Ç–∞–∫–∂–µ –ø–æ–ª—É—á–∞–µ—Ç —Ñ–æ–∫—É—Å –≤–≤–æ–¥–∞.<br/>*–î–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ grid mode:* –ê–∫—Ç–∏–≤–Ω—ã–π —É–∑–µ–ª –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è, –Ω–æ —Ñ–æ–∫—É—Å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–∏–¥–∏–º–æ–π –∫–æ–ª–æ–Ω–∫–µ.
|                       | <kbd>Shift</kbd>      | –í—ã–¥–µ–ª—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–∏–¥–∏–º—ã–π —É–∑–µ–ª –≤ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–ª–æ–Ω–∫–µ –∏ –≤–∫–ª—é—á–∞–µ—Ç –≤ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤—Å–µ –≤–∏–¥–∏–º—ã–µ —É–∑–ª—ã –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–æ –Ω–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —É–∑–ª–∞. –≠—Ñ—Ñ–µ–∫—Ç –æ—á–µ–Ω—å —Å—Ö–æ–∂ —Å –ü—Ä–æ–≤–æ–¥–Ω–∏–∫–æ–º Windows.<br/>*–î–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ grid mode:* –ê–∫—Ç–∏–≤–Ω—ã–π —É–∑–µ–ª –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è, –Ω–æ —Ñ–æ–∫—É—Å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø–µ—Ä–≤–æ–π –≤–∏–¥–∏–º–æ–π –∫–æ–ª–æ–Ω–∫–µ. –í—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è.
|                       | <kbd>Ctrl</kbd>       | –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç –¥–µ—Ä–µ–≤–æ –¥–æ –ø—Ä–∞–≤–æ–≥–æ –Ω–∏–∂–Ω–µ–≥–æ –∫—Ä–∞—è, –Ω–µ –∏–∑–º–µ–Ω—è—è –Ω–∏ —Ñ–æ–∫—É—Å, –Ω–∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ.
| <kbd>Prior</kbd><br/>(—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–≤–µ—Ä—Ö) | –ù–µ—Ç | –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç –¥–µ—Ä–µ–≤–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–≤–µ—Ä—Ö, –≤—ã–¥–µ–ª—è—è –ø—Ä–∏ —ç—Ç–æ–º —É–∑–µ–ª —Å–≤–µ—Ä—Ö—É. –≠—Ç–æ—Ç —É–∑–µ–ª —Ç–∞–∫–∂–µ –ø–æ–ª—É—á–∞–µ—Ç —Ñ–æ–∫—É—Å.
|                       | <kbd>Shift</kbd>      | –¢–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ –≤–∫–ª—é—á–∞–µ—Ç –≤ –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ–∫—Ä—É—á–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤.
|                       | <kbd>Ctrl</kbd>       | –¢–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –∞–∫—Ç–∏–≤–Ω—ã–π —É–∑–µ–ª –Ω–µ —Ç–µ—Ä—è–µ—Ç —Å–≤–æ–µ–≥–æ —Ñ–æ–∫—É—Å–∞ –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è.
| <kbd>Next</kbd><br/>(—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–Ω–∏–∑) | –ù–µ—Ç | –¢–æ—Ç –∂–µ —ç—Ñ—Ñ–µ–∫—Ç, —á—Ç–æ –∏ <kbd>Prior</kbd>, –Ω–æ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–Ω–∏–∑.
|                       | <kbd>Shift</kbd>      | –¢–æ—Ç –∂–µ —ç—Ñ—Ñ–µ–∫—Ç, —á—Ç–æ –∏ <kbd>Prior</kbd>, –Ω–æ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–Ω–∏–∑.
|                       | <kbd>Ctrl</kbd>       | –¢–æ—Ç –∂–µ —ç—Ñ—Ñ–µ–∫—Ç, —á—Ç–æ –∏ <kbd>Prior</kbd>, –Ω–æ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–Ω–∏–∑.
| <kbd>Up</kbd>         | –ù–µ—Ç                   | –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç —Ñ–æ–∫—É—Å —Å —Ç–µ–∫—É—â–µ–≥–æ —É–∑–ª–∞ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π.
|                       | <kbd>Shift</kbd>      | –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç —Ñ–æ–∫—É—Å —Å —Ç–µ–∫—É—â–µ–≥–æ —É–∑–ª–∞ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –¥–æ–±–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ –≤—ã–¥–µ–ª–µ–Ω–∏–µ.
|                       | <kbd>Ctrl</kbd>       | –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç –¥–µ—Ä–µ–≤—É –Ω–∞ –æ–¥–Ω—É –ª–∏–Ω–∏—é –≤–≤–µ—Ä—Ö. –í—ã—Å–æ—Ç–∞ –æ–¥–Ω–æ–π –ª–∏–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ DefaultNodeHeight.
| <kbd>Down</kbd>       | –ù–µ—Ç                   | –¢–æ—Ç –∂–µ —ç—Ñ—Ñ–µ–∫—Ç, —á—Ç–æ –∏ <kbd>Up</kbd>, –Ω–æ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é –≤–Ω–∏–∑.
|                       | <kbd>Shift</kbd>      | –¢–æ—Ç –∂–µ —ç—Ñ—Ñ–µ–∫—Ç, —á—Ç–æ –∏ <kbd>Up</kbd>, –Ω–æ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é –≤–Ω–∏–∑.
|                       | <kbd>Ctrl</kbd>       | –¢–æ—Ç –∂–µ —ç—Ñ—Ñ–µ–∫—Ç, —á—Ç–æ –∏ <kbd>Up</kbd>, –Ω–æ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é –≤–Ω–∏–∑.
| <kbd>Left</kbd>       | –ù–µ—Ç                   | –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç —Ñ–æ–∫—É—Å –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —É–∑–µ–ª —Ç–µ–∫—É—â–µ–≥–æ —É–∑–ª–∞ –∏ –≤—ã–¥–µ–ª—è–µ—Ç –µ–≥–æ, –µ—Å–ª–∏ —É —Ç–µ–∫—É—â–µ–≥–æ —É–∑–ª–∞ –Ω–µ—Ç –¥–æ—á–µ—Ä–Ω–∏—Ö —É–∑–ª–æ–≤, –∏ –æ–Ω —É–∂–µ —Å–≤–µ—Ä–Ω—É—Ç. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ —Ñ–æ–∫—É—Å –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è, –Ω–æ —É–∑–µ–ª –±—É–¥–µ—Ç —Å–≤–µ—Ä–Ω—É—Ç. –í –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö —É–∑–µ–ª, –∏–º–µ—é—â–∏–π —Ñ–æ–∫—É—Å, –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–º —É–∑–ª–æ–º –¥–µ—Ä–µ–≤–∞.<br/>*–î–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ grid mode:* –µ—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ñ–æ–∫—É—Å –≤–∫–ª—é—á–µ–Ω (–æ–ø—Ü–∏—è *toExtendedFocus* –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö), —Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–∏–¥–∏–º—É—é –∫–æ–ª–æ–Ω–∫—É.
|                       | <kbd>Shift</kbd>      | –í –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ—Å—Ç—å —Å–ª—É—á–∞—é —Å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º –∫–ª–∞–≤–∏—à–∏-–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —É–∑–ª–∞ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è. –§–æ–∫—É—Å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —É–∑–ª—É –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —É–∑–µ–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ.
|                       | <kbd>Ctrl</kbd>       | –î–µ—Ä–µ–≤–æ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è –≤–ª–µ–≤–æ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∏–∫—Å–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `Indent`.
| <kbd>Right</kbd>      | –ù–µ—Ç                   | –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç —Ñ–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤—ã–π –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª —Ç–µ–∫—É—â–µ–≥–æ —É–∑–ª–∞, –µ—Å–ª–∏ —É –¥–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞ –µ—Å—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã, –∏ –æ–Ω —É–∂–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ, —Ñ–æ–∫—É—Å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º, –Ω–æ —É–∑–µ–ª –±—É–¥–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç. –í –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö —É–∑–µ–ª, –∏–º–µ—é—â–∏–π —Ñ–æ–∫—É—Å, –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–º —É–∑–ª–æ–º –¥–µ—Ä–µ–≤–∞.<br/>*–î–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ grid mode:* –µ—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ñ–æ–∫—É—Å –≤–∫–ª—é—á–µ–Ω (–æ–ø—Ü–∏—è *toExtendedFocus* –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö), —Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –≤–∏–¥–∏–º—É—é –∫–æ–ª–æ–Ω–∫—É.
|                       | <kbd>Shift</kbd>      | –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å–ª—É—á–∞—é —Å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º –∫–ª–∞–≤–∏—à–∏-–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞, –Ω–æ –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –¥–æ—á–µ—Ä–Ω–∏–º —É–∑–ª–æ–º.
|                       | <kbd>Ctrl</kbd>       | –¢–æ—Ç –∂–µ —ç—Ñ—Ñ–µ–∫—Ç, —á—Ç–æ –∏ —É <kbd>Left</kbd>, –Ω–æ –¥–µ—Ä–µ–≤–æ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è –≤–ø—Ä–∞–≤–æ.
| <kbd>Back</kbd>       | –ù–µ—Ç                   | –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —É–∑–µ–ª —Ç–µ–∫—É—â–µ–≥–æ —É–∑–ª–∞ –∏ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–º —É–∑–ª–æ–º –¥–µ—Ä–µ–≤–∞.
|                       | <kbd>Shift</kbd>      | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
|                       | <kbd>Ctrl</kbd>       | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
| <kbd>Tab</kbd>        | –ù–µ—Ç                   | –ö–ª–∞–≤–∏—à–∞ —Ç–∞–±—É–ª—è—Ü–∏–∏ –∏–º–µ–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Å–æ–±–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –¥–µ—Ä–µ–≤–µ —Å grid extensions –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –æ—Ç —è—á–µ–π–∫–∏ –∫ —è—á–µ–π–∫–µ. –ë–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ —Ñ–æ–∫—É—Å –∏–∑–º–µ–Ω—è–µ—Ç—Å—è —Å–ª–µ–≤–∞-–Ω–∞–ø—Ä–∞–≤–æ –∏ —Å–≤–µ—Ä—Ö—É-–≤–Ω–∏–∑. –ß—Ç–æ–±—ã –∫–ª–∞–≤–∏—à–∞ –±—ã–ª–∞ –∞–∫—Ç–∏–≤–Ω–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–∫–ª—é—á–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–∞–±—É–ª—è—Ü–∏–∏, –≤—ã—Å—Ç–∞–≤–∏–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä `WantTabs` –≤ `True`.
|                       | <kbd>Shift</kbd>      | –¢–æ –∂–µ, —á—Ç–æ –∏ –±–µ–∑ –∫–ª–∞–≤–∏—à–∏-–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞, –Ω–æ —Ñ–æ–∫—É—Å –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –æ–±—Ä–∞—Ç–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É, —Å–ø—Ä–∞–≤–∞-–Ω–∞–ª–µ–≤–æ –∏ —Å–Ω–∏–∑—É-–≤–≤–µ—Ä—Ö.
|                       | <kbd>Ctrl</kbd>       | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
| <kbd>F1</kbd>         | –ù–µ—Ç                   | –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫–ª–∞–≤–∏—à–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é —Å–ø—Ä–∞–≤–∫—É –¥–ª—è —É–∑–ª–∞. –ß–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–µ `OnGetHelpContext` –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–º–æ—â–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.
|                       | <kbd>Shift</kbd>      | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
|                       | <kbd>Ctrl</kbd>       | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
| <kbd>F2</kbd>         | –ù–µ—Ç                   | –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫–ª–∞–≤–∏—à–∞ –≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —É–∑–ª–∞, –∏–º–µ—é—â–µ–≥–æ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ñ–æ–∫—É—Å, –µ—Å–ª–∏ —Ç–∞–∫–æ–π —É–∑–µ–ª –µ—Å—Ç—å, –¥–µ—Ä–µ–≤–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ, –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–µ `OnEditing`.
|                       | <kbd>Shift</kbd>      | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
|                       | <kbd>Ctrl</kbd>       | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
| <kbd>+</kbd><br/>(add)| –ù–µ—Ç                   | –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —É–∑–µ–ª.
|                       | <kbd>Shift</kbd>      | –≠—Ç–æ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤ –æ–¥–∏–Ω–æ—á–∫—É –Ω–µ –∏–º–µ–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è. –°–º. –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–∏–∂–µ.
|                       | <kbd>Ctrl</kbd>       | –ù–∞–∂–∞—Ç–∏–µ –∫–ª–∞–≤–∏—à–∏ <kbd>Ctrl</kbd> –≤–º–µ—Å—Ç–µ —Å –∫–ª–∞–≤–∏—à–µ–π ¬´+¬ª –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º—É –∏–∑–º–µ–Ω–µ–Ω–∏—é —Ä–∞–∑–º–µ—Ä–æ–≤ –≤—Å–µ—Ö –∫–æ–ª–æ–Ω–æ–∫ –¥–µ—Ä–µ–≤–∞. –ï—Å–ª–∏ —Ç–∞–∫–∂–µ –±—É–¥–µ—Ç –Ω–∞–∂–∞—Ç–∞ –∫–ª–∞–≤–∏—à–∞ <kbd>Shift</kbd>, —Ç–æ –±—É–¥—É—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –≤—Å–µ —É–∑–ª—ã –¥–µ—Ä–µ–≤–∞.
| <kbd>-</kbd><br/>(subtract) | –ù–µ—Ç | –°–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —É–∑–µ–ª.
|                       | <kbd>Shift</kbd>      | –≠—Ç–æ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤ –æ–¥–∏–Ω–æ—á–∫—É –Ω–µ –∏–º–µ–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è. –°–º. –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–∏–∂–µ.
|                       | <kbd>Ctrl</kbd>       | –ù–∞–∂–∞—Ç–∏–µ –∫–ª–∞–≤–∏—à–∏ <kbd>Ctrl</kbd> –≤–º–µ—Å—Ç–µ —Å –∫–ª–∞–≤–∏—à–µ–π ¬´-¬ª –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é —Ä–∞–∑–º–µ—Ä–æ–≤ –∫–æ–ª–æ–Ω–æ–∫ –¥–µ—Ä–µ–≤–∞. –ï—Å–ª–∏ —Ç–∞–∫–∂–µ –±—É–¥–µ—Ç –Ω–∞–∂–∞—Ç–∞ –∫–ª–∞–≤–∏—à–∞ <kbd>Shift</kbd>, —Ç–æ –±—É–¥—É—Ç —Å–≤–µ—Ä–Ω—É—Ç—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –≤—Å–µ —É–∑–ª—ã –¥–µ—Ä–µ–≤–∞.
| <kbd>*</kbd><br/>(—É–º–Ω–æ–∂–∏—Ç—å) | –ù–µ—Ç | –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —É–∑–µ–ª —Å–æ –≤—Å–µ–º–∏ –µ–≥–æ –¥–æ—á–µ—Ä–Ω–∏–º–∏ —É–∑–ª–∞–º–∏.
|                       | <kbd>Shift</kbd>      | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
|                       | <kbd>Ctrl</kbd>       | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
| <kbd>/</kbd><br/>(—Ä–∞–∑–¥–µ–ª–∏—Ç—å) | –ù–µ—Ç | –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —É–∑–µ–ª —Å–æ –≤—Å–µ–º–∏ –µ–≥–æ –¥–æ—á–µ—Ä–Ω–∏–º–∏ —É–∑–ª–∞–º–∏.
|                       | <kbd>Shift</kbd>      | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
|                       | <kbd>Ctrl</kbd>       | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
| <kbd>Escape</kbd><br/>(–æ—Ç–º–µ–Ω–∞) | –ù–µ—Ç | –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è –¥–µ—Ä–µ–≤–∞, —Ç—Ä–µ–±—É—é—â–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤—ã–¥–µ–ª–µ–Ω–∏–µ –º—ã—à—å—é, Drag&Drop –∏ —Ç.–¥.
|                       | <kbd>Shift</kbd>      | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
|                       | <kbd>Ctrl</kbd>       | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
| <kbd>Space</kbd><br/>(–ø—Ä–æ–±–µ–ª) | –ù–µ—Ç | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç–º–µ—Ç–æ–∫ –≤–∫–ª—é—á–µ–Ω–∞ (–æ–ø—Ü–∏—è *toCheckSupport* –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö) –∏ —Ç–µ–∫—É—â–∏–π —É–∑–µ–ª –∏–º–µ–µ—Ç –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å —Ç–∏–ø –æ—Ç–º–µ—Ç–∫–∏, –æ—Ç–ª–∏—á–Ω—ã–π –æ—Ç ctNone. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∫–ª–∞–≤–∏—à–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–º–µ—Ç–∫–∏ —É–∑–ª–∞.
|                       | <kbd>Shift</kbd>      | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
|                       | <kbd>Ctrl</kbd>       | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
| <kbd>Apps</kbd><br/>(–∫–ª–∞–≤–∏—à–∞ –º–µ–Ω—é) | –ù–µ—Ç | –ü–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å <kbd>F1</kbd> –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç popup –º–µ–Ω—é –∫–ª–∞–≤–∏—à–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞. Popup –º–µ–Ω—é –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è —É–∑–ª—É —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–µ `OnGetPopupMenu`.
|                       | <kbd>Shift</kbd>      | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
|                       | <kbd>Ctrl</kbd>       | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
| <kbd>A</kbd>          | –ù–µ—Ç                   | –≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –±—É–∫–≤–µ–Ω–Ω–∞—è –∫–ª–∞–≤–∏—à–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –¥–µ—Ä–µ–≤–æ–º –∫–∞–∫ –≥–æ—Ä—è—á–∞—è. –û–Ω–∞ –∏–º–µ–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º <kbd>Ctrl</kbd>.
|                       | <kbd>Shift</kbd>      | –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
|                       | <kbd>Ctrl</kbd>       | –ù–∞–∂–∞—Ç–∏–µ <kbd>A</kbd> –≤–º–µ—Å—Ç–µ —Å –∫–ª–∞–≤–∏—à–µ–π <kbd>Ctrl</kbd> –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –≤—ã–¥–µ–ª–µ–Ω–∏—é –≤—Å–µ—Ö –≤–∏–¥–∏–º—ã—Ö —É–∑–ª–æ–≤ –¥–µ—Ä–µ–≤–∞.

## 10.0. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ **VT** –Ω–µ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö, –µ–≥–æ –∑–∞–º–∞–Ω—á–∏–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–æ–≥—É—Ç –Ω–∞–π—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏ —Ç–∞–º. **VT** –ª–µ–≥–∫–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤ –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é –Ω–µ—Ö–∏—Ç—Ä—ã—Ö —Ç–µ–ª–æ–¥–≤–∏–∂–µ–Ω–∏–π. –ü—Ä–∏—á–∏–Ω–æ–π –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–ø–æ–ª–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –∏ –±–æ–≥–∞—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (—Ä–µ–¥–∞–∫—Ç–æ—Ä—ã, –æ—Ç–º–µ—Ç–∫–∏, —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∏ —Ç.–¥.).

## 10.1. –ü—Ä–æ—Å—Ç–µ–π—à–µ–µ –ë–î –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å VT.

–ó–¥–µ—Å—å –Ø –ø—Ä–∏–≤–µ–¥—É –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è **VT** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å –ë–î, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∞–º—ã–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: —á—Ç–µ–Ω–∏–µ, –∑–∞–ø–∏—Å—å –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–∏—Å–µ–π —Ç–∞–±–ª–∏—Ü—ã. –°—É—Ç—å –ø—Ä–∏–º–µ—Ä–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª–µ–π –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã–≤–æ–¥–µ —ç—Ç–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ **VT**. –ß–∞—Å—Ç–∏—á–Ω—ã–π –∫–æ–¥ –ø—Ä–∏–º–µ—Ä–∞ –¥–∞–Ω –Ω–∏–∂–µ —Å–æ –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö Delphi –∏–∑ ¬´DBDEMOS¬ª –Ω–∞–±–æ—Ä–∞ (employee.db).

```delphi
type
  PDBRec = ^TDBRec;

  TDBRec = record
    ANum: Integer;
    AFirstName,
    ALastName: WideString;
    Initialized: Boolean; // True, –µ—Å–ª–∏ —É–∑–µ–ª –±—ã–ª –∑–∞–ø–æ–ª–Ω–µ–Ω –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
end;

//--------------------------------------------------------------------------
// –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –¥–µ—Ä–µ–≤–æ –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ.
//--------------------------------------------------------------------------
procedure TfrmMain.LoadDB;
begin
  if not Table.Active then
    Table.Open;
  with Table do
  begin
    Filtered := False;
    Filter := '';
    First;
  end;
  with VT do
  begin
    Clear;
    NodeDataSize := SizeOf(TDBRec);
    RootNodeCount := Table.RecordCount;
    Header.SortColumn := 0;
    // –î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –¥–µ—Ä–µ–≤–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–∞–∫
    // True, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–∑–µ–ª –æ–±–Ω–æ–≤–∏–ª —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ.
    SortTree(0, sdAscending, True);
  end;
end;

//--------------------------------------------------------------------------
// –ß–∏—Å—Ç–∏–º –ø–∞–º—è—Ç—å –æ—Ç —Å—Ç—Ä–æ–∫.
//--------------------------------------------------------------------------
procedure TfrmMain.VTFreeNode(Sender: TBaseVirtualTree; Node: PVirtualNode);
var
  DBRec: PDBRec;
begin
  DBRec := Sender.GetNodeData(Node);
  if Assigned(DBRec) then
    Finalize(DBRec^);
end;

//--------------------------------------------------------------------------

procedure TfrmMain.VTGetText(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex; TextType: TVSTTextType; var CellText: WideString);
var
  DBRec: PDBRec;
begin
  DBRec := Sender.GetNodeData(Node);
  case Column of
    0: CellText := IntToStr(DBRec.ANum);
    1: CellText := DBRec.AFirstName;
    2: CellText := DBRec.ALastName;
  end;
end;

//--------------------------------------------------------------------------

procedure TfrmMain.VTHeaderClick(Sender: TVTHeader; Column: TColumnIndex;
  Button: TMouseButton; Shift: TShiftState; X, Y: Integer);
begin
  if Button = mbLeft then
  begin
    if Sender.SortColumn <> Column then
      Sender.SortColumn := Column;
    if Sender.SortDirection = sdAscending then
      Sender.SortDirection := sdDescending
    else
      Sender.SortDirection := sdAscending;
    VT.SortTree(Sender.SortColumn, Sender.SortDirection, True);
  end;
end;

//--------------------------------------------------------------------------
// –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –≤ —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ. –ï—ë –∑–∞–¥–∞—á–∞ - –∑–∞–ø–æ–ª–Ω—è—Ç—å –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π
// —É–∑–µ–ª –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã. –ü–æ—Å–ª–µ —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –æ—á–µ—Ä–µ–¥–Ω–æ–π –∑–∞–ø–∏c–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã,
// –º—ã –ø–µ—Ä–µ–º–µ—â–∞–µ–º—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –º–µ—Ç–æ–¥–æ–º Next, –ø–æ–∫–∞ –Ω–µ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è –±–∞–∑–∞
// –¥–∞–Ω–Ω—ã—Ö.
// –í —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –•–æ—Ç—è, –Ω–∞ —Å–∞–º–æ–º
// –¥–µ–ª–µ, –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å –∏ –±–µ–∑ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–æ –≤—Ä–µ–º—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏.
//--------------------------------------------------------------------------
procedure TfrmMain.VTInitNode(Sender: TBaseVirtualTree; ParentNode,
  Node: PVirtualNode; var InitialStates: TVirtualNodeInitStates);
var
  DBRec: PDBRec;
begin
  DBRec := Sender.GetNodeData(Node);
  if not DBRec.Initialized then
  begin
    Initialize(DBRec^);
    with DBRec^ do
    begin
      ANum := StrToInt(Table.FieldByName('EmpNo').AsString);
      AFirstName := Table.FieldByName('FirstName').AsString;
      ALastName := Table.FieldByName('LastName').AsString;
      Initialized := True;
    end;
  end
  else begin
    // –ó–∞–ø–∏—Å—å —É–∂–µ –±—ã–ª–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–Ω–∞—á–µ–Ω–∏–π
    // —Ç–∞–±–ª–∏—Ü—ã. –ó–Ω–∞—á–∏—Ç, –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —É–∑–ª–∞. –ü–æ—Å–ª–µ
    // —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è,
    // –∫ –ø—Ä–∏–º–µ—Ä—É.
    with Table do
    begin
      Filtered := True;
      Filter := 'EmpNo = ' + #39 + IntToStr(FUpdatingNum) + #39;
      if RecordCount > 0 then
        with DBRec^ do
        begin
          ANum := StrToInt(Table.FieldByName('EmpNo').AsString);
          AFirstName := Table.FieldByName('FirstName').AsString;
          ALastName := Table.FieldByName('LastName').AsString;
        end;
    end;
  end;
  if not Table.Eof then
    Table.Next;
end;

//--------------------------------------------------------------------------
// –í–Ω–æ—Å–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
//--------------------------------------------------------------------------
procedure TfrmMain.VTNewText(Sender: TBaseVirtualTree; Node: PVirtualNode;
  Column: TColumnIndex; NewText: WideString);
var
  DBRec: PDBRec;
begin
  if NewText = '' then
    Exit;
  DBRec := Sender.GetNodeData(Node);
  with Table do
  begin
    Filtered := True;
    // –í–∫–ª—é—á–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∏ –ø–æ –∏–Ω–¥–µ–∫—Å—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é
    // –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ.
    Filter := 'EmpNo = ' + #39 + IntToStr(DBRec.ANum) + #39;
    if RecordCount > 0 then
    begin
      Table.Edit;
      try
        // –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –Ω–∞–π–¥–µ–Ω–∞, —Ç–æ –º–æ–∂–Ω–æ –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        case Column of
          0: Table.FieldByName('EmpNo').AsInteger := StrToIntDef(NewText,
            0);
          1: Table.FieldByName('FirstName').AsString := NewText;
          2: Table.FieldByName('LastName').AsString := NewText;
        end;
        Table.Post;
        // –≠—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω—É–∂–Ω–∞ –±—É–¥–µ—Ç –≤ —Å–æ–±—ã—Ç–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —É–∑–ª–∞.
        // –° –ø–æ–º–æ—à—å—é –Ω–µ—ë –±—É–¥–µ—Ç –≤—ã–±—Ä–∞–Ω–∞ –∏–∑–º–µ–Ω–∏–≤—à–∞—è—Å—è –∑–∞–ø–∏—Å—å –ø—É—Ç—ë–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        // –∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —É–∑–ª–∞.
        // –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤ —ç—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ
        // –≤ —Å–æ–±—ã—Ç–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ
        // DBRec.ANum, —Ç.–∫. –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–≤—É—é –∫–æ–ª–æ–Ω–∫—É
        // –∏
        // DBRec.ANum —É–∫–∞–∑—ã–≤–∞–ª –±—ã –Ω–∞ —Å—Ç–∞—Ä—ã–π –∏–Ω–¥–µ–∫—Å –∑–∞–ø–∏—Å–∏, —Ç–æ–≥–¥–∞ –∫–∞–∫ –Ω–æ–≤—ã–π
        // —Å–æ–¥–µ—Ä–∂–∞–ª—Å—è –±—ã –≤ NewText.
        if Column = 0 then
          FUpdatingNum := StrToIntDef(NewText, 0)
        else
          FUpdatingNum := StrToIntDef(VT.Text[Node, 0], 0);
        Sender.ReinitNode(Node, False);
      except
        // –û—à–∏–±–∫–∞...
      end;
    end
    else
      MessageBox(Self.Handle, '–û—à–∏–±–∫–∞: –ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.',
        PChar(Application.Title), MB_OK or MB_ICONERROR or MB_APPLMODAL or
          MB_DEFBUTTON1);
  end;
end;
```

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤—ã—Å—Ç–∞–≤–∏—Ç—å –æ–ø—Ü–∏—é –¥–µ—Ä–µ–≤–∞ `toGridExtensions` –≤ `True`, —á—Ç–æ–±—ã –æ–Ω–æ –±–æ–ª—å—à–µ –ø–æ—Ö–æ–¥–∏–ª–æ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä —è—á–µ–µ–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (`TDBGrid`).

###### üí° –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö —Å VT, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ *Fig 1.9.*

## 11.0. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ.

–í–æ—Ç, –Ω–∞–∫–æ–Ω–µ—Ü, –º—ã –∏ –ø–æ–¥–æ—à–ª–∏ –∫ –∫–æ–Ω—Ü—É. –¢–µ–ø–µ—Ä—å –í—ã –º–æ–∂–µ—Ç–µ –±—ã—Ç—å —Ç–≤–µ—Ä–¥–æ —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –∑–Ω–∞–µ—Ç–µ –æ **VT** –±–æ–ª–µ–µ —á–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –Ø —Å—Ç–∞—Ä–∞–ª—Å—è —Å–¥–µ–ª–∞—Ç—å —Å—Ç–∞—Ç—å—é –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª–µ–µ –ø–æ–ª–Ω–æ–π –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–π, –Ω–µ —É–ø—É—Å–∫–∞—è –Ω–∏ –µ–¥–∏–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∏ —Å–æ–±—ã—Ç–∏—è, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ö–µ–ª–ø–∞ –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É, –Ω–æ, –∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤–µ–∑–¥–µ –µ—Å—Ç—å —Å–≤–æ–∏ —Ä–∞–º–∫–∏, –∏ –ø–æ—ç—Ç–æ–º—É —á—Ç–æ-—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –∑–∞ –∫–∞–¥—Ä–æ–º, –∞ –æ —á–µ–º-—Ç–æ –Ø –ø—Ä–æ—Å—Ç–æ –º–æ–≥ –∑–∞–±—ã—Ç—å —É–ø–æ–º—è–Ω—É—Ç—å. –ï—Å–ª–∏ –±—ã –Ø —É–¥–µ–ª—è–ª –ø—Ä–∏—Å—Ç–∞–ª—å–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É **VT**, —Ç–æ –∏ –±–µ–∑ —Ç–æ–≥–æ –ø–æ–ª—É—á–∏–≤—à–∞—è—Å—è –±–æ–ª—å—à–∞—è —Å—Ç–∞—Ç—å—è —Ä–∞—Å—Ç—è–Ω—É–ª–∞—Å—å –±—ã —Å—Ç—Ä–∞–Ω–∏—Ü –Ω–∞ —Å—Ç–æ –∏ –ø–æ—Ö–æ–¥–∏–ª–∞ –±—ã —Å–∫–æ—Ä–µ–µ –Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –ø–µ—á–∞—Ç–Ω–æ–µ –∏–∑–¥–∞–Ω–∏–µ üòä –ù–∞–º–∏ –æ—Å—Ç–∞–ª–∏—Å—å –Ω–µ—Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–º–∏ –≤—Å–µ–≥–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –Ω–µ –∏–º–µ—é—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è. –≠—Ç–æ, –∫ –ø—Ä–∏–º–µ—Ä—É, `OnResetNode`, `OnShortenString`, `OnGetPopupMenu`. –£–≤–µ—Ä–µ–Ω, –í–∞–º —Å–∞–º–∏–º –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –Ω–∏—Ö —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

–Ø –Ω–∞–¥–µ—é—Å—å, —á—Ç–æ –í–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∏ –í—ã —É–±–µ–¥–∏–ª–∏—Å—å –≤ –µ–≥–æ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ–π –º–æ—â–Ω–æ—Å—Ç–∏ –∏ —É–¥–æ–±—Å—Ç–≤–µ. –î—É–º–∞—é, —Ç–µ–ø–µ—Ä—å **VT** —Å—Ç–∞–Ω–µ—Ç –≤–∞—à–∏–º –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º –Ω–æ–º–µ—Ä –æ–¥–∏–Ω, –∞ –ø—Ä–æ `TTreeView` –∏ `TListView` –í—ã –∑–∞–±—É–¥–µ—Ç–µ, –∫–∞–∫ –æ —Å—Ç—Ä–∞—à–Ω–æ–º —Å–Ω–µ. –ò, –∫–æ–Ω–µ—á–Ω–æ –∂–µ, –Ø –Ω–∞–¥–µ—é—Å—å, —á—Ç–æ –Ø –≤—ã–ø–æ–ª–Ω–∏–ª –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π —Ü–µ–ª—å –∏ –í–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª–∞—Å—å –º–æ—è —Å—Ç–∞—Ç—å—è üòä
